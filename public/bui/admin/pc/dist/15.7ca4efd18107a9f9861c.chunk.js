webpackJsonp([15],{300:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(414),s=n(591),o=n(16),a=o(i.a,s.a,!1,null,null,null);a.options.__file="src/views/business/clients.vue",e.default=a.exports},331:function(t,e,n){"use strict";e.a={name:"filterColumn",props:{keys:{type:Object,default:function(){return{}}}}}},332:function(t,e,n){"use strict";function i(t,e){var n=[];for(var i in this.operation_keys){var s=this.operation_keys[i],o=[],a=void 0,r=!0;s.per&&o.push({name:"per",value:s.per,expression:"",arg:"display",modifiers:{}}),s.condition&&(c.b.isString(s.condition)?a=new Function("row","params","return "+s.condition):c.b.isFunction(condition)&&(a=condition),c.b.isFunction(a)&&(a(e.row,e)||(r=!1))),c.b.isFunction(this.operation_func[i])&&!1!==s.show&&r&&n.push(t("Dropdown-item",{nativeOn:{click:this.operation_func[i].bind(this,e)},directives:o},[t("Icon",{props:{type:s.type}})," ",s.title]))}return t("div",[t("Dropdown",{props:{placement:"bottom-start",trigger:"click"}},[t("Button",{props:{type:"primary",size:"small"}},["操作"," ",t("Icon",{props:{type:"arrow-down-b"}})]),t("Dropdown-menu",{slot:"list"},n)])])}var s=n(49),o=n.n(s),a=n(13),r=n.n(a),c=(n(21),n(201),n(5)),l=n(335),u={int_day:function(t,e){return this.$filter("int_date")(e.row.int_day)}};e.a={components:{FilterColumn:l.a},data:function(){return{imgView:!1,bigImage:"",loading:!1,rest_api:"",searchExpand:!1,params:{search_field:"name",search_value:"",order_field:"",order_sort:"",last_search_value:"",bid:""},data:[],modal:{title:"",action:"add",show:!1},total:0,pageIndex:1,pageSize:10,init_page_size:0,bigPageSizeOption:[10,20,40,60,80,100],showCheckbox:!1,showIndex:!0,column_keys:{},column_render:{},operation_keys:{},operation_func:{},column_operation_text:"操作"}},methods:{sortChange:function(t){this.params.order_field=t.key,this.params.order_sort=t.order,this.init_data()},pagenation:function(t){this.pageIndex=t,this.init_data()},pagesize:function(t){if(this.pageSize=t,0==this.init_page_size)return void(this.init_page_size=1);this.init_data()},toggleSearch:function(){this.searchExpand=!this.searchExpand},search:function(){this.pagenation(1)},resetSearch:function(){this.params.search_value="",this.init_data()},init_data:function(){var t=this;if(this.loading)return!1;if(""!=this.rest_api){var e={};e.page=this.pageIndex,e.pagesize=this.pageSize,""!=this.params.search_value?(e.search_field=this.params.search_field,e.search_value=this.params.search_value,this.params.last_search_value=this.params.search_value):this.params.last_search_value="",""!=this.params.order_field&&(e.order_field=this.params.order_field,e.order_sort=this.params.order_sort),this.hook_get_param(e);for(var n in e)null===e[n]&&delete e[n];var i=this.rest_api;-1!==this.rest_api.indexOf("/:")&&(i=this.replace_rest_api(this.rest_api,e)),this.loading=!0,this.$rest(i).get(e).success(function(n){t.params=c.a.copy(e),t.data=t.deal_data(n),t.total=n.total,t.pageSize=parseInt(n.pagesize),t.loading=!1}).error(function(e){t.loading=!1})}},replace_rest_api:function(t,e){if(t.match(/:([^\/]+)\//)){var n=RegExp.$1;void 0!==e[n]&&(t=t.replace(":"+n,e[n]))}return t},hook_get_param:function(t){},deal_data:function(t){return t.list},check:function(){var t=this;return new r.a(function(e,n){t.$refs["form_"+t.datakey].validate(function(t){t?e():n()})})},add:function(){this.modal.action="add",this.modal.title="添加"+this.res_name,this.modal.show=!0,this[this.datakey][this.pk]=null},edit:function(t){this.rest_id=t[this.pk],o()(this[this.datakey],t),this.modal.action="edit",this.modal.title="编辑"+this.res_name,this.modal.show=!0},save:function(){var t=this;return new r.a(function(e,n){var i=t.rest_api,s=t[t.datakey];t.check().then(function(){var o="add"==t.modal.action?"post":"put",a=(t.modal.action,t.$rest(i));"add"!=t.modal.action&&a.add_url_param(t.rest_id),a[o](s).success(function(n){t.close(),t.init_data(),e(n)}).error(function(e){t.$Message.error(e.body.message),n(e)})})})},close:function(){this.modal.show=!1},delete:function(t){var e=this;return new r.a(function(n,i){e.$rest(e.rest_api).delete(t[e.pk]).success(function(t,i){e.init_data(),n(t)}).error(function(t,n){e.$Message.error(t.body.message),i(t)})})},do:function(t,e,n){var i=this;return new r.a(function(s,o){i.$rest(i.rest_api).add_url_param(e[i.pk],"do"+t).post(n).success(function(t){i.init_data(),s(t)}).error(function(t){i.$Message.error(t.body.message),o(t)})})},confirm:function(t){var e=this;return new r.a(function(n,i){e.$Modal.confirm({content:t||"您确定要进行删除操作吗?",onOk:function(){n()},onCancel:function(){i()}})})},fixLeft:function(){return this.data.length>0&&"left"},fixRight:function(){return this.data.length>0&&"right"},exportCSV:function(t,e){this.$refs[e].exportCsv({filename:t})},view_img:function(t){this.imgView=!0,this.bigImage=t}},computed:{toggleSearchIcon:function(){return this.searchExpand?"chevron-up":"chevron-down"},export_params:function(){var t={};t.page=this.pageIndex,t.pagesize=this.pageSize,""!=this.params.search_value&&(t[this.params.search_field]=this.params.search_value),this.hook_get_param(t);for(var e in t)null===t[e]&&delete t[e];return t},columns_head:function(){var t=[];return this.showCheckbox&&t.push({type:"selection",width:60,align:"center"}),this.showIndex&&t.push({type:"index",width:60,align:"center"}),t},columns:function(){var t=[],e={},n=this.column_render;o()(t,this.columns_head);for(var s in this.column_keys){var a=this.column_keys[s];if(void 0===a.show&&(a.show=!0),void 0===a.disabled&&(a.disabled=!1),a.show){var r=o()({key:s},a);n[s]?r.render=n[s].bind(this):u[s]&&(r.render=u[s].bind(this)),t.push(r)}}if(c.b.isEmpty(this.operation_btn)||(e.key="operation",e.title=this.column_operation_text,e.width=80,e.render=this.operation_btn.operation.bind(this),t.push(e)),c.b.isEmpty(this.operation_keys)||(e.key="operation",e.title=this.column_operation_text,e.width=80,e.render=i.bind(this),t.unshift(e)),!c.b.isEmpty(this.expand_render)){var l={};l.type="expand",l.width=50,l.render=this.expand_render.expand.bind(this),t.unshift(l)}return t},upload_header:function(){return{"x-token":this.$store.state.user.token,"x-file-key":"file"}},upload_post:function(){return{mod:"attachment_file"}}},watch:{}}},334:function(t,e){},335:function(t,e,n){"use strict";function i(t){a||n(334)}var s=n(331),o=n(336),a=!1,r=n(16),c=i,l=r(s.a,o.a,!1,c,null,null);l.options.__file="src/views/components/FilterColumn.vue",e.a=l.exports},336:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"filter-column"},[n("Dropdown",{attrs:{placement:"bottom-end"}},[n("Button",{attrs:{type:"primary"}},[t._v("\r\n    \t\t选择列\r\n            "),n("Icon",{attrs:{type:"funnel"}})],1),t._v(" "),n("Dropdown-menu",{attrs:{slot:"list"},slot:"list"},t._l(t.keys,function(e){return n("Dropdown-item",[n("Checkbox",{nativeOn:{click:function(t){t.stopPropagation(),e.show=e.show}},model:{value:e.show,callback:function(n){t.$set(e,"show",n)},expression:"item.show"}},[t._v(t._s(e.title))])],1)}))],1)],1)},s=[];i._withStripped=!0;var o={render:i,staticRenderFns:s};e.a=o},337:function(t,e,n){"use strict";var i=n(198),s=n(5);e.a={mixins:[i.a],name:"DateRangePicker",props:{value:{type:Array},label:{type:String},size:{type:String}},methods:{dateChange:function(t){var e=this;this.date_arr=t,this.$emit("input",t),this.$nextTick(function(){e.dispatch("FormItem","on-form-change",t)})},ok:function(){this.$emit("on-change",this.date_arr)},clear:function(){this.date_arr[0]="",this.date_arr[1]="",this.$emit("on-change",this.date_arr)}},computed:{placeholder:function(){return this.label||"请选择日期"}},data:function(){return{date_arr:[],date_option:{shortcuts:[{text:"今天",value:function(){return s.a.today_range()}},{text:"本周",value:function(){return s.a.week_range()}},{text:"本月",value:function(){return s.a.month_range()}},{text:"最近一周",value:function(){return s.a.recent_week_range(1)}},{text:"最近一个月",value:function(){return s.a.recent_month_range(1)}},{text:"最近三个月",value:function(){return s.a.recent_month_range(3)}}]}}}}},343:function(t,e,n){"use strict";var i=n(337),s=n(347),o=n(16),a=o(i.a,s.a,!1,null,null,null);a.options.__file="src/views/components/DateRangePicker.vue",e.a=a.exports},347:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement;return(t._self._c||e)("Date-picker",{attrs:{type:"daterange",value:t.value,size:t.size,confirm:"",options:t.date_option,placeholder:t.placeholder},on:{"on-change":t.dateChange,"on-clear":t.clear,"on-ok":t.ok}})},s=[];i._withStripped=!0;var o={render:i,staticRenderFns:s};e.a=o},414:function(t,e,n){"use strict";var i=n(520);e.a={components:{list:i.a}}},417:function(t,e,n){"use strict";var i=n(5),s=n(332),o=n(198),a=n(200),r=n(343);e.a={mixins:[s.a,o.a,a.a],components:{dateRangePicker:r.a},data:function(){return{rest_api:"clients",pk:"cid",map_classes:{0:"text-danger",1:"text-success"},search_field:{client_name:"",contact:"",address:"",tel:"",host:"",expire_day:[],current_version:""},column_keys:{client_name:{title:"客户",width:200,show:!0},contact:{title:"联系人",show:!1},tel:{title:"电话",show:!1},address:{title:"联系地址",show:!1},guige:{title:"规格",width:200,show:!0},host:{title:"域名",show:!1},bind_domain:{title:"自定义域名",show:!1},auth:{title:"模块权限",show:!1},expire_day:{title:"到期日期",show:!1,sortable:"custom"},is_org_open:{title:"加盟商",show:!1,sortable:"custom"},amount:{title:"费用",show:!0,width:200},init_amount:{title:"成交金额",show:!1,sortable:"custom"},init_renew_amount:{title:"年费",show:!1,sortable:"custom"},account_price:{title:"账号单价",show:!1,sortable:"custom"},is_init_pay:{title:"是否付款",show:!0,sortable:"custom"},is_db_install:{title:"数据库",show:!0,sortable:"custom"},is_frozen:{title:"冻结",show:!0,width:120,sortable:"custom"},account_num_limit:{title:"账号数",show:!0,sortable:"sortable"},student_num_limit:{title:"最大学员数",show:!1,sortable:"custom"},branch_num_limit:{title:"最大校区数",show:!1,sortable:"custom"},current_version:{title:"版本号",show:!0,sortable:"custom"}},column_render:{client_name:function(t,e){return t("ul",[t("li",e.row.client_name),t("li",e.row.contact),t("li",e.row.tel)])},guige:function(t,e){var n={1:"开通",0:"未开通"};return t("ul",[t("li","域名:"+e.row.host),t("li","加盟商:"+n[e.row.is_org_open]),t("li","到期日:"+e.row.expire_day)])},amount:function(t,e){return t("ul",[t("li","成交金额:"+e.row.init_amount),t("li","年费:"+e.row.init_renew_amount),t("li","学员单价:"+e.row.student_price)])},expire_day:function(t,e){return t("span",this.$filter("int_date")(e.row.expire_day))},is_db_install:function(t,e){var n={1:"已安装",0:"未安装"};return t("span",{class:this.map_classes[e.row.is_db_install]},n[e.row.is_db_install])},is_frozen:function(t,e){var n={1:"冻结",0:"正常"},i=1==e.row.is_frozen?0:1,s=[];return s.push(t("li",{class:this.map_classes[i]},n[e.row.is_frozen])),1==e.row.is_frozen&&s.push(t("li",e.row.frozen_int_day)),t("ul",s)},is_org_open:function(t,e){var n={1:"开通",0:"未开通"};return t("span",{class:this.map_classes[e.row.is_org_open]},n[e.row.is_org_open])},is_init_pay:function(t,e){var n={1:"已付款",0:"未付款"};return t("span",{class:this.map_classes[e.row.is_init_pay]},n[e.row.is_init_pay])},follow_times:function(t,e){var n=this;return t("a",{class:"text-info",on:{click:function(){n.$refs.info.set("current_tab","record").set("info",e.row).show("编辑客户【"+e.row.client_name+"】","edit")}}},e.row.follow_times)}},operation_keys:{dbInstall:{title:"开通账号",type:"plus",per:"clients.add",condition:"row.is_db_install==0"},edit:{title:"编辑客户",type:"edit",per:"client.edit"},modify:{title:"修改付款信息",type:"cash",per:"client.edit"},viewAccount:{title:"查看账号信息",type:"eye",per:"client.view",condition:"row.is_db_install==1"},login:{title:"登录系统",type:"log-in",per:"client.login",condition:"row.is_db_install==1"},users:{title:"员工账号",type:"ios-people",per:"client.users",condition:"row.is_db_install==1"},orgs:{title:"加盟商",type:"android-people",per:"client.orgs",condition:"row.is_db_install==1&&row.is_org_open==1"},frozen:{title:"冻结账号",type:"pause",per:"client.frozen",condition:"row.is_frozen==0"},unfrozen:{title:"解冻账号",type:"play",per:"client.unfrozen",condition:"row.is_frozen==1"},renew:{title:"延期",type:"android-time",per:"client.renew",condition:"row.is_init_pay==1"},expand:{title:"扩容",type:"ios-people",per:"client.expand",condition:"row.is_init_pay==1"},exesql:{title:"运行SQL",type:"code-working",per:"client.exesql",condition:"row.is_db_install==1"},resetdb:{title:"恢复出厂",type:"refresh",per:"client.resetdb",condition:"row.is_db_install==1"},delete:{title:"删除客户",type:"android-delete",per:"client.delete"}},operation_func:{dbInstall:function(t){this.dbInstall(t.row)},modify:function(t){this.modifyBasic(t.row)},edit:function(t){this.editClient(t.row)},login:function(t){this.loginClient(t.row)},viewAccount:function(t){this.viewAccount(t.row)},frozen:function(t){this.frozen(t.row)},unfrozen:function(t){this.unfrozen(t.row)},renew:function(t){},expand:function(t){},exesql:function(t){this.exesql(t.row)},upgrade:function(t){},delete:function(t){this.deleteClient(t.row)},resetdb:function(t){this.resetDb(t.row)},users:function(t){this.openUsers(t.row)},orgs:function(t){this.openOrgs(t.row)}}}},mounted:function(){this.init_data()},methods:{addInfo:function(){var t=this;this.$Modal.open("business/clients/info-modal.vue",{on:{"on-success":function(){t.init_data()}}}).then(function(t){t.vuec.show("添加客户","add")})},dbInstall:function(t){var e=this;this.$Modal.open("business/clients/dbinstall-modal.vue",{on:{"on-success":function(){e.init_data()}}}).then(function(e){e.vuec.setInfo(t).show("添加客户","add")})},editClient:function(t){var e=this;this.$Modal.open("business/clients/edit-modal.vue",{on:{"on-success":function(){e.init_data()}}}).then(function(e){e.vuec.setInfo(t).show("编辑客户","add")})},modifyBasic:function(t){var e=this;this.$Modal.open("business/clients/modify-modal.vue",{on:{"on-success":function(){e.init_data()}}}).then(function(e){e.vuec.setInfo(t).show("修改付款信息","add")})},viewAccount:function(t){this.$Modal.open("business/clients/viewaccount-modal.vue").then(function(e){e.vuec.setInfo(t).show("查看账号信息")})},loginClient:function(t){this.$Modal.open("business/clients/login-modal.vue").then(function(e){e.vuec.setInfo(t).show("登录客户系统")})},resetSearch:function(){this.$form("ref_search").reset(),this.init_data()},exesql:function(t){this.$Modal.open("business/clients/exesql-modal.vue").then(function(e){e.vuec.setInfo(t).show("运行SQL")})},deleteClient:function(t){var e=this;this.confirm("确定要删除客户【"+t.client_name+"】吗?").then(function(){e.$rest("clients").delete(t.cid).confirmed(function(){e.$Spin.show()}).success(function(t){e.$Spin.hide(),e.$Message.success("删除成功!"),e.init_data()}).error(function(t){e.$Message.error(t.message)})})},resetDb:function(t){var e=this;this.confirm("确定要将客户【"+t.client_name+"】的数据库恢复出厂吗?").then(function(){e.$Spin.show(),e.$rest("clients").add_url_param(t.cid,"doresetdb").post(t).success(function(t){e.$Spin.hide(),e.$Message.success("恢复出厂成功!"),e.init_data()}).error(function(t){e.$Spin.hide(),e.$Message.error(t.message)})})},frozen:function(t){var e=this;this.$Modal.open("business/clients/frozen-modal.vue",{on:{"on-frozen":function(){e.init_data()}}}).then(function(e){e.vuec.setInfo(t).show("冻结账号:"+t.client_name,"add")})},unfrozen:function(t){var e=this;this.$Modal.open("business/clients/unfrozen-modal.vue",{on:{"on-unfrozen":function(){e.init_data()}}}).then(function(e){e.vuec.setInfo(t).show("解冻账号:"+t.client_name,"add")})},openUsers:function(t){this.$Modal.open("business/clients/users-modal.vue").then(function(e){e.set("info",t).show("所有员工账号:"+t.client_name)})},openOrgs:function(t){this.$Modal.open("business/clients/orgs-modal.vue").then(function(e){e.set("info",t).show("所有下属加盟商账号:"+t.client_name)})},hook_get_param:function(t){var e=i.a.copy(this.search_field);for(var n in e){var s=e[n],o=["account_num_limit","student_num_limit","branch_num_limit"];"expire_day"==n?","!=s&&s.length>0&&(t[n]=i.a.sprintf("[Between,%s]",s.join(","))):o.indexOf(n)>-1?s>0&&(t[n]=i.a.sprintf("[Between,0,%s]",s)):s&&(t[n]=s)}}}}},520:function(t,e,n){"use strict";var i=n(417),s=n(597),o=n(16),a=o(i.a,s.a,!1,null,null,null);a.options.__file="src/views/business/clients/list.vue",e.a=a.exports},591:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement;return(t._self._c||e)("list")},s=[];i._withStripped=!0;var o={render:i,staticRenderFns:s};e.a=o},597:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"c-grid"},[n("div",{staticClass:"box box-query"},[n("Form",{ref:"ref_search",staticClass:"filter-form row",attrs:{model:t.search_field,"label-width":70}},[n("Form-item",{staticClass:"col-md-3 col-sm-6",attrs:{label:"客户名",prop:"client_name"}},[n("Input",{attrs:{placeholder:"请输入客户名"},model:{value:t.search_field.client_name,callback:function(e){t.$set(t.search_field,"client_name",e)},expression:"search_field.client_name"}})],1),t._v(" "),n("Form-item",{staticClass:"col-md-3 col-sm-6",attrs:{label:"联系人",prop:"contact"}},[n("Input",{attrs:{placeholder:"请输入联系人名"},model:{value:t.search_field.contact,callback:function(e){t.$set(t.search_field,"contact",e)},expression:"search_field.contact"}})],1),t._v(" "),n("Form-item",{staticClass:"col-md-3 col-sm-6",attrs:{label:"联系地址",prop:"address"}},[n("Input",{attrs:{placeholder:"请输入联系地址"},model:{value:t.search_field.address,callback:function(e){t.$set(t.search_field,"address",e)},expression:"search_field.address"}})],1),t._v(" "),n("Form-item",{staticClass:"col-md-3 col-sm-6",attrs:{label:"联系电话",prop:"tel"}},[n("Input",{attrs:{placeholder:"请输入联系电话"},model:{value:t.search_field.tel,callback:function(e){t.$set(t.search_field,"tel",e)},expression:"search_field.tel"}})],1),t._v(" "),t.searchExpand?[n("Form-item",{staticClass:"col-md-3 col-sm-6",attrs:{label:"到期日期",prop:"expire_day"}},[n("date-range-picker",{staticStyle:{width:"100%"},attrs:{label:"选择日期",placement:"bottom"},on:{"on-change":t.init_data},model:{value:t.search_field.expire_day,callback:function(e){t.$set(t.search_field,"expire_day",e)},expression:"search_field.expire_day"}})],1),t._v(" "),n("Form-item",{staticClass:"col-md-3 col-sm-6",attrs:{label:"版本号",prop:"current_version"}},[n("Input",{attrs:{placeholder:"请输入版本号"},model:{value:t.search_field.current_version,callback:function(e){t.$set(t.search_field,"current_version",e)},expression:"search_field.current_version"}})],1)]:t._e()],2),t._v(" "),n("Row",{staticClass:"basic"},[n("Col",{staticClass:"mt-2",attrs:{span:"24"}},[n("Button-group",[n("Button",{staticClass:"ml-2",attrs:{type:"primary",icon:"ios-search"},on:{click:t.init_data}},[t._v("查询")]),t._v(" "),n("Button",{attrs:{type:"primary",icon:t.toggleSearchIcon},on:{click:t.toggleSearch}})],1),t._v(" "),n("Button",{attrs:{type:"primary",icon:"refresh"},on:{click:t.resetSearch}},[t._v("重置")])],1)],1)],1),t._v(" "),n("div",{staticClass:"box box-result"},[n("div",{staticClass:"toolbar"},[n("Button",{directives:[{name:"per",rawName:"v-per",value:"clients.add",expression:"'clients.add'"}],attrs:{type:"primary",icon:"plus"},on:{click:t.addInfo}},[t._v("添加客户")]),t._v(" "),n("filter-column",{attrs:{keys:t.column_keys}})],1),t._v(" "),n("div",{staticClass:"content"},[n("div",{staticClass:"content-body"},[n("Table",{directives:[{name:"loading",rawName:"v-loading",value:"clients",expression:"'clients'"}],ref:"tableExcel",attrs:{"page-size":t.pageSize,page:t.pageIndex,border:!1,stripe:!0,"show-header":!0,data:t.data,columns:t.columns,"no-data-text":t.$store.state.config.EMPTY_DATA_TEXT,"no-filtered-data-text":t.$store.state.config.EMPTY_FILTER_DATA_TEXT},on:{"on-sort-change":t.sortChange}})],1),t._v(" "),n("div",{staticClass:"content-footer"},[n("div",{staticClass:"pagenation"},[n("Page",{attrs:{total:t.total,current:t.pageIndex,"show-sizer":!0,"page-size":t.pageSize,"show-total":!0},on:{"on-change":t.pagenation,"on-page-size-change":t.pagesize}})],1)])])])])},s=[];i._withStripped=!0;var o={render:i,staticRenderFns:s};e.a=o}});