webpackJsonp([20],{305:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(419),a=i(565),s=i(16),o=s(n.a,a.a,!1,null,null,null);o.options.__file="src/views/business/clients/orgs-modal.vue",e.default=o.exports},331:function(t,e,i){"use strict";e.a={name:"filterColumn",props:{keys:{type:Object,default:function(){return{}}}}}},332:function(t,e,i){"use strict";function n(t,e){var i=[];for(var n in this.operation_keys){var a=this.operation_keys[n],s=[],o=void 0,r=!0;a.per&&s.push({name:"per",value:a.per,expression:"",arg:"display",modifiers:{}}),a.condition&&(c.b.isString(a.condition)?o=new Function("row","params","return "+a.condition):c.b.isFunction(condition)&&(o=condition),c.b.isFunction(o)&&(o(e.row,e)||(r=!1))),c.b.isFunction(this.operation_func[n])&&!1!==a.show&&r&&i.push(t("Dropdown-item",{nativeOn:{click:this.operation_func[n].bind(this,e)},directives:s},[t("Icon",{props:{type:a.type}})," ",a.title]))}return t("div",[t("Dropdown",{props:{placement:"bottom-start",trigger:"click"}},[t("Button",{props:{type:"primary",size:"small"}},["操作"," ",t("Icon",{props:{type:"arrow-down-b"}})]),t("Dropdown-menu",{slot:"list"},i)])])}var a=i(49),s=i.n(a),o=i(13),r=i.n(o),c=(i(21),i(201),i(5)),d=i(335),l={int_day:function(t,e){return this.$filter("int_date")(e.row.int_day)}};e.a={components:{FilterColumn:d.a},data:function(){return{imgView:!1,bigImage:"",loading:!1,rest_api:"",searchExpand:!1,params:{search_field:"name",search_value:"",order_field:"",order_sort:"",last_search_value:"",bid:""},data:[],modal:{title:"",action:"add",show:!1},total:0,pageIndex:1,pageSize:10,init_page_size:0,bigPageSizeOption:[10,20,40,60,80,100],showCheckbox:!1,showIndex:!0,column_keys:{},column_render:{},operation_keys:{},operation_func:{},column_operation_text:"操作"}},methods:{sortChange:function(t){this.params.order_field=t.key,this.params.order_sort=t.order,this.init_data()},pagenation:function(t){this.pageIndex=t,this.init_data()},pagesize:function(t){if(this.pageSize=t,0==this.init_page_size)return void(this.init_page_size=1);this.init_data()},toggleSearch:function(){this.searchExpand=!this.searchExpand},search:function(){this.pagenation(1)},resetSearch:function(){this.params.search_value="",this.init_data()},init_data:function(){var t=this;if(this.loading)return!1;if(""!=this.rest_api){var e={};e.page=this.pageIndex,e.pagesize=this.pageSize,""!=this.params.search_value?(e.search_field=this.params.search_field,e.search_value=this.params.search_value,this.params.last_search_value=this.params.search_value):this.params.last_search_value="",""!=this.params.order_field&&(e.order_field=this.params.order_field,e.order_sort=this.params.order_sort),this.hook_get_param(e);for(var i in e)null===e[i]&&delete e[i];var n=this.rest_api;-1!==this.rest_api.indexOf("/:")&&(n=this.replace_rest_api(this.rest_api,e)),this.loading=!0,this.$rest(n).get(e).success(function(i){t.params=c.a.copy(e),t.data=t.deal_data(i),t.total=i.total,t.pageSize=parseInt(i.pagesize),t.loading=!1}).error(function(e){t.loading=!1})}},replace_rest_api:function(t,e){if(t.match(/:([^\/]+)\//)){var i=RegExp.$1;void 0!==e[i]&&(t=t.replace(":"+i,e[i]))}return t},hook_get_param:function(t){},deal_data:function(t){return t.list},check:function(){var t=this;return new r.a(function(e,i){t.$refs["form_"+t.datakey].validate(function(t){t?e():i()})})},add:function(){this.modal.action="add",this.modal.title="添加"+this.res_name,this.modal.show=!0,this[this.datakey][this.pk]=null},edit:function(t){this.rest_id=t[this.pk],s()(this[this.datakey],t),this.modal.action="edit",this.modal.title="编辑"+this.res_name,this.modal.show=!0},save:function(){var t=this;return new r.a(function(e,i){var n=t.rest_api,a=t[t.datakey];t.check().then(function(){var s="add"==t.modal.action?"post":"put",o=(t.modal.action,t.$rest(n));"add"!=t.modal.action&&o.add_url_param(t.rest_id),o[s](a).success(function(i){t.close(),t.init_data(),e(i)}).error(function(e){t.$Message.error(e.body.message),i(e)})})})},close:function(){this.modal.show=!1},delete:function(t){var e=this;return new r.a(function(i,n){e.$rest(e.rest_api).delete(t[e.pk]).success(function(t,n){e.init_data(),i(t)}).error(function(t,i){e.$Message.error(t.body.message),n(t)})})},do:function(t,e,i){var n=this;return new r.a(function(a,s){n.$rest(n.rest_api).add_url_param(e[n.pk],"do"+t).post(i).success(function(t){n.init_data(),a(t)}).error(function(t){n.$Message.error(t.body.message),s(t)})})},confirm:function(t){var e=this;return new r.a(function(i,n){e.$Modal.confirm({content:t||"您确定要进行删除操作吗?",onOk:function(){i()},onCancel:function(){n()}})})},fixLeft:function(){return this.data.length>0&&"left"},fixRight:function(){return this.data.length>0&&"right"},exportCSV:function(t,e){this.$refs[e].exportCsv({filename:t})},view_img:function(t){this.imgView=!0,this.bigImage=t}},computed:{toggleSearchIcon:function(){return this.searchExpand?"chevron-up":"chevron-down"},export_params:function(){var t={};t.page=this.pageIndex,t.pagesize=this.pageSize,""!=this.params.search_value&&(t[this.params.search_field]=this.params.search_value),this.hook_get_param(t);for(var e in t)null===t[e]&&delete t[e];return t},columns_head:function(){var t=[];return this.showCheckbox&&t.push({type:"selection",width:60,align:"center"}),this.showIndex&&t.push({type:"index",width:60,align:"center"}),t},columns:function(){var t=[],e={},i=this.column_render;s()(t,this.columns_head);for(var a in this.column_keys){var o=this.column_keys[a];if(void 0===o.show&&(o.show=!0),void 0===o.disabled&&(o.disabled=!1),o.show){var r=s()({key:a},o);i[a]?r.render=i[a].bind(this):l[a]&&(r.render=l[a].bind(this)),t.push(r)}}if(c.b.isEmpty(this.operation_btn)||(e.key="operation",e.title=this.column_operation_text,e.width=80,e.render=this.operation_btn.operation.bind(this),t.push(e)),c.b.isEmpty(this.operation_keys)||(e.key="operation",e.title=this.column_operation_text,e.width=80,e.render=n.bind(this),t.unshift(e)),!c.b.isEmpty(this.expand_render)){var d={};d.type="expand",d.width=50,d.render=this.expand_render.expand.bind(this),t.unshift(d)}return t},upload_header:function(){return{"x-token":this.$store.state.user.token,"x-file-key":"file"}},upload_post:function(){return{mod:"attachment_file"}}},watch:{}}},334:function(t,e){},335:function(t,e,i){"use strict";function n(t){o||i(334)}var a=i(331),s=i(336),o=!1,r=i(16),c=n,d=r(a.a,s.a,!1,c,null,null);d.options.__file="src/views/components/FilterColumn.vue",e.a=d.exports},336:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-column"},[i("Dropdown",{attrs:{placement:"bottom-end"}},[i("Button",{attrs:{type:"primary"}},[t._v("\r\n    \t\t选择列\r\n            "),i("Icon",{attrs:{type:"funnel"}})],1),t._v(" "),i("Dropdown-menu",{attrs:{slot:"list"},slot:"list"},t._l(t.keys,function(e){return i("Dropdown-item",[i("Checkbox",{nativeOn:{click:function(t){t.stopPropagation(),e.show=e.show}},model:{value:e.show,callback:function(i){t.$set(e,"show",i)},expression:"item.show"}},[t._v(t._s(e.title))])],1)}))],1)],1)},a=[];n._withStripped=!0;var s={render:n,staticRenderFns:a};e.a=s},419:function(t,e,i){"use strict";var n=i(5),a=i(0),s=(i.n(a),i(332)),o=i(198),r=i(200),c=i(199);e.a={mixins:[c.a,o.a,r.a,s.a],components:{},data:function(){return{rest_api:"clients/:cid/orgs",pk:"uid",search_field:{host:"",org_name:"",create_time:""},info:{},column_keys:{og_id:{title:"og_id",show:!0},host:{title:"域名",show:!0},org_name:{title:"机构名称",show:!0},student_num_limit:{title:"学员数限制",show:!0},create_time:{title:"创建日期",show:!0}},column_render:{host:function(t,e){var i=this;return t("a",{attrs:{class:"link",href:"javascript:;"},on:{click:function(){i.tklogin(e.row)}}},e.row.host)}},operation_keys:{},operation_func:{}}},methods:{onModalOpen:function(){this.init_data()},cancel:function(){this.close(),this.info={}},hook_get_param:function(t){var e=n.a.copy(this.search_field);for(var i in e){var a=e[i];"create_time"==i?","!=a&&a.length>0&&(t[i]=n.a.sprintf("[Between,%s]",a.join(","))):a&&(t[i]=a)}t.cid=this.info.cid},tklogin:function(t){var e={};e.cid=this.info.cid,e.og_id=t.og_id,e.uid=t.user.uid,this.$Modal.open("business/clients/login-modal.vue").then(function(t){t.vuec.setInfo(e).show("登录客户系统")})}}}},565:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{"mask-closable":!1,title:t.modal$.title,width:"750"},on:{"on-cancel":t.cancel},model:{value:t.modal$.show,callback:function(e){t.$set(t.modal$,"show",e)},expression:"modal$.show"}},[i("div",{staticClass:"box box-result"},[i("div",{staticClass:"toolbar"},[i("filter-column",{attrs:{keys:t.column_keys}})],1),t._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"content-body"},[i("Table",{directives:[{name:"loading",rawName:"v-loading.like",value:"/orgs",expression:"'/orgs'",modifiers:{like:!0}}],ref:"tableExcel",attrs:{"page-size":t.pageSize,page:t.pageIndex,border:!1,stripe:!0,"show-header":!0,data:t.data,columns:t.columns,"no-data-text":t.$store.state.config.EMPTY_DATA_TEXT,"no-filtered-data-text":t.$store.state.config.EMPTY_FILTER_DATA_TEXT},on:{"on-sort-change":t.sortChange}})],1),t._v(" "),i("div",{staticClass:"content-footer"},[i("div",{staticClass:"pagenation"},[i("Page",{attrs:{total:t.total,current:t.pageIndex,"show-sizer":!0,"page-size":t.pageSize,"show-total":!0},on:{"on-change":t.pagenation,"on-page-size-change":t.pagesize}})],1)])])]),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"})])},a=[];n._withStripped=!0;var s={render:n,staticRenderFns:a};e.a=s}});