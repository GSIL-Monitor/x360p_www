webpackJsonp([12],{312:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(426),s=i(614),r=i(16),a=r(n.a,s.a,!1,null,null,null);a.options.__file="src/views/business/versions.vue",e.default=a.exports},331:function(t,e,i){"use strict";e.a={name:"filterColumn",props:{keys:{type:Object,default:function(){return{}}}}}},332:function(t,e,i){"use strict";function n(t,e){var i=[];for(var n in this.operation_keys){var s=this.operation_keys[n],r=[],a=void 0,o=!0;s.per&&r.push({name:"per",value:s.per,expression:"",arg:"display",modifiers:{}}),s.condition&&(c.b.isString(s.condition)?a=new Function("row","params","return "+s.condition):c.b.isFunction(condition)&&(a=condition),c.b.isFunction(a)&&(a(e.row,e)||(o=!1))),c.b.isFunction(this.operation_func[n])&&!1!==s.show&&o&&i.push(t("Dropdown-item",{nativeOn:{click:this.operation_func[n].bind(this,e)},directives:r},[t("Icon",{props:{type:s.type}})," ",s.title]))}return t("div",[t("Dropdown",{props:{placement:"bottom-start",trigger:"click"}},[t("Button",{props:{type:"primary",size:"small"}},["操作"," ",t("Icon",{props:{type:"arrow-down-b"}})]),t("Dropdown-menu",{slot:"list"},i)])])}var s=i(49),r=i.n(s),a=i(13),o=i.n(a),c=(i(21),i(201),i(5)),u=i(335),d={int_day:function(t,e){return this.$filter("int_date")(e.row.int_day)}};e.a={components:{FilterColumn:u.a},data:function(){return{imgView:!1,bigImage:"",loading:!1,rest_api:"",searchExpand:!1,params:{search_field:"name",search_value:"",order_field:"",order_sort:"",last_search_value:"",bid:""},data:[],modal:{title:"",action:"add",show:!1},total:0,pageIndex:1,pageSize:10,init_page_size:0,bigPageSizeOption:[10,20,40,60,80,100],showCheckbox:!1,showIndex:!0,column_keys:{},column_render:{},operation_keys:{},operation_func:{},column_operation_text:"操作"}},methods:{sortChange:function(t){this.params.order_field=t.key,this.params.order_sort=t.order,this.init_data()},pagenation:function(t){this.pageIndex=t,this.init_data()},pagesize:function(t){if(this.pageSize=t,0==this.init_page_size)return void(this.init_page_size=1);this.init_data()},toggleSearch:function(){this.searchExpand=!this.searchExpand},search:function(){this.pagenation(1)},resetSearch:function(){this.params.search_value="",this.init_data()},init_data:function(){var t=this;if(this.loading)return!1;if(""!=this.rest_api){var e={};e.page=this.pageIndex,e.pagesize=this.pageSize,""!=this.params.search_value?(e.search_field=this.params.search_field,e.search_value=this.params.search_value,this.params.last_search_value=this.params.search_value):this.params.last_search_value="",""!=this.params.order_field&&(e.order_field=this.params.order_field,e.order_sort=this.params.order_sort),this.hook_get_param(e);for(var i in e)null===e[i]&&delete e[i];var n=this.rest_api;-1!==this.rest_api.indexOf("/:")&&(n=this.replace_rest_api(this.rest_api,e)),this.loading=!0,this.$rest(n).get(e).success(function(i){t.params=c.a.copy(e),t.data=t.deal_data(i),t.total=i.total,t.pageSize=parseInt(i.pagesize),t.loading=!1}).error(function(e){t.loading=!1})}},replace_rest_api:function(t,e){if(t.match(/:([^\/]+)\//)){var i=RegExp.$1;void 0!==e[i]&&(t=t.replace(":"+i,e[i]))}return t},hook_get_param:function(t){},deal_data:function(t){return t.list},check:function(){var t=this;return new o.a(function(e,i){t.$refs["form_"+t.datakey].validate(function(t){t?e():i()})})},add:function(){this.modal.action="add",this.modal.title="添加"+this.res_name,this.modal.show=!0,this[this.datakey][this.pk]=null},edit:function(t){this.rest_id=t[this.pk],r()(this[this.datakey],t),this.modal.action="edit",this.modal.title="编辑"+this.res_name,this.modal.show=!0},save:function(){var t=this;return new o.a(function(e,i){var n=t.rest_api,s=t[t.datakey];t.check().then(function(){var r="add"==t.modal.action?"post":"put",a=(t.modal.action,t.$rest(n));"add"!=t.modal.action&&a.add_url_param(t.rest_id),a[r](s).success(function(i){t.close(),t.init_data(),e(i)}).error(function(e){t.$Message.error(e.body.message),i(e)})})})},close:function(){this.modal.show=!1},delete:function(t){var e=this;return new o.a(function(i,n){e.$rest(e.rest_api).delete(t[e.pk]).success(function(t,n){e.init_data(),i(t)}).error(function(t,i){e.$Message.error(t.body.message),n(t)})})},do:function(t,e,i){var n=this;return new o.a(function(s,r){n.$rest(n.rest_api).add_url_param(e[n.pk],"do"+t).post(i).success(function(t){n.init_data(),s(t)}).error(function(t){n.$Message.error(t.body.message),r(t)})})},confirm:function(t){var e=this;return new o.a(function(i,n){e.$Modal.confirm({content:t||"您确定要进行删除操作吗?",onOk:function(){i()},onCancel:function(){n()}})})},fixLeft:function(){return this.data.length>0&&"left"},fixRight:function(){return this.data.length>0&&"right"},exportCSV:function(t,e){this.$refs[e].exportCsv({filename:t})},view_img:function(t){this.imgView=!0,this.bigImage=t}},computed:{toggleSearchIcon:function(){return this.searchExpand?"chevron-up":"chevron-down"},export_params:function(){var t={};t.page=this.pageIndex,t.pagesize=this.pageSize,""!=this.params.search_value&&(t[this.params.search_field]=this.params.search_value),this.hook_get_param(t);for(var e in t)null===t[e]&&delete t[e];return t},columns_head:function(){var t=[];return this.showCheckbox&&t.push({type:"selection",width:60,align:"center"}),this.showIndex&&t.push({type:"index",width:60,align:"center"}),t},columns:function(){var t=[],e={},i=this.column_render;r()(t,this.columns_head);for(var s in this.column_keys){var a=this.column_keys[s];if(void 0===a.show&&(a.show=!0),void 0===a.disabled&&(a.disabled=!1),a.show){var o=r()({key:s},a);i[s]?o.render=i[s].bind(this):d[s]&&(o.render=d[s].bind(this)),t.push(o)}}if(c.b.isEmpty(this.operation_btn)||(e.key="operation",e.title=this.column_operation_text,e.width=80,e.render=this.operation_btn.operation.bind(this),t.push(e)),c.b.isEmpty(this.operation_keys)||(e.key="operation",e.title=this.column_operation_text,e.width=80,e.render=n.bind(this),t.unshift(e)),!c.b.isEmpty(this.expand_render)){var u={};u.type="expand",u.width=50,u.render=this.expand_render.expand.bind(this),t.unshift(u)}return t},upload_header:function(){return{"x-token":this.$store.state.user.token,"x-file-key":"file"}},upload_post:function(){return{mod:"attachment_file"}}},watch:{}}},334:function(t,e){},335:function(t,e,i){"use strict";function n(t){a||i(334)}var s=i(331),r=i(336),a=!1,o=i(16),c=n,u=o(s.a,r.a,!1,c,null,null);u.options.__file="src/views/components/FilterColumn.vue",e.a=u.exports},336:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-column"},[i("Dropdown",{attrs:{placement:"bottom-end"}},[i("Button",{attrs:{type:"primary"}},[t._v("\r\n    \t\t选择列\r\n            "),i("Icon",{attrs:{type:"funnel"}})],1),t._v(" "),i("Dropdown-menu",{attrs:{slot:"list"},slot:"list"},t._l(t.keys,function(e){return i("Dropdown-item",[i("Checkbox",{nativeOn:{click:function(t){t.stopPropagation(),e.show=e.show}},model:{value:e.show,callback:function(i){t.$set(e,"show",i)},expression:"item.show"}},[t._v(t._s(e.title))])],1)}))],1)],1)},s=[];n._withStripped=!0;var r={render:n,staticRenderFns:s};e.a=r},342:function(t,e,i){t.exports={default:i(345),__esModule:!0}},344:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var s=i(348),r=n(s),a=i(342),o=n(a);e.default=function(){function t(t,e){var i=[],n=!0,s=!1,r=void 0;try{for(var a,c=(0,o.default)(t);!(n=(a=c.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){s=!0,r=t}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},345:function(t,e,i){i(51),i(50),t.exports=i(346)},346:function(t,e,i){var n=i(7),s=i(203);t.exports=i(1).getIterator=function(t){var e=s(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},348:function(t,e,i){t.exports={default:i(349),__esModule:!0}},349:function(t,e,i){i(51),i(50),t.exports=i(350)},350:function(t,e,i){var n=i(52),s=i(2)("iterator"),r=i(17);t.exports=i(1).isIterable=function(t){var e=Object(t);return void 0!==e[s]||"@@iterator"in e||r.hasOwnProperty(n(e))}},426:function(t,e,i){"use strict";var n=(i(5),i(332)),s=i(198),r=i(200),a=i(522);e.a={mixins:[n.a,s.a,r.a],components:{infoModal:a.a},data:function(){return{rest_api:"versions",pk:"vid"}},mounted:function(){this.init_data()},methods:{addInfo:function(){this.$r("info").show("发布新版本","add")},del:function(t){var e=this;this.confirm("您确定要删除该版本"+t.ver+"吗?").then(function(){e.dodel(t)})},dodel:function(t){var e=this;this.$rest("versions").delete(t.vid).success(function(t){e.init_data()}).error(function(t){e.$Message.error(t.message)})}}}},427:function(t,e,i){"use strict";var n=i(344),s=i.n(n),r=i(0),a=i.n(r),o=i(5),c=i(198),u=i(199),d=i(537),l={ver:"",content:"",publish_date:a()().format("YYYY-MM-DD")};e.a={mixins:[u.a,c.a],components:{Umeditor:d.a},data:function(){return{upgrade_status:"normal",step:0,info:o.a.copy(l),rules:{ver:[{required:!0,message:"请输入版本号",trigger:"blur"}],content:[{required:!0,message:"请输入版本描述",trigger:"blur"}]},clients:{total:0,upgraded:0,page:1,pagesize:10},logs:[]}},mounted:function(){this.init_clients()},computed:{upgrade_percent:function(){return 0==this.clients.total?0:100*this.clients.upgraded/this.clients.total}},methods:{init_clients:function(){var t=this;this.$rest("clients").get({is_db_install:1,parent_cid:0,cid:"[>,10]"}).success(function(e){t.clients.total=e.total})},prev:function(){this.step=0},next:function(){this.step=1},cancel:function(){this.info=o.a.copy(l),this.$form("form").reset(),this.close()},addversion:function(){var t=this;this.$form("form").check().then(function(){var e=t.modal$.action,i="add"==e?["post","versions","添加成功"]:["put","versions/"+t.info.cid,"修改成功"],n=s()(i,3),r=n[0],o=n[1],c=n[2];t.info.publish_date=a()(t.info.publish_date).format("YYYYMMDD"),t.$rest(o)[r](t.info).success(function(e){t.$Message.success(c),t.step=2}).error(function(e){t.$Notice.error({title:"失败",desc:e.body.message||"操作失败"})})})},upgrade:function(){var t=this,e=this.clients;this.upgrade_status="active",this.$rest("versions").add_url_param(0,"batupgrade").get({version:this.info.ver,page:e.page,pagesize:e.pagesize}).success(function(i){i.logs&&i.logs.forEach(function(e){t.logs.push(e)}),t.clients.upgraded+=i.count,i.count<e.pagesize?(t.upgrade_status="normal",t.step=3,t.$emit("on-success")):(t.clients.page++,t.upgrade())})}}}},442:function(t,e,i){"use strict";function n(t){return t.replace("{{bs.qrcode}}",a)}var s=i(49),r=i.n(s),a='<img qrcode="true" src="/static/img/mpqr.jpg" height="110px" width="110px"/>';e.a={name:"Umeditor",props:{value:{type:String,default:""},umeditorPath:{type:String,default:"/static/umeditor/"},config:{type:Object,default:function(){return{}}},toolbar:{type:Array,default:function(){return[]}}},data:function(){return{um:null,domId:"J_UMeditor",defaultToolbar:["source","|"," undo redo","|"," bold italic underline strikethrough horizontal","|"," forecolor backcolor","|","insertorderedlist insertunorderedlist","|","paragraph fontfamily fontsize","|","justifyleft justifycenter justifyright justifyjustify","|","link unlink","|"," removeformat","|","image"],defaultConfig:{imageUrl:"",zIndex:1050,initialFrameWidth:"100%",initialFrameHeight:200,autoClearinitialContent:!0},scriptTagStatus:0}},created:function(){void 0!==window.UM?(this.scriptTagStatus=2,this.init()):this.insertScriptTag()},methods:{insertScriptTag:function(){var t=this,e=document.getElementById("editorScriptTag"),i=document.getElementById("configScriptTag"),n=document.getElementById("editorCssTag");if(null===e){n=document.createElement("link"),n.type="text/css",n.rel="stylesheet",n.href=this.umeditorPath+"themes/default/css/umeditor.min.css",i=document.createElement("script"),i.type="text/javascript",i.src=this.umeditorPath+"umeditor.config.js",i.id="umconfigScriptTag",e=document.createElement("script"),e.type="text/javascript",e.src=this.umeditorPath+"umeditor.min.js",e.id="umeditorScriptTag";var s=document.getElementsByTagName("head")[0];s.appendChild(n),s.appendChild(i),s.appendChild(e)}i.loaded?this.scriptTagStatus++:i.addEventListener("load",function(){t.scriptTagStatus++,i.loaded=!0}),e.loaded?this.scriptTagStatus++:e.addEventListener("load",function(){t.scriptTagStatus++,e.loaded=!0,t.init()})},init:function(){var t=this;this.domId=this.getUID(this.domId);var e={};this.defaultConfig.imageUrl=this.serverUrl,r()(e,this.defaultConfig,this.config),e.toolbar=this.toolbar.length>0?this.toolbar:this.defaultToolbar,this.$nextTick(function(){t.initEditor(t.domId,e)})},initEditor:function(t,e){this.um=window.UM.getEditor(t,e),this.bind()},bind:function(){var t=this;this.um.ready(function(){t.um.setContent(t.value)}),this.um.addListener("contentChange",function(){var e=t.getContent();-1!==e.indexOf("{{bs.qrcode}}")&&(e=n(e),t.um.setContent(e)),t.$emit("input",e)})},getUID:function(t){do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},reset:function(){this.um.reset(),this.um.setContent("")},destroy:function(){this.um.destroy()},setContent:function(t){this.um.setContent(t)},getContent:function(){return this.um.getContent()},droptext:function(t){"{{bs.qrcode}}"==t.dataTransfer.getData("text")&&($(t.target).append(a),t.preventDefault())}},watch:{value:function(t){t!=this.getContent()&&this.um.setContent(t)}},computed:{serverUrl:function(){return"/admapi/umeditor?token="+this.$store.state.user.token}}}},503:function(t,e){},522:function(t,e,i){"use strict";function n(t){a||i(503)}var s=i(427),r=i(560),a=!1,o=i(16),c=n,u=o(s.a,r.a,!1,c,null,null);u.options.__file="src/views/business/versions/info-modal.vue",e.a=u.exports},537:function(t,e,i){"use strict";var n=i(442),s=i(582),r=i(16),a=r(n.a,s.a,!1,null,null,null);a.options.__file="src/views/components/UmEditor.vue",e.a=a.exports},560:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{title:t.modal$.title,width:"600","mask-closable":!1},model:{value:t.modal$.show,callback:function(e){t.$set(t.modal$,"show",e)},expression:"modal$.show"}},[i("Steps",{attrs:{current:t.step}},[i("Step",{attrs:{title:"上传相关文件"}}),t._v(" "),i("Step",{attrs:{title:"创建版本记录"}}),t._v(" "),i("Step",{attrs:{title:"批量更新客户版本号"}}),t._v(" "),i("Step",{attrs:{title:"发布完成"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:0==t.step,expression:"step==0"}],staticClass:"m-t"},[i("p",[i("strong",[t._v("FTP上传版本发布文件")])]),t._v(" "),i("code",[t._v("\n\t\t\tip:119.23.163.198"),i("br"),t._v("\n\t\t\tuser:ftp_x360p_release"),i("br"),t._v("\n\t\t\tpassword:LhSKEzPra6\n\t\t\t")]),t._v(" "),i("p",[i("strong",[t._v("目录结构")])]),t._v(" "),i("pre",[t._v("|- 0.5.1 \t\t\t\t\t\t------------ 版本名命名的文件夹\n\t|- ui                       ------------ ui文件夹\n\t\t|- pc                    ------------ 机构pc端前端文件目录   [可选]\n\t\t|- m                     ------------ 机构移动端前端文件目录 [可选]\n\t\t|- student               ------------ 家长移动端前端文件目录 [可选]\n\t|- sql                      ------------ sql文件目录\n\t\t|- init_structure.sql    ------------ 版本初始化数据库结构sql文件 [可选]\n\t\t|- init_data.sql         ------------ 版本初始化导入数据sql文件   [可选]\n\t\t|- patch.sql             ------------ 相对上一版本的SQL补丁文件   [可选]\n")]),t._v(" "),i("p",[t._v("注意：ui和sql目录必须存在,否则无法进行下一步发布，有的版本只更新了sql,可以不上传ui.反之也一样")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:1==t.step,expression:"step==1"}],staticClass:"m-t"},[i("Form",{ref:"form",attrs:{"label-width":70,model:t.info,rules:t.rules}},[i("Form-item",{attrs:{label:"版本号",prop:"ver"}},[i("Input",{attrs:{placeholder:"请输入"},model:{value:t.info.ver,callback:function(e){t.$set(t.info,"ver",e)},expression:"info.ver"}},[i("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("V")])])],1),t._v(" "),i("Form-item",{attrs:{label:"发布日期",prop:"publish_date"}},[i("DatePicker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:t.info.publish_date,callback:function(e){t.$set(t.info,"publish_date",e)},expression:"info.publish_date"}})],1),t._v(" "),i("Form-item",{attrs:{label:"描述",prop:"content"}},[i("umeditor",{model:{value:t.info.content,callback:function(e){t.$set(t.info,"content",e)},expression:"info.content"}})],1)],1)],1),t._v(" "),2==t.step?i("div",{staticClass:"m-t"},[i("p",[t._v("共 "+t._s(t.clients.total)+"家客户需要升级")]),t._v(" "),i("Progress",{attrs:{percent:t.upgrade_percent,status:t.upgrade_status}}),t._v(" "),i("Button",{attrs:{type:"primary",loading:t.saving},on:{click:t.upgrade}},[t._v("开始升级")])],1):t._e(),t._v(" "),3==t.step?i("div",{staticClass:"m-t"},[i("Alert",{attrs:{type:"success","show-icon":""}},[t._v("\n\t\t        批量升级完成\n\t\t        "),i("span",{attrs:{slot:"desc"},slot:"desc"},t._l(t.logs,function(e){return i("pre",[t._v("\t\t        \t"+t._s(e)+"\n\t\t        \t")])}))]),t._v(" "),i("Button",{attrs:{type:"primary"},on:{click:t.cancel}},[t._v("关闭")])],1):t._e(),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"ghost"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),i("Button",{directives:[{name:"show",rawName:"v-show",value:1==t.step,expression:"step==1"}],attrs:{type:"primary"},on:{click:t.prev}},[t._v("返回")]),t._v(" "),i("Button",{directives:[{name:"show",rawName:"v-show",value:0==t.step,expression:"step==0"}],attrs:{type:"primary"},on:{click:t.next}},[t._v("文件已上传")]),t._v(" "),i("Button",{directives:[{name:"show",rawName:"v-show",value:1==t.step,expression:"step==1"}],attrs:{type:"primary",loading:t.saving},on:{click:t.addversion}},[t._v("确定")])],1)],1)},s=[];n._withStripped=!0;var r={render:n,staticRenderFns:s};e.a=r},582:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{attrs:{id:t.domId},on:{drop:t.droptext}})},s=[];n._withStripped=!0;var r={render:n,staticRenderFns:s};e.a=r},614:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"c-grid"},[i("div",{staticClass:"box box-result"},[i("div",{staticClass:"toolbar"},[i("Button",{directives:[{name:"per",rawName:"v-per",value:"versions.add",expression:"'versions.add'"}],attrs:{type:"primary",icon:"plus"},on:{click:t.addInfo}},[t._v("发布新版本")])],1),t._v(" "),i("div",{staticClass:"content m-t b-t"},[i("Timeline",t._l(t.data,function(e){return i("TimelineItem",[i("p",{staticClass:"version-title"},[i("Tag",{attrs:{color:"blue"}},[t._v("V"+t._s(e.ver))]),t._v(" "),i("em",{staticClass:"date"},[i("Icon",{attrs:{type:"clock"}}),t._v(t._s(t._f("int_date")(e.publish_date)))],1)],1),t._v(" "),i("div",{staticClass:"version-content",domProps:{innerHTML:t._s(e.content)}}),t._v(" "),i("div",{staticClass:"version-button"},[i("Button",{directives:[{name:"per",rawName:"v-per",value:"versions.del",expression:"'versions.del'"}],attrs:{type:"primary"},on:{click:function(i){t.del(e)}}},[t._v("删除版本记录")])],1)])})),t._v(" "),0==t.data.length?i("div",{staticClass:"m-t empty"},[i("p",{staticClass:"text-center"},[t._v("暂时没有任何版本!")])]):t._e()],1)]),t._v(" "),i("info-modal",{ref:"info",on:{"on-success":t.init_data}})],1)},s=[];n._withStripped=!0;var r={render:n,staticRenderFns:s};e.a=r}});