webpackJsonp([177],{1153:function(t,e,s){"use strict";var o=s(1),a=s(211),l=s(209),i=s(937),n=s(942),r={sid:0,sex:"1",bid:0,student_name:"",nick_name:"",birth_time:"",school_id_text:"",school_id:0,school_grade:0,school_class:"",first_tel:"",first_family_rel:"",first_family_name:"",second_tel:"",second_family_rel:"",second_family_name:"",card_no:""};e.a={mixins:[l.a,a.a],components:{SelectSchool:i.a,RepeatTelStudent:n.a},data:function(){return{schools:[],show_all:!1,readonly1:!1,readonly2:!1,editSchool:!1,ps_id_cach:0,rel_list:[{value:1,text:"自己"},{value:2,text:"爸爸"},{value:3,text:"妈妈"},{value:4,text:"其他"}],info:o.b.copy(r),rules:{student_name:[{required:!0,message:"姓名不能为空",trigger:"blur"}],first_tel:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1\d{10}$/,message:"手机格式错误",trigger:"blur"}]},option_form_items:[]}},watch:{"modal$.show":function(t){t&&(this.readonly1=this.info.first_tel.length>0,this.readonly2=this.info.second_tel.length>0,this.editSchool=!0,this.show_all=!1,"add"==this.modal$.action?this.info=o.b.copy(r):this.ps_id_cach=this.info.school_id,this.buildOptionFormItems())}},computed:{isCheckedTel:function(){return"add"==this.modal$.action&&(!this.$refs.repeat||!this.$refs.repeat.isChecked)}},methods:{buildOptionFormItems:function(){this.option_form_items=[];for(var t=this.$store.state.gvars.configs.student_option_fields,e=this.info.option_fields||{},s=0;s<t.length;s++){var o=t[s];1==o.enable&&this.option_form_items.push({label:o.label,type:o.type,field:o.name,value:e[o.name]||function(t){return"number"==t?0:"date"==t?new Date:""}(o.type)})}},getOptionFieldsValue:function(){var t={};return this.option_form_items.forEach(function(e){t[e.field]=e.value}),t},cancel:function(){var t=this.$r("ref_select_school");this.$form("form").reset(),this.close(),void 0!=t&&t.resetSchoolName()},ok:function(){var t=this,e="post",s="students",o="添加成功";"edit"==this.modal$.action&&(e="put",s="students/"+this.info.sid,o="修改成功"),this.info.bid=this.bid$,this.info.option_fields=this.getOptionFieldsValue(),this.$form("form").check().then(function(a){t.$rest(s)[e](t.info).success(function(e){t.$Message.success(o),t.$emit("on-save-success"),t.cancel()}).error(function(e){t.$Message.error(e.body.message||"添加失败")})})},searchSelect:function(t){this.info.school_id=t.ps_id},clearSelect:function(){"add"==this.modal$.action?this.info.school_id=0:this.info.school_id=this.ps_id_cach},handleSearch:function(t){var e=this;this.$rest("public_schools?name="+t).get().success(function(t){e.schools=t.list}).error(function(t){e.$Message.error(t.body.message||"搜索失败！")})},undoEdit:function(){this.editSchool=!this.editSchool,this.info.school_id=this.ps_id_cach}}}},1237:function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],staticClass:"x-ivu-modal",attrs:{"mask-closable":!1,title:t.modal$.title,width:"850"},model:{value:t.modal$.show,callback:function(e){t.$set(t.modal$,"show",e)},expression:"modal$.show"}},[s("Form",{ref:"form",staticClass:"x-ivu-form row",attrs:{"label-width":100,model:t.info,rules:t.rules}},[s("Form-item",{staticClass:"col-sm-4",attrs:{label:"姓名",prop:"student_name"}},[s("Input",{attrs:{placeholder:"请输入学员姓名"},model:{value:t.info.student_name,callback:function(e){t.$set(t.info,"student_name",e)},expression:"info.student_name"}})],1),t._v(" "),s("Form-item",{staticClass:"col-sm-4",attrs:{label:"出生日期",prop:"birth_time"}},[s("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",value:t.info.birth_time,format:"yyyy-MM-dd",placeholder:"选择日期"},on:{"on-change":function(e){t.info.birth_time=e}}})],1),t._v(" "),s("Form-item",{staticClass:"col-sm-4 mb-2",attrs:{label:"卡号",prop:"card_no"}},[s("Input",{attrs:{placeholder:"请输入考勤卡号"},model:{value:t.info.card_no,callback:function(e){t.$set(t.info,"card_no",e)},expression:"info.card_no"}})],1),t._v(" "),s("Form-item",{staticClass:"col-sm-4",attrs:{label:"首选手机号",prop:"first_tel"}},[s("repeat-tel-student",{ref:"repeat",attrs:{readonly:t.readonly1,placeholder:"请输入手机号码"},model:{value:t.info.first_tel,callback:function(e){t.$set(t.info,"first_tel",e)},expression:"info.first_tel"}})],1),t._v(" "),s("Form-item",{staticClass:"col-sm-4",attrs:{label:"关系",prop:"first_family_rel"}},[s("Select",{model:{value:t.info.first_family_rel,callback:function(e){t.$set(t.info,"first_family_rel",e)},expression:"info.first_family_rel"}},t._l(t.rel_list,function(e,o){return s("Option",{key:o,attrs:{value:e.value}},[t._v(t._s(e.text))])}))],1),t._v(" "),1!=t.info.first_family_rel?s("Form-item",{staticClass:"col-sm-4",attrs:{label:"亲属姓名",prop:"first_family_name"}},[s("Input",{attrs:{placeholder:"请输入亲属姓名"},model:{value:t.info.first_family_name,callback:function(e){t.$set(t.info,"first_family_name",e)},expression:"info.first_family_name"}})],1):t._e(),t._v(" "),1==t.info.first_family_rel?s("div",{staticClass:"col-sm-4"}):t._e(),t._v(" "),s("p",{staticClass:"text-center col-sm-12 mb-3"},[s("a",{staticClass:"text-info",on:{click:function(e){t.show_all=!t.show_all}}},[t._v("\n\t\t\t\t"+t._s(t.show_all?"收起":"展开更多")+"\n\t\t\t\t"),s("Icon",{attrs:{type:t.show_all?"chevron-up":"chevron-down"}})],1)]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.show_all,expression:"show_all"}],staticClass:"row m-0"},[s("Form-item",{staticClass:"col-sm-4",attrs:{label:"昵称",prop:"nick_name"}},[s("Input",{attrs:{placeholder:"请输入昵称"},model:{value:t.info.nick_name,callback:function(e){t.$set(t.info,"nick_name",e)},expression:"info.nick_name"}})],1),t._v(" "),s("Form-item",{staticClass:"col-sm-4",attrs:{label:"性别",prop:"sex"}},[s("Radio-group",{attrs:{type:"button"},model:{value:t.info.sex,callback:function(e){t.$set(t.info,"sex",e)},expression:"info.sex"}},[s("Radio",{attrs:{label:"1"}},[t._v("男")]),t._v(" "),s("Radio",{attrs:{label:"2"}},[t._v("女")])],1)],1),t._v(" "),t.enable_vip?s("Form-item",{staticClass:"col-sm-4",attrs:{label:"会员等级",prop:"vip_level"}},[s("Select",{model:{value:t.info.vip_level,callback:function(e){t.$set(t.info,"vip_level",e)},expression:"info.vip_level"}},[s("Option",{attrs:{value:-1}},[t._v("非会员")]),t._v(" "),t._l(t.vip_level_config,function(e,o){return s("Option",{attrs:{value:o}},[t._v(t._s(e.name))])})],2)],1):s("div",{staticClass:"col-sm-4"}),t._v(" "),s("Form-item",{staticClass:"col-sm-4",attrs:{label:"第二电话",prop:"second_tel"}},[s("Input",{attrs:{placeholder:"请输入手机号码",readonly:t.readonly2},model:{value:t.info.second_tel,callback:function(e){t.$set(t.info,"second_tel",e)},expression:"info.second_tel"}})],1),t._v(" "),s("Form-item",{staticClass:"col-sm-4",attrs:{label:"关系",prop:"second_family_rel"}},[s("Select",{model:{value:t.info.second_family_rel,callback:function(e){t.$set(t.info,"second_family_rel",e)},expression:"info.second_family_rel"}},t._l(t.rel_list,function(e,o){return s("Option",{key:o,attrs:{value:e.value}},[t._v(t._s(e.text))])}))],1),t._v(" "),1==t.info.second_family_rel?s("div",{staticClass:"col-sm-4"}):t._e(),t._v(" "),1!=t.info.second_family_rel?s("Form-item",{staticClass:"col-sm-4",attrs:{label:"亲属姓名",prop:"second_family_name"}},[s("Input",{attrs:{placeholder:"请输入亲属姓名"},model:{value:t.info.second_family_name,callback:function(e){t.$set(t.info,"second_family_name",e)},expression:"info.second_family_name"}})],1):t._e(),t._v(" "),s("Form-item",{staticClass:"col-sm-4 mb-2",attrs:{label:"公立学校",prop:"school_id"}},[t.info.school_id_text&&t.editSchool?[s("span",[t._v(t._s(t.info.school_id_text))]),t._v(" "),s("Button",{attrs:{size:"small",shape:"circle",icon:"edit"},on:{click:function(e){t.editSchool=!t.editSchool}}})]:[s("select-school",{ref:"ref_select_school",on:{"on-select":t.searchSelect,"on-clear":t.clearSelect}}),t._v(" "),s("Button",{directives:[{name:"show",rawName:"v-show",value:t.info.school_id_text,expression:"info.school_id_text"}],attrs:{size:"small",shape:"circle",icon:"reply"},on:{click:t.undoEdit}})]],2),t._v(" "),s("Form-item",{staticClass:"col-sm-4",attrs:{label:"年级",prop:"school_grade"}},[s("Select",{model:{value:t.info.school_grade,callback:function(e){t.$set(t.info,"school_grade",e)},expression:"info.school_grade"}},[s("Option",{attrs:{value:0}},[t._v("请选择")]),t._v(" "),t._l(t.dicts("grade"),function(e,o){return s("Option",{key:o,attrs:{value:e.name}},[t._v(t._s(e.title))])})],2)],1),t._v(" "),s("Form-item",{staticClass:"col-sm-4 mb-2",attrs:{label:"班级",prop:"school_class"}},[s("Input",{attrs:{placeholder:"请输入班级名称"},model:{value:t.info.school_class,callback:function(e){t.$set(t.info,"school_class",e)},expression:"info.school_class"}})],1),t._v(" "),t._l(t.option_form_items,function(e){return["text"==e.type?s("Form-item",{staticClass:"col-sm-4",attrs:{label:e.label}},[s("Input",{attrs:{placeholder:"请输入"+e.label},model:{value:e.value,callback:function(s){t.$set(e,"value",s)},expression:"item.value"}})],1):t._e(),t._v(" "),"date"==e.type?s("Form-item",{staticClass:"col-sm-4",attrs:{label:e.label}},[s("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",value:e.value,format:"yyyy-MM-dd",placeholder:"选择日期"},on:{"on-change":function(t){e.value=t}}})],1):t._e(),t._v(" "),"number"==e.type?s("Form-item",{staticClass:"col-sm-4",attrs:{label:e.label}},[s("InputNumber",{model:{value:e.value,callback:function(s){t.$set(e,"value",s)},expression:"item.value"}})],1):t._e(),t._v(" "),"textarea"==e.type?s("Form-item",{staticClass:"col-sm-12",attrs:{label:e.label}},[s("Input",{attrs:{type:"textarea",placeholder:"请输入"+e.label},model:{value:e.value,callback:function(s){t.$set(e,"value",s)},expression:"item.value"}})],1):t._e()]})],2)],1),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"ghost",loading:t.saving},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),s("Button",{attrs:{type:"primary",loading:t.saving,disabled:t.isCheckedTel},on:{click:t.ok}},[t._v("确定")])],1)],1)},a=[];o._withStripped=!0;var l={render:o,staticRenderFns:a};e.a=l},358:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s(1153),a=s(1237),l=s(11),i=l(o.a,a.a,!1,null,null,null);i.options.__file="src/views/business/student/info-modal.vue",e.default=i.exports},667:function(t,e,s){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var a=s(674),l=o(a),i=s(212),n=o(i);e.default=function(){function t(t,e){var s=[],o=!0,a=!1,l=void 0;try{for(var i,r=(0,n.default)(t);!(o=(i=r.next()).done)&&(s.push(i.value),!e||s.length!==e);o=!0);}catch(t){a=!0,l=t}finally{try{!o&&r.return&&r.return()}finally{if(a)throw l}}return s}return function(e,s){if(Array.isArray(e))return e;if((0,l.default)(Object(e)))return t(e,s);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},674:function(t,e,s){t.exports={default:s(675),__esModule:!0}},675:function(t,e,s){s(36),s(27),t.exports=s(676)},676:function(t,e,s){var o=s(56),a=s(4)("iterator"),l=s(18);t.exports=s(2).isIterable=function(t){var e=Object(t);return void 0!==e[a]||"@@iterator"in e||l.hasOwnProperty(o(e))}},890:function(t,e,s){"use strict";var o=s(936);e.a={components:{infoModal:o.a},props:{},data:function(){return{school_name:""}},methods:{addInfo:function(){this.$refs.info.show("添加公立学校","add")},searchSelect:function(t){this.$emit("on-select",t)},resetSchoolName:function(){this.school_name=""}},computed:{public_schools:function(){var t=this.school_name,e=this.$store.state.gvars.public_schools;return/$\s*^/.test(t)?e:e.filter(function(e){return e.school_name.indexOf(t)>-1})}},watch:{school_name:function(t){""===t&&this.$emit("on-clear")}}}},891:function(t,e,s){"use strict";var o=s(667),a=s.n(o),l=s(1),i=s(209),n=s(211),r=s(210),c={province_id:0,city_id:0,district_id:0,area_id:0,areas_arr:[],school_name:""};e.a={mixins:[i.a,n.a,r.a],data:function(){return{info:l.b.copy(c),rules:{school_name:[{required:!0,message:"请输入校区名称",trigger:"blur"}],areas_arr:[{required:!0,type:"array",message:"请选择校区位置",trigger:"change"}]}}},methods:{cancel:function(){this.$form("form").reset(),this.info=l.b.copy(c),this.close()},ok:function(){var t=this;this.$form("form").check().then(function(){var e=t.modal$.action,s="add"==e?["post","public_schools","添加成功"]:["put","public_schools/"+t.info.ps_id,"编辑成功"],o=a()(s,3),l=o[0],i=o[1],n=o[2];t.$rest(i)[l](t.info).success(function(e){t.$store.dispatch("updateGlobalVar","public_schools"),t.$Message.success(n),t.$emit("on-success"),t.cancel()}).error(function(e){t.$Notice.error({title:"失败",desc:e.message||"添加失败"})})})}},computed:{branch_area:{get:function(){var t=[this.info.province_id,this.info.city_id,this.info.district_id];return this.info.areas_arr||t},set:function(t){this.info.province_id=t[0],this.info.city_id=t[1],this.info.district_id=t[2],this.info.area_id=t[2],this.info.areas_arr=t}}}}},892:function(t,e,s){"use strict";var o=s(211),a=s(209),l=s(210);e.a={mixins:[a.a,o.a,l.a],props:{readonly:{type:Boolean,default:!1},value:{type:String,default:""},placeholder:{type:String,default:"请输入手机号码"}},data:function(){return{model:this.value,dataList:[],temp_tel:"",isChecked:!1}},watch:{model:function(t){this.$emit("input",t),this.dispatch("FormItem","on-form-change",t)},value:function(t){this.model=t},isChecked:function(t){this.$emit("on-checked",t)}},created:function(){/^1\d{10}$/.test(this.value)&&(this.temp_tel=this.value,this.isChecked=!0)},methods:{inputBlur:function(){if(!this.readonly){var t=this.model;/^1\d{10}$/.test(t)&&this.temp_tel!=t&&(this.temp_tel=""),/^1\d{10}$/.test(t)&&this.temp_tel!=t&&this.getStudentsByTel()}},getTag:function(t){var e={color:"blue",label:"学员"};return t.cu_id?(e.color="green",e.label="客户"):t.mcl_id&&(e.color="yellow",e.label="市场名单"),e},getStudentsByTel:function(){var t=this,e="students/query_by_tel?tel="+this.model;this.$rest(e).get().success(function(e){t.dataList=e,e&&e.length?(t.isChecked=!1,t.show("发现手机号重复名单")):t.isChecked=!0}).error(function(e){t.$Message.error(e.body.message||"获取同名学员失败~")})},repeat:function(){this.temp_tel="",this.model="",this.isChecked=!1,this.close()},notRepeat:function(){this.temp_tel=this.model,this.isChecked=!0,this.close()}}}},936:function(t,e,s){"use strict";function o(t){i||s(939)}var a=s(891),l=s(940),i=!1,n=s(11),r=o,c=n(a.a,l.a,!1,r,null,null);c.options.__file="src/views/basic/school/info-modal.vue",e.a=c.exports},937:function(t,e,s){"use strict";function o(t){i||s(938)}var a=s(890),l=s(941),i=!1,n=s(11),r=o,c=n(a.a,l.a,!1,r,null,null);c.options.__file="src/views/basic/school/select-school.vue",e.a=c.exports},938:function(t,e){},939:function(t,e){},940:function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{attrs:{title:t.modal$.title,"mask-closable":!1,width:"680"},model:{value:t.modal$.show,callback:function(e){t.$set(t.modal$,"show",e)},expression:"modal$.show"}},[t.modal$.show?s("div",[s("Form",{ref:"form",attrs:{"label-width":80,model:t.info,rules:t.rules}},[s("Form-item",{attrs:{label:"学校名称",prop:"school_name"}},[s("Input",{attrs:{placeholder:"请输入校区名称"},model:{value:t.info.school_name,callback:function(e){t.$set(t.info,"school_name",e)},expression:"info.school_name"}})],1),t._v(" "),s("Form-item",{attrs:{label:"学校位置",prop:"areas_arr"}},[s("Cascader",{attrs:{trigger:"hover",data:t.areas},model:{value:t.branch_area,callback:function(e){t.branch_area=e},expression:"branch_area"}})],1),t._v(" "),s("Form-item",{attrs:{label:"详细地址",prop:"address"}},[s("Input",{attrs:{placeholder:"请输入详细地址"},model:{value:t.info.address,callback:function(e){t.$set(t.info,"address",e)},expression:"info.address"}})],1)],1)],1):t._e(),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"ghost"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),s("Button",{attrs:{type:"primary",loading:t.saving},on:{click:t.ok}},[t._v("确定")])],1)])},a=[];o._withStripped=!0;var l={render:o,staticRenderFns:a};e.a=l},941:function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"x-select-school"},[s("AutoComplete",{attrs:{clearable:"",placeholder:"请输入校区名称"},model:{value:t.school_name,callback:function(e){t.school_name=e},expression:"school_name"}},t._l(t.public_schools,function(e){return s("Option",{key:e.ps_id,attrs:{value:e.school_name},nativeOn:{click:function(s){t.searchSelect(e)}}},[s("span",{staticClass:"demo-auto-complete-title"},[t._v(t._s(e.school_name))])])})),t._v(" "),s("info-modal",{ref:"info"}),t._v(" "),s("Button",{directives:[{name:"per",rawName:"v-per",value:"schools.add",expression:"'schools.add'"}],attrs:{slot:"append",icon:"plus",title:"添加公立学校"},on:{click:t.addInfo},slot:"append"})],1)},a=[];o._withStripped=!0;var l={render:o,staticRenderFns:a};e.a=l},942:function(t,e,s){"use strict";function o(t){i||s(943)}var a=s(892),l=s(944),i=!1,n=s(11),r=o,c=n(a.a,l.a,!1,r,null,null);c.options.__file="src/views/components/RepeatTelStudent.vue",e.a=c.exports},943:function(t,e){},944:function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("Input",{attrs:{readonly:t.readonly,placeholder:t.placeholder},on:{"on-blur":t.inputBlur},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}}),t._v(" "),s("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{title:t.modal$.title,"mask-closable":!1,width:800},on:{"on-close":t.notRepeat},model:{value:t.modal$.show,callback:function(e){t.$set(t.modal$,"show",e)},expression:"modal$.show"}},[t.modal$.show?s("table",{staticClass:"modal-table"},[s("thead",[s("th",[s("div",{staticClass:"ivu-table-cell"},[t._v("姓名")])]),t._v(" "),s("th",[s("div",{staticClass:"ivu-table-cell"},[t._v("性别")])]),t._v(" "),s("th",[s("div",{staticClass:"ivu-table-cell"},[t._v("手机号")])]),t._v(" "),s("th",[s("div",{staticClass:"ivu-table-cell"},[t._v("所属校区")])]),t._v(" "),s("th",[s("div",{staticClass:"ivu-table-cell"},[t._v("录入时间")])])]),t._v(" "),t._l(t.dataList,function(e,o){return s("tr",{key:o},[s("td",[s("div",{staticClass:"ivu-table-cell"},[s("tag",{attrs:{color:t.getTag(e).color}},[t._v(t._s(t.getTag(e).label))]),t._v(" "),e.sid?s("span",[t._v(t._s(e.student_name))]):s("span",[t._v(t._s(e.name))])],1)]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(1==e.sex?"男":"女"))])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[e.mcl_id?s("span",[t._v(t._s(e.tel))]):s("span",[t._v(t._s(e.first_tel))])])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(t._f("branch_name")(e.bid)))])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.create_time))])])])})],2):t._e(),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"primary"},on:{click:t.repeat}},[t._v("是重复学员")]),t._v(" "),s("Button",{attrs:{type:"ghost"},on:{click:t.notRepeat}},[t._v("不是重复学员")])],1)])],1)},a=[];o._withStripped=!0;var l={render:o,staticRenderFns:a};e.a=l}});