webpackJsonp([198],{1264:function(e,t,i){"use strict";t.a={props:{forbidType:{type:Array,default:function(){return[]}},value:{type:String,default:""},size:{type:String,default:"default"}},data:function(){return{model:this.value}},methods:{handleChange:function(e){this.$emit("input",e.target.value)},selectFromModal:function(){var e=this;this.$Modal.open("components/SelectSystemLinkModal.vue@modal",{props:{"forbid-type":this.forbidType},on:{"on-change":function(t){e.model=t,e.$emit("input",t)}}}).then(function(e){e.show("选择系统链接")})}},watch:{value:function(e){this.modal=e}}}},1412:function(e,t,i){"use strict";var s=i(1264),l=i(1413),n=i(11),o=n(s.a,l.a,!1,null,null,null);o.options.__file="src/views/components/SelectSystemLink.vue",t.a=o.exports},1413:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"system-link-wrapper"},[i("Input",{attrs:{size:e.size,placeholder:"请输入链接或选择系统链接"},on:{"on-change":e.handleChange},model:{value:e.model,callback:function(t){e.model=t},expression:"model"}},[i("Button",{staticStyle:{width:"70px"},attrs:{slot:"append"},on:{click:e.selectFromModal},slot:"append"},[e._v("系统链接")])],1)],1)},l=[];s._withStripped=!0;var n={render:s,staticRenderFns:l};t.a=n},1615:function(e,t,i){"use strict";var s=i(35),l=i.n(s),n=i(1),o=i(209),a=i(207),d=i(629),r=i(649),c=i(1412),h={type:2,data:[],wtd_id:0,content:{}};t.a={mixins:[o.a,a.a],components:{SelectEmployee:d.a,SelectStudent:r.a,SelectSystemLink:c.a},data:function(){var e=this;return{info:n.b.copy(h),wx_tpls:[],wx_tpl_define:{},select:{eids:[],sids:[]},sendType:0,columns:[{title:"姓名",width:140,key:"name",render:function(t,i){return t("span",{style:{color:{sid:"#19be6b",cu_id:"#2d8cf0",mcl_id:"#13c2c2"}[e.getIdKey(i)]||"#657180"}},i.row.name)}},{title:"openid",key:"openid"},{title:"操作",key:"del",width:80,render:function(t,i){return t("Button",{props:{type:"ghost",size:"small",shape:"circle",icon:"ios-trash"},on:{click:function(){var t=e.getIdKey(i),s=e.info.data.findIndex(function(e){return e[t]===i.row[t]});e.info.data.splice(s,1)}}})}}]}},computed:{sNums:function(){return this.info.data.filter(function(e){return e.sid>0}).length},eNums:function(){return this.info.data.filter(function(e){return e.eid>0}).length}},methods:{getWXHistory:function(){this.$Modal.open("app/modal/wx-record-modal.vue").then(function(e){e.show("微信发送记录")})},getSmsTplDefines:function(){var e=this;this.$rest("wechat_tpl_defines").get({pagesize:100,bid:-1}).success(function(t){e.wx_tpls=t.list}).error(function(t){e.$Message.error(t.body.message)})},typeChange:function(e){this.info.data.splice(0)},getIdKey:function(e){for(var t=l()(e.row),i="",s=0,n=t.length;s<n;s++)if(t[s].indexOf("id")>-1){i=t[s];break}return i},selectTpl:function(e){var t=this,i=this.wx_tpls.find(function(t){return t.wtd_id==e});this.wx_tpl_define={},this.wx_tpl_define.first=i.tpl_define.first[0],this.wx_tpl_define.data=[],i.tpl_define.data.forEach(function(e){var i=e.field.replace(/[\{\}]/g,"");t.wx_tpl_define.data.push({key:i,placeholder:e.label,value:""})}),this.wx_tpl_define.remark=i.tpl_define.remark[0],this.wx_tpl_define.url=""},delItem:function(e){this.info.data.splice(index,1)},selectStudent:function(e){var t=this;e.forEach(function(e){-1===t.info.data.findIndex(function(t){return t.sid==e.sid})&&""!==e.first_openid&&t.info.data.push({sid:e.sid,openid:e.first_openid,name:e.student_name})})},selectEmployee:function(e){var t=this;e.forEach(function(e){-1===t.info.data.findIndex(function(t){return t.eid==e.eid})&&""!==e.openid&&t.info.data.push({eid:e.eid,openid:e.openid,name:e.ename})})},check:function(){var e=this;this.info.content={};var t=!0,i=!0;for(var s in this.wx_tpl_define)if("data"==s)this.wx_tpl_define[s].forEach(function(s){e.info.content[s.key]=s.value,t&&""===s.value&&(t=!1),i&&s.value.length>50&&(i=!1)});else{var l=this.wx_tpl_define[s];this.info.content[s]=l,"url"!==s&&(t&&""===l&&(t=!1),i&&l.length>50&&(i=!1))}return 0==this.info.wtd_id?(this.$Message.error("请先选择短信模板"),!1):(0===this.info.data.length&&this.$Message.error("请选择接受对象"),t?!!i||(this.$Message.error("发送内容有超过50个字符"),!1):(this.$Message.error("发送内容有空值"),!1))},send:function(){var e=this;this.check()&&this.$rest("message_group_historys").post(this.info).success(function(t){e.$Message.success("已加入发送队列，请稍后在微信记录中查询")}).error(function(t){e.$Message.error(re.body.message)})}},watch:{"modal$.show":function(e){e&&(this.info=n.b.copy(h),0===this.wx_tpls.length&&this.getSmsTplDefines())}}}},2207:function(e,t){},2208:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{"mask-closable":!1,width:"600",title:e.modal$.title},model:{value:e.modal$.show,callback:function(t){e.$set(e.modal$,"show",t)},expression:"modal$.show"}},[i("Button",{staticClass:"sms-record-btn",attrs:{type:"ghost"},on:{click:e.getWXHistory}},[e._v("微信发送记录")]),e._v(" "),i("Form",{ref:"form",attrs:{model:e.info,"label-width":80}},[i("Form-item",{attrs:{label:"接收类型"}},[i("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.typeChange},model:{value:e.sendType,callback:function(t){e.sendType=t},expression:"sendType"}},[i("Radio",{attrs:{label:0}},[e._v("外部")]),e._v(" "),i("Radio",{attrs:{label:1}},[e._v("内部")])],1)],1),e._v(" "),i("Form-item",{staticClass:"custom-form-item-required",attrs:{label:"微信模板"}},[i("Select",{on:{"on-change":e.selectTpl},model:{value:e.info.wtd_id,callback:function(t){e.$set(e.info,"wtd_id",t)},expression:"info.wtd_id"}},e._l(e.wx_tpls,function(t){return i("Option",{attrs:{value:t.wtd_id}},[e._v(e._s(t.name))])}))],1),e._v(" "),i("Form-item",{directives:[{name:"help",rawName:"v-help",value:"接收对象必须绑定微信",expression:"'接收对象必须绑定微信'"}],staticClass:"custom-form-item-required",attrs:{label:"接收对象"}},[e.sendType>0?i("select-employee",{on:{"on-selected":e.selectEmployee},model:{value:e.select.eids,callback:function(t){e.$set(e.select,"eids",t)},expression:"select.eids"}},[i("Button",{attrs:{type:"ghost",size:"small"}},[e._v("选员工"+e._s(e.eNums||""))])],1):i("select-student",{on:{"on-selected":e.selectStudent},model:{value:e.select.sids,callback:function(t){e.$set(e.select,"sids",t)},expression:"select.sids"}},[i("Button",{attrs:{type:"ghost",size:"small"}},[e._v("选学员"+e._s(e.sNums||""))])],1),e._v(" "),i("Table",{staticClass:"sms-fixed-table",attrs:{height:"250",columns:e.columns,data:e.info.data,"no-data-text":"请选择接收对象"}})],1),e._v(" "),i("Form-item",{staticClass:"custom-form-item-required",attrs:{label:"发送内容"}},[e.info.wtd_id>0?i("div",{staticClass:"wx-send-content"},[i("div",{staticClass:"line"},[i("span",[e._v("首行：")]),e._v(" "),i("Input",{model:{value:e.wx_tpl_define.first,callback:function(t){e.$set(e.wx_tpl_define,"first",t)},expression:"wx_tpl_define.first"}})],1),e._v(" "),e._l(e.wx_tpl_define.data,function(t){return i("div",{staticClass:"line"},[i("span",[e._v(e._s(t.key)+"：")]),e._v(" "),i("Input",{attrs:{placeholder:t.placeholder},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}})],1)}),e._v(" "),i("div",{staticClass:"line"},[i("span",[e._v("备注：")]),e._v(" "),i("Input",{model:{value:e.wx_tpl_define.remark,callback:function(t){e.$set(e.wx_tpl_define,"remark",t)},expression:"wx_tpl_define.remark"}})],1),e._v(" "),i("div",{staticClass:"line"},[i("span",[e._v("链接：")]),e._v(" "),i("select-system-link",{attrs:{"forbid-type":["pc"]},model:{value:e.wx_tpl_define.url,callback:function(t){e.$set(e.wx_tpl_define,"url",t)},expression:"wx_tpl_define.url"}})],1)],2):i("p",[e._v("请选择微信模板")])])],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"ghost"},on:{click:e.close}},[e._v("关闭")]),e._v(" "),i("Button",{attrs:{type:"primary"},on:{click:e.send}},[e._v("发送")])],1)],1)},l=[];s._withStripped=!0;var n={render:s,staticRenderFns:l};t.a=n},431:function(e,t,i){"use strict";function s(e){o||i(2207)}Object.defineProperty(t,"__esModule",{value:!0});var l=i(1615),n=i(2208),o=!1,a=i(11),d=s,r=a(l.a,n.a,!1,d,null,null);r.options.__file="src/views/app/modal/wx-template-modal.vue",t.default=r.exports},613:function(e,t,i){"use strict";function s(e,t){for(var i=0;i<t.length;i++)if(e===t[i])return!0;return!1}function l(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=e.$children;return s.length&&s.forEach(function(e){var s=e.$options.name,n=e.$children;if(s===t&&i.push(e),n.length){var o=l(e,t,i);o&&i.concat(o)}}),i}t.b=s,i.d(t,"a",function(){return l});window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver},629:function(e,t,i){"use strict";var s=i(633),l=i(643),n=i(11),o=n(s.a,l.a,!1,null,null,null);o.options.__file="src/views/components/SelectEmployee.vue",t.a=o.exports},633:function(e,t,i){"use strict";var s=i(9),l=i.n(s),n=i(54),o=i.n(n),a=i(207),d=i(613),r=(i(24),i(1),"ivu-select");t.a={name:"SelectEmployee",mixins:[a.a],props:{value:{type:[String,Number,Array],default:0},mode:{type:String,default:"employee"},rid:{type:Number,default:0},did:{type:Number,default:0},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},placeholder:{type:String},loading:{type:Boolean,default:!1},loadingText:{type:String},size:{validator:function(e){return Object(d.b)(e,["small","large","default"])}},notFoundText:{type:String},placement:{validator:function(e){return Object(d.b)(e,["top","bottom"])},default:"bottom"}},data:function(){return{prefixCls:r,modalShow:!1,options:[],optionInstances:[],labelText:"",model:this.value}},computed:{modalWidth:function(){return this.multiple?"900":"640"},multiple:function(){return!!Array.isArray(this.model)},classes:function(){var e;return["ivu-select",(e={},o()(e,"ivu-select-visible",this.visible),o()(e,"ivu-select-disabled",this.disabled),o()(e,"ivu-select-multiple",this.multiple),o()(e,"ivu-select-single",!this.multiple),o()(e,"ivu-select-show-clear",this.showCloseIcon),o()(e,"ivu-select-"+this.size,!!this.size),e)]},showPlaceholder:function(){var e=!1;return"string"==typeof this.model?""!==this.model&&"0"!==this.model||(e=!0):Array.isArray(this.model)?this.model.length||(e=!0):"number"==typeof this.model?0==this.model&&(e=!0):null===this.model&&(e=!0),e},localePlaceholder:function(){return void 0===this.placeholder?"请选择":this.placeholder},showCloseIcon:function(){return this.clearable&&!this.showPlaceholder},title:function(){return 0==this.rid?"选择员工":1===this.rid?"选择"+this.$filter("translate")("老师"):2===this.rid?"选择"+this.$filter("translate")("助教"):4==this.rid?"选择"+this.$filter("translate")("学管师"):7==this.rid?"选择"+this.$filter("translate")("咨询师"):this.did>0?"选择员工与角色":"选择员工"}},methods:{openModal:function(){var e=this;if(this.disabled||this.readonly)return!1;this.$Modal.open("components/SelectEmployeeModal.vue@modal",{props:{multiple:this.multiple,selected:this.model,width:this.modalWidth,did:this.did,rid:this.rid,title:this.title,mode:this.mode},on:{"on-select":function(t){e.updateSelected(t)}}}).then(function(e){e.show()})},updateSelected:function(e){var t=this,i=e.selected,s=e.sale_role_did;this.multiple?(this.model.length>0&&this.model.splice(0,this.model.length),i.forEach(function(e){t.model.push(e.eid)})):(this.model=i.eid,this.did>0&&s&&this.$emit("onChange",{eid:i.eid,sale_role_did:s})),this.updateLabelText(),"user"==this.mode?this.getEmployeeUid().then(function(e){t.$emit("input",e),t.$emit("select",e)}):(this.$emit("input",this.model),this.$emit("select",this.model)),this.$emit("on-selected",i),this.dispatch("FormItem","on-form-change",this.model)},getEmployeeUid:function(){var e=this,t=this.model,i=0,s=[];return this.multiple?t.length&&(i=[],t.forEach(function(t){s.push(e.$store.dispatch("getMapObject",{id:t,name:"employee",idf:"eid",txf:"ename"}).then(function(t){e.model.push(t.uid)}))})):s.push(this.$store.dispatch("getMapObject",{id:t,name:"employee",idf:"eid",txf:"ename"}).then(function(e){i=e.uid})),new l.a(function(e,t){l.a.all(s).then(function(){e(i)},function(){t()})})},updateLabelText:function(){var e=this;this.multiple?this.model.length>0&&this.model[0]>0?this.$store.dispatch("getMapText",{id:this.model[0],name:"employee",idf:"eid",txf:"ename"}).then(function(t){var i=t;e.model.length>1&&(i+="等"+e.model.length+"个老师"),e.labelText=i}):this.labelText="":this.did>0?this.model.eid>0&&this.$store.dispatch("getMapText",{id:this.model.eid,name:"employee",idf:"eid",txf:"ename"}).then(function(t){e.labelText=t}):this.model?this.$store.dispatch("getMapText",{id:this.model,name:"employee",idf:"eid",txf:"ename"}).then(function(t){e.labelText=t}):this.labelText=""},clearSelected:function(){this.multiple?this.model.length>0&&this.model.splice(0,this.model.length):this.model=0,this.$emit("input",this.model),this.dispatch("FormItem","on-form-change",this.model)}},created:function(){this.model=this.value,this.showPlaceholder||this.updateLabelText()},mounted:function(){},watch:{value:function(e){"user"!=this.mode&&(this.model=e,this.updateLabelText())}}}},643:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classes},[i("div",{on:{click:e.openModal}},[e._t("default",[i("div",{ref:"reference",class:[e.prefixCls+"-selection"]},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showPlaceholder,expression:"showPlaceholder"}],class:[e.prefixCls+"-placeholder"]},[e._v(e._s(e.localePlaceholder))]),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!e.showPlaceholder,expression:"!showPlaceholder"}],class:[e.prefixCls+"-selected-value"]},[e._v(e._s(e.labelText))]),e._v(" "),e.showCloseIcon?i("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:"ios-close"},nativeOn:{click:function(t){t.stopPropagation(),e.clearSelected(t)}}}):e._e(),e._v(" "),i("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:"arrow-down-b"}})],1)])],2)])},l=[];s._withStripped=!0;var n={render:s,staticRenderFns:l};t.a=n},646:function(e,t,i){"use strict";var s=i(54),l=i.n(s),n=i(613),o=(i(1),i(207)),a="ivu-select";t.a={name:"SelectStudent",mixins:[o.a],props:{value:{type:[String,Number,Array],default:""},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},placeholder:{type:String},loading:{type:Boolean,default:!1},loadingText:{type:String},size:{validator:function(e){return Object(n.b)(e,["small","large","default"])}},notFoundText:{type:String},placement:{validator:function(e){return Object(n.b)(e,["top","bottom"])},default:"bottom"}},data:function(){return{prefixCls:a,modalShow:!1,options:[],optionsInstances:[],labelText:"",model:this.value,type:"all"}},computed:{modalWidth:function(){return this.multiple?"900":"640"},multiple:function(){return!!Array.isArray(this.model)},classes:function(){var e;return["ivu-select",(e={},l()(e,"ivu-select-visible",this.visible),l()(e,"ivu-select-disabled",this.disabled),l()(e,"ivu-select-multiple",this.multiple),l()(e,"ivu-select-single",!this.multiple),l()(e,"ivu-select-show-clear",this.showCloseIcon),l()(e,"ivu-select-"+this.size,!!this.size),e)]},showPlaceholder:function(){var e=!1;return"string"==typeof this.model?""!==this.model&&"0"!==this.model||(e=!0):Array.isArray(this.model)?this.model.length||(e=!0):"number"==typeof this.model?0==this.model&&(e=!0):null===this.model&&(e=!0),e},localePlaceholder:function(){return void 0===this.placeholder?"请选择":this.placeholder},showCloseIcon:function(){return this.clearable&&!this.showPlaceholder},checkAll:function(){return!!this.perCheckAllStudent&&"all"==this.type},checkMy:function(){return!this.perCheckAllStudent||"my"==this.type}},methods:{checkStudent:function(e){this.type=e,this.openModal()},openModal:function(){if(this.disabled)return!1;this.checkAll?this.openAllModal():this.openMyModal()},openAllModal:function(){var e=this;this.$Modal.open("components/SelectStudentModal.vue@modal",{props:{multiple:this.multiple,selected:this.model,width:this.modalWidth},on:{"on-select":function(t){e.updateSelected(t)},"on-check":function(t){e.checkStudent(t)}}}).then(function(e){e.show()})},openMyModal:function(){var e=this;this.$Modal.open("components/SelectStudentModalMy.vue@modal",{props:{multiple:this.multiple,selected:this.model,width:this.modalWidth},on:{"on-select":function(t){e.updateSelected(t)},"on-check":function(t){e.checkStudent(t)}}}).then(function(e){e.show()})},updateSelected:function(e){var t=this;this.multiple?(this.model.length>0&&this.model.splice(0,this.model.length),e.forEach(function(e){t.model.push(e.sid)})):this.model=e.sid,this.updateLabelText(),this.$emit("input",this.model),this.$emit("select",this.model),this.$emit("on-selected",e)},updateLabelText:function(){var e=this;this.multiple?this.model.length>0&&this.model[0]>0?this.$store.dispatch("getMapText",{id:this.model[0],name:"student",idf:"sid",txf:"student_name"}).then(function(t){var i=t;e.model.length>1&&(i+="等"+e.model.length+"个学员"),e.labelText=i}):this.labelText="":this.model?this.$store.dispatch("getMapText",{id:this.model,name:"student",idf:"sid",txf:"student_name"}).then(function(t){e.labelText=t}):this.labelText=""},clearSelected:function(){this.multiple?this.model.length>0&&this.model.splice(0,this.model.length):this.model=0,this.$emit("on-clear-all"),this.$emit("input",this.model)}},created:function(){this.updateLabelText()},watch:{value:function(e){this.model=e,this.updateLabelText()}}}},649:function(e,t,i){"use strict";var s=i(646),l=i(667),n=i(11),o=n(s.a,l.a,!1,null,null,null);o.options.__file="src/views/components/SelectStudent.vue",t.a=o.exports},667:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classes},[i("div",{on:{click:e.openModal}},[e._t("default",[i("div",{ref:"reference",class:[e.prefixCls+"-selection"]},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showPlaceholder,expression:"showPlaceholder"}],class:[e.prefixCls+"-placeholder"]},[e._v(e._s(e.localePlaceholder))]),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!e.showPlaceholder,expression:"!showPlaceholder"}],class:[e.prefixCls+"-selected-value"]},[e._v(e._s(e.labelText))]),e._v(" "),i("Icon",{directives:[{name:"show",rawName:"v-show",value:e.showCloseIcon,expression:"showCloseIcon"}],class:[e.prefixCls+"-arrow"],attrs:{type:"ios-close"},nativeOn:{click:function(t){t.stopPropagation(),e.clearSelected(t)}}}),e._v(" "),i("Icon",{directives:[{name:"show",rawName:"v-show",value:!e.showCloseIcon,expression:"!showCloseIcon"}],class:[e.prefixCls+"-arrow"],attrs:{type:"arrow-down-b"}})],1)])],2)])},l=[];s._withStripped=!0;var n={render:s,staticRenderFns:l};t.a=n}});