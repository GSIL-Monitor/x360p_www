webpackJsonp([210],{1627:function(e,t,i){"use strict";var o=i(678),n=i.n(o),s=i(0),a=i.n(s),l=i(1),r=i(209),d=i(207),c=i(208),u=i(643),h={sid:0,cu_id:0,cid:0,object_type:2,st_did:0,int_day:"",int_hour:"",own_eid:0,remark:"",status:0};t.a={mixins:[d.a,r.a,c.a],components:{SelectEmployee:u.a},data:function(){return{name:"",now_time:"",info:l.b.copy(h),rules:{int_day:[{required:!0,message:"请选择完成时间",trigger:"change"}],st_did:[{required:!0,type:"number",min:1,message:"请选择服务类型",trigger:"change"}]},disabledDateOptions:{disabledDate:function(e){return e&&e.valueOf()<Date.now()-864e5}}}},mounted:function(){this.lazy_init_day()},computed:{service_type:function(){return this.info.cid>0?this.dicts("class_service_type"):this.dicts("student_service_type")}},methods:{lazy_init_day:function(){var e=this;setTimeout(function(){"add"==e.modal$.action&&(e.now_time=a()().add(1,"days").format("YYYY-MM-DD HH:mm"),e.info.int_day=l.b.format_int_day(e.now_time.substr(0,10)),e.info.int_hour=l.b.format_int_hour(e.now_time.substr(11,5)))},1e3)},onModalOpen:function(){this.info.own_eid=this.eid$},timeChange:function(e){e&&(this.info.int_day=l.b.format_int_day(e.substring(0,10)),this.info.int_hour=l.b.format_int_hour(e.substring(11,16)))},ok:function(e){function t(){l.$rest(s)[a](l.info).success(function(e){l.$Message.success("操作成功！"),l.$emit("on-success"),l.close()}).error(function(e){l.$Message.error(e.body.message||"添加失败~")})}var i="add"==this.modal$.action?["service_tasks","post"]:["service_tasks/"+this.info.st_id,"put"],o=n()(i,2),s=o[0],a=o[1],l=this;"edit"==this.modal$.action&&1==e?this.info.status=1:this.info.status=0,"add"==this.modal$.action?this.$form("form").check().then(function(){t()}):t()}}}},2232:function(e,t){},2233:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{title:e.modal$.title,width:600,"mask-closable":!1},model:{value:e.modal$.show,callback:function(t){e.$set(e.modal$,"show",t)},expression:"modal$.show"}},[e.modal$.show?i("Form",{ref:"form",attrs:{model:e.info,rules:e.rules,"label-width":80}},["add"==e.modal$.action?i("Form-item",{attrs:{label:"服务对象"}},[e._v("\n\t\t\t"+e._s(e.name)+"\n\t\t")]):e._e(),e._v(" "),i("Form-item",{attrs:{label:"服务类型",prop:"st_did"}},["add"==e.modal$.action?i("Select",{model:{value:e.info.st_did,callback:function(t){e.$set(e.info,"st_did",t)},expression:"info.st_did"}},e._l(e.service_type,function(t){return i("Option",{attrs:{value:t.did}},[e._v(e._s(t.title))])})):[e.info.cid>0?i("span",[e._v(e._s(e._f("dict_title")(e.info.st_did,"class_service_type")))]):i("span",[e._v(e._s(e._f("dict_title")(e.info.st_did,"student_service_type")))])]],2),e._v(" "),i("Form-item",{attrs:{label:"完成日期",prop:"int_day"}},["add"==e.modal$.action?i("DatePicker",{staticStyle:{width:"200px"},attrs:{value:e.now_time,options:e.disabledDateOptions,type:"datetime",format:"yyyy-MM-dd HH:mm",placeholder:"请选择"},on:{"on-change":e.timeChange}}):i("span",[e._v(e._s(e._f("int_date")(e.info.int_day))+" "+e._s(e._f("int_hour")(e.info.int_hour)))])],1),e._v(" "),i("Form-item",{attrs:{label:"备注",prop:"remark"}},[i("Input",{attrs:{type:"textarea",placeholder:"请输入备注",autosize:{minRows:3,maxRows:4}},model:{value:e.info.remark,callback:function(t){e.$set(e.info,"remark",t)},expression:"info.remark"}})],1),e._v(" "),i("Form-item",{attrs:{label:"责任人",prop:"own_eid"}},["add"==e.modal$.action?i("select-employee",{model:{value:e.info.own_eid,callback:function(t){e.$set(e.info,"own_eid",t)},expression:"info.own_eid"}}):i("span",[e._v(e._s(e._f("ename")(e.info.own_eid)))])],1)],1):e._e(),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"ghost",loading:e.saving},on:{click:e.close}},[e._v("关闭")]),e._v(" "),"add"==e.modal$.action?i("Button",{attrs:{type:"primary",loading:e.saving},on:{click:e.ok}},[e._v("确定")]):[i("Button",{attrs:{type:"primary",loading:e.saving},on:{click:e.ok}},[e._v("更新状态")]),e._v(" "),i("Button",{attrs:{type:"primary",loading:e.saving},on:{click:function(t){e.ok(!0)}}},[e._v("完成安排")])]],2)],1)},n=[];o._withStripped=!0;var s={render:o,staticRenderFns:n};t.a=s},423:function(e,t,i){"use strict";function o(e){a||i(2232)}Object.defineProperty(t,"__esModule",{value:!0});var n=i(1627),s=i(2233),a=!1,l=i(11),r=o,d=l(n.a,s.a,!1,r,null,null);d.options.__file="src/views/service/service/task-modal.vue",t.default=d.exports},627:function(e,t,i){"use strict";function o(e,t){for(var i=0;i<t.length;i++)if(e===t[i])return!0;return!1}function n(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=e.$children;return o.length&&o.forEach(function(e){var o=e.$options.name,s=e.$children;if(o===t&&i.push(e),s.length){var a=n(e,t,i);a&&i.concat(a)}}),i}t.b=o,i.d(t,"a",function(){return n});window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver},643:function(e,t,i){"use strict";var o=i(644),n=i(656),s=i(11),a=s(o.a,n.a,!1,null,null,null);a.options.__file="src/views/components/SelectEmployee.vue",t.a=a.exports},644:function(e,t,i){"use strict";var o=i(9),n=i.n(o),s=i(54),a=i.n(s),l=i(207),r=i(627),d=(i(24),i(1),"ivu-select");t.a={name:"SelectEmployee",mixins:[l.a],props:{value:{type:[String,Number,Array],default:0},mode:{type:String,default:"employee"},rid:{type:Number,default:0},did:{type:Number,default:0},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},placeholder:{type:String},loading:{type:Boolean,default:!1},loadingText:{type:String},size:{validator:function(e){return Object(r.b)(e,["small","large","default"])}},notFoundText:{type:String},placement:{validator:function(e){return Object(r.b)(e,["top","bottom"])},default:"bottom"},limitPer:{type:Boolean,default:!0}},data:function(){return{prefixCls:d,modalShow:!1,options:[],optionInstances:[],labelText:"",model:this.value}},computed:{modalWidth:function(){return this.multiple?"900":"640"},multiple:function(){return!!Array.isArray(this.model)},classes:function(){var e;return["ivu-select",(e={},a()(e,"ivu-select-visible",this.visible),a()(e,"ivu-select-disabled",this.disabled),a()(e,"ivu-select-multiple",this.multiple),a()(e,"ivu-select-single",!this.multiple),a()(e,"ivu-select-show-clear",this.showCloseIcon),a()(e,"ivu-select-"+this.size,!!this.size),e)]},showPlaceholder:function(){var e=!1;return"string"==typeof this.model?""!==this.model&&"0"!==this.model||(e=!0):Array.isArray(this.model)?this.model.length||(e=!0):"number"==typeof this.model?0==this.model&&(e=!0):null===this.model&&(e=!0),e},localePlaceholder:function(){return void 0===this.placeholder?"请选择":this.placeholder},showCloseIcon:function(){return this.clearable&&!this.showPlaceholder},title:function(){return 0==this.rid?"选择员工":1===this.rid?"选择"+this.$filter("translate")("老师"):2===this.rid?"选择"+this.$filter("translate")("助教"):4==this.rid?"选择"+this.$filter("translate")("学管师"):7==this.rid?"选择"+this.$filter("translate")("咨询师"):this.did>0?"选择员工与角色":"选择员工"}},methods:{openModal:function(){var e=this;if(this.disabled||this.readonly)return!1;this.$Modal.open("components/SelectEmployeeModal.vue@modal",{props:{multiple:this.multiple,selected:this.model,width:this.modalWidth,did:this.did,rid:this.rid,title:this.title,mode:this.mode,"limit-per":this.limitPer},on:{"on-select":function(t){e.updateSelected(t)}}}).then(function(e){e.show()})},updateSelected:function(e){var t=this,i=e.selected,o=e.sale_role_did;this.multiple?(this.model.length>0&&this.model.splice(0,this.model.length),i.forEach(function(e){t.model.push(e.eid)})):(this.model=i.eid,this.did>0&&o&&this.$emit("onChange",{eid:i.eid,sale_role_did:o})),this.updateLabelText(),"user"==this.mode?this.getEmployeeUid().then(function(e){t.$emit("input",e),t.$emit("select",e)}):(this.$emit("input",this.model),this.$emit("select",this.model)),this.$emit("on-selected",i),this.dispatch("FormItem","on-form-change",this.model)},getEmployeeUid:function(){var e=this,t=this.model,i=0,o=[];return this.multiple?t.length&&(i=[],t.forEach(function(t){o.push(e.$store.dispatch("getMapObject",{id:t,name:"employee",idf:"eid",txf:"ename"}).then(function(t){e.model.push(t.uid)}))})):o.push(this.$store.dispatch("getMapObject",{id:t,name:"employee",idf:"eid",txf:"ename"}).then(function(e){i=e.uid})),new n.a(function(e,t){n.a.all(o).then(function(){e(i)},function(){t()})})},updateLabelText:function(){var e=this;this.multiple?this.model.length>0&&this.model[0]>0?this.$store.dispatch("getMapText",{id:this.model[0],name:"employee",idf:"eid",txf:"ename"}).then(function(t){var i=t;e.model.length>1&&(i+="等"+e.model.length+"个老师"),e.labelText=i}):this.labelText="":this.did>0?this.model.eid>0&&this.$store.dispatch("getMapText",{id:this.model.eid,name:"employee",idf:"eid",txf:"ename"}).then(function(t){e.labelText=t}):this.model?this.$store.dispatch("getMapText",{id:this.model,name:"employee",idf:"eid",txf:"ename"}).then(function(t){e.labelText=t}):this.labelText=""},clearSelected:function(){this.multiple?this.model.length>0&&this.model.splice(0,this.model.length):this.model=0,this.$emit("input",this.model),this.dispatch("FormItem","on-form-change",this.model)}},created:function(){this.model=this.value,this.showPlaceholder||this.updateLabelText()},mounted:function(){},watch:{value:function(e){"user"!=this.mode&&(this.model=e,this.updateLabelText())}}}},656:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classes},[i("div",{on:{click:e.openModal}},[e._t("default",[i("div",{ref:"reference",class:[e.prefixCls+"-selection"]},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showPlaceholder,expression:"showPlaceholder"}],class:[e.prefixCls+"-placeholder"]},[e._v(e._s(e.localePlaceholder))]),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!e.showPlaceholder,expression:"!showPlaceholder"}],class:[e.prefixCls+"-selected-value"]},[e._v(e._s(e.labelText))]),e._v(" "),e.showCloseIcon?i("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:"ios-close"},nativeOn:{click:function(t){t.stopPropagation(),e.clearSelected(t)}}}):e._e(),e._v(" "),i("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:"arrow-down-b"}})],1)])],2)])},n=[];o._withStripped=!0;var s={render:o,staticRenderFns:n};t.a=s},678:function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var n=i(684),s=o(n),a=i(210),l=o(a);t.default=function(){function e(e,t){var i=[],o=!0,n=!1,s=void 0;try{for(var a,r=(0,l.default)(e);!(o=(a=r.next()).done)&&(i.push(a.value),!t||i.length!==t);o=!0);}catch(e){n=!0,s=e}finally{try{!o&&r.return&&r.return()}finally{if(n)throw s}}return i}return function(t,i){if(Array.isArray(t))return t;if((0,s.default)(Object(t)))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},684:function(e,t,i){e.exports={default:i(685),__esModule:!0}},685:function(e,t,i){i(36),i(26),e.exports=i(686)},686:function(e,t,i){var o=i(56),n=i(3)("iterator"),s=i(18);e.exports=i(2).isIterable=function(e){var t=Object(e);return void 0!==t[n]||"@@iterator"in t||s.hasOwnProperty(o(t))}}});