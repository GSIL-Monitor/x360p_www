webpackJsonp([239],{1625:function(e,t,s){"use strict";var i=s(1),n=s(209),o=s(207),l=s(208),a=s(661),r={from_sid:0,to_sid:0,sl_id:0,nums:0,remark:""};t.a={mixins:[o.a,l.a,n.a],components:{SelectStudent:a.a},props:{student:{type:Object,default:function(){return{}}}},data:function(){return{info:i.b.copy(r),currentSL:null,studentLessons:[],numsMax:1/0}},methods:{onModalOpen:function(){this.student.sid>0&&(this.info.from_sid=this.student.sid,this.getStudentLessons(this.student.sid))},selectStudent:function(e){this.getStudentLessons(e)},getStudentLessons:function(e){var t=this;this.$rest("student_lessons").get({sid:e,with:"student,one_class",pagesize:20}).success(function(e){t.studentLessons=e.list}).error(function(e){t.$Message.error(e.body.message)})},selectSL:function(e){this.currentSL=this.studentLessons.find(function(t){return t.sl_id==e}),this.numsMax=Number(this.currentSL.remain_lesson_hours)},ok:function(){var e=this;return 0==this.info.sid?void this.$Message.error("请选择转让人"):0==this.info.sl_id?void this.$Message.error("请选择要转让的课程"):0==this.info.to_sid?void this.$Message.error("请选择接受人"):this.info.from_sid==this.info.to_sid?void this.$Message.error("不能转给自己"):0==this.info.nums?void this.$Message.error("转出数量不能为0"):void this.$rest("students").add_url_param(this.info.from_sid,"dotranshours").post(this.info).success(function(t){e.$Message.success("转让成功"),e.$emit("success"),e.close()}).error(function(t){e.$Message.error(t.body.message)})}}}},2230:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{title:e.modal$.title,"mask-closable":!1,width:650},model:{value:e.modal$.show,callback:function(t){e.$set(e.modal$,"show",t)},expression:"modal$.show"}},[s("Form",{attrs:{"label-width":80}},[s("Form-item",{staticClass:"custom-form-item-required",attrs:{label:"转让人"}},[s("select-student",{attrs:{disabled:e.student.sid>0,clearable:!1},on:{select:e.selectStudent},model:{value:e.info.from_sid,callback:function(t){e.$set(e.info,"from_sid",t)},expression:"info.from_sid"}})],1),e._v(" "),s("Form-item",{staticClass:"custom-form-item-required",attrs:{label:"转让课时"}},[s("Select",{on:{"on-change":e.selectSL},model:{value:e.info.sl_id,callback:function(t){e.$set(e.info,"sl_id",t)},expression:"info.sl_id"}},e._l(e.studentLessons,function(t){return s("Option",{attrs:{value:t.sl_id,disabled:t.remain_lesson_hours<=0}},[e._v(e._s(e._f("lesson_name")(t.lid))+" \n\t\t\t\t\t"),s("span",[e._v("\n\t\t\t\t\t\t(剩余"+e._s(t.remain_lesson_hours)+")\n\t\t\t\t\t")])])}))],1),e._v(" "),s("Form-item",{staticClass:"custom-form-item-required",attrs:{label:"接受人"}},[s("select-student",{attrs:{clearable:""},model:{value:e.info.to_sid,callback:function(t){e.$set(e.info,"to_sid",t)},expression:"info.to_sid"}})],1),e._v(" "),s("Form-item",{staticClass:"custom-form-item-required",attrs:{label:"转出数量"}},[s("InputNumber",{attrs:{max:e.numsMax,min:0},model:{value:e.info.nums,callback:function(t){e.$set(e.info,"nums",t)},expression:"info.nums"}})],1),e._v(" "),s("Form-item",{attrs:{label:"备注"}},[s("Input",{model:{value:e.info.remark,callback:function(t){e.$set(e.info,"remark",t)},expression:"info.remark"}})],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"ghost",disabled:e.saving},on:{click:e.close}},[e._v("取消")]),e._v(" "),s("Button",{attrs:{type:"primary",loading:e.saving},on:{click:e.ok}},[e._v("确定")])],1)],1)},n=[];i._withStripped=!0;var o={render:i,staticRenderFns:n};t.a=o},421:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(1625),n=s(2230),o=s(11),l=o(i.a,n.a,!1,null,null,null);l.options.__file="src/views/business/student/transfer-lesson-hour.vue",t.default=l.exports},627:function(e,t,s){"use strict";function i(e,t){for(var s=0;s<t.length;s++)if(e===t[s])return!0;return!1}function n(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=e.$children;return i.length&&i.forEach(function(e){var i=e.$options.name,o=e.$children;if(i===t&&s.push(e),o.length){var l=n(e,t,s);l&&s.concat(l)}}),s}t.b=i,s.d(t,"a",function(){return n});window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver},658:function(e,t,s){"use strict";var i=s(54),n=s.n(i),o=s(627),l=(s(1),s(207)),a="ivu-select";t.a={name:"SelectStudent",mixins:[l.a],props:{value:{type:[String,Number,Array],default:""},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},placeholder:{type:String},loading:{type:Boolean,default:!1},loadingText:{type:String},size:{validator:function(e){return Object(o.b)(e,["small","large","default"])}},notFoundText:{type:String},placement:{validator:function(e){return Object(o.b)(e,["top","bottom"])},default:"bottom"}},data:function(){return{prefixCls:a,modalShow:!1,options:[],optionsInstances:[],labelText:"",model:this.value,type:"all"}},computed:{modalWidth:function(){return this.multiple?"900":"640"},multiple:function(){return!!Array.isArray(this.model)},classes:function(){var e;return["ivu-select",(e={},n()(e,"ivu-select-visible",this.visible),n()(e,"ivu-select-disabled",this.disabled),n()(e,"ivu-select-multiple",this.multiple),n()(e,"ivu-select-single",!this.multiple),n()(e,"ivu-select-show-clear",this.showCloseIcon),n()(e,"ivu-select-"+this.size,!!this.size),e)]},showPlaceholder:function(){var e=!1;return"string"==typeof this.model?""!==this.model&&"0"!==this.model||(e=!0):Array.isArray(this.model)?this.model.length||(e=!0):"number"==typeof this.model?0==this.model&&(e=!0):null===this.model&&(e=!0),e},localePlaceholder:function(){return void 0===this.placeholder?"请选择":this.placeholder},showCloseIcon:function(){return this.clearable&&!this.showPlaceholder},checkAll:function(){return!!this.perCheckAllStudent&&"all"==this.type},checkMy:function(){return!this.perCheckAllStudent||"my"==this.type}},methods:{checkStudent:function(e){this.type=e,this.openModal()},openModal:function(){if(this.disabled)return!1;this.checkAll?this.openAllModal():this.openMyModal()},openAllModal:function(){var e=this;this.$Modal.open("components/SelectStudentModal.vue@modal",{props:{multiple:this.multiple,selected:this.model,width:this.modalWidth},on:{"on-select":function(t){e.updateSelected(t)},"on-check":function(t){e.checkStudent(t)}}}).then(function(e){e.show()})},openMyModal:function(){var e=this;this.$Modal.open("components/SelectStudentModalMy.vue@modal",{props:{multiple:this.multiple,selected:this.model,width:this.modalWidth},on:{"on-select":function(t){e.updateSelected(t)},"on-check":function(t){e.checkStudent(t)}}}).then(function(e){e.show()})},updateSelected:function(e){var t=this;this.multiple?(this.model.length>0&&this.model.splice(0,this.model.length),e.forEach(function(e){t.model.push(e.sid)})):this.model=e.sid,this.updateLabelText(),this.$emit("input",this.model),this.$emit("select",this.model),this.$emit("on-selected",e)},updateLabelText:function(){var e=this;this.multiple?this.model.length>0&&this.model[0]>0?this.$store.dispatch("getMapText",{id:this.model[0],name:"student",idf:"sid",txf:"student_name"}).then(function(t){var s=t;e.model.length>1&&(s+="等"+e.model.length+"个学员"),e.labelText=s}):this.labelText="":this.model?this.$store.dispatch("getMapText",{id:this.model,name:"student",idf:"sid",txf:"student_name"}).then(function(t){e.labelText=t}):this.labelText=""},clearSelected:function(){this.multiple?this.model.length>0&&this.model.splice(0,this.model.length):this.model=0,this.$emit("input",this.model),this.$emit("on-clear-all")}},created:function(){this.updateLabelText()},watch:{value:function(e){this.model=e,this.updateLabelText()}}}},661:function(e,t,s){"use strict";var i=s(658),n=s(677),o=s(11),l=o(i.a,n.a,!1,null,null,null);l.options.__file="src/views/components/SelectStudent.vue",t.a=l.exports},677:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.classes},[s("div",{on:{click:e.openModal}},[e._t("default",[s("div",{ref:"reference",class:[e.prefixCls+"-selection"]},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.showPlaceholder,expression:"showPlaceholder"}],class:[e.prefixCls+"-placeholder"]},[e._v(e._s(e.localePlaceholder))]),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:!e.showPlaceholder,expression:"!showPlaceholder"}],class:[e.prefixCls+"-selected-value"]},[e._v(e._s(e.labelText))]),e._v(" "),e.showCloseIcon?s("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:"ios-close"},nativeOn:{click:function(t){t.stopPropagation(),e.clearSelected(t)}}}):e._e(),e._v(" "),s("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:"arrow-down-b"}})],1)])],2)])},n=[];i._withStripped=!0;var o={render:i,staticRenderFns:n};t.a=o}});