webpackJsonp([207],{1158:function(e,t,l){"use strict";var s=l(1),i=l(209),o=l(207),a=l(930),n=l(943),r={sid:0,sex:"1",bid:0,student_name:"",nick_name:"",birth_time:"",school_id_text:"",school_id:0,school_grade:0,school_class:"",first_tel:"",first_family_rel:"",first_family_name:"",second_tel:"",second_family_rel:"",second_family_name:"",card_no:""};t.a={mixins:[o.a,i.a],components:{SelectPublicSchool:n.a,RepeatTelStudent:a.a},data:function(){return{schools:[],show_all:!1,readonly1:!1,readonly2:!1,rel_list:[{value:1,text:"自己"},{value:2,text:"爸爸"},{value:3,text:"妈妈"},{value:4,text:"其他"}],info:s.b.copy(r),rules:{student_name:[{required:!0,message:"姓名不能为空",trigger:"blur"}],first_tel:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1\d{10}$/,message:"手机格式错误",trigger:"blur"}]},option_form_items:[]}},watch:{"modal$.show":function(e){e&&(this.readonly1=this.info.first_tel.length>0,this.readonly2=this.info.second_tel.length>0,this.show_all=!1,"add"==this.modal$.action&&(this.info=s.b.copy(r)),this.buildOptionFormItems())}},computed:{isCheckedTel:function(){return"add"==this.modal$.action&&(!this.$refs.repeat||!this.$refs.repeat.isChecked)}},methods:{buildOptionFormItems:function(){this.option_form_items=[];for(var e=this.$store.state.gvars.configs.student_option_fields,t=this.info.option_fields||{},l=0;l<e.length;l++){var s=e[l];1==s.enable&&this.option_form_items.push({label:s.label,type:s.type,field:s.name,value:t[s.name]||function(e){return"number"==e?0:"date"==e?new Date:""}(s.type),options:s.option_values})}},getOptionFieldsValue:function(){var e={};return this.option_form_items.forEach(function(t){e[t.field]=t.value}),e},cancel:function(){this.close()},ok:function(){var e=this,t="post",l="students",s="添加成功";"edit"==this.modal$.action&&(t="put",l="students/"+this.info.sid,s="修改成功"),this.info.bid=this.bid$,this.info.option_fields=this.getOptionFieldsValue(),this.$form("form").check().then(function(i){e.$rest(l)[t](e.info).success(function(t){e.$Message.success(s),e.$emit("on-save-success"),e.cancel()}).error(function(t){e.$Message.error(t.body.message||"添加失败")})})},handleSearch:function(e){var t=this;this.$rest("public_schools?name="+e).get().success(function(e){t.schools=e.list}).error(function(e){t.$Message.error(e.body.message||"搜索失败！")})}}}},1239:function(e,t,l){"use strict";var s=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],staticClass:"x-ivu-modal",attrs:{"mask-closable":!1,title:e.modal$.title,width:"850"},model:{value:e.modal$.show,callback:function(t){e.$set(e.modal$,"show",t)},expression:"modal$.show"}},[l("Form",{ref:"form",staticClass:"x-ivu-form row",attrs:{"label-width":100,model:e.info,rules:e.rules}},[l("Form-item",{staticClass:"col-sm-4",attrs:{label:"姓名",prop:"student_name"}},[l("Input",{attrs:{placeholder:"请输入学员姓名"},model:{value:e.info.student_name,callback:function(t){e.$set(e.info,"student_name",t)},expression:"info.student_name"}})],1),e._v(" "),l("Form-item",{staticClass:"col-sm-4",attrs:{label:"出生日期",prop:"birth_time"}},[l("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",value:e.info.birth_time,format:"yyyy-MM-dd",placeholder:"选择日期"},on:{"on-change":function(t){e.info.birth_time=t}}})],1),e._v(" "),l("Form-item",{staticClass:"col-sm-4 mb-2",attrs:{label:"卡号",prop:"card_no"}},[l("Input",{attrs:{placeholder:"请输入考勤卡号"},model:{value:e.info.card_no,callback:function(t){e.$set(e.info,"card_no",t)},expression:"info.card_no"}})],1),e._v(" "),l("Form-item",{staticClass:"col-sm-4",attrs:{label:"首选手机号",prop:"first_tel"}},[l("repeat-tel-student",{ref:"repeat",attrs:{readonly:e.readonly1,placeholder:"请输入手机号码"},model:{value:e.info.first_tel,callback:function(t){e.$set(e.info,"first_tel",t)},expression:"info.first_tel"}})],1),e._v(" "),l("Form-item",{staticClass:"col-sm-4",attrs:{label:"关系",prop:"first_family_rel"}},[l("Select",{model:{value:e.info.first_family_rel,callback:function(t){e.$set(e.info,"first_family_rel",t)},expression:"info.first_family_rel"}},e._l(e.rel_list,function(t,s){return l("Option",{key:s,attrs:{value:t.value}},[e._v(e._s(t.text))])}))],1),e._v(" "),1!=e.info.first_family_rel?l("Form-item",{staticClass:"col-sm-4",attrs:{label:"亲属姓名",prop:"first_family_name"}},[l("Input",{attrs:{placeholder:"请输入亲属姓名"},model:{value:e.info.first_family_name,callback:function(t){e.$set(e.info,"first_family_name",t)},expression:"info.first_family_name"}})],1):e._e(),e._v(" "),1==e.info.first_family_rel?l("div",{staticClass:"col-sm-4"}):e._e(),e._v(" "),l("p",{staticClass:"text-center col-sm-12 mb-3"},[l("a",{staticClass:"text-info",on:{click:function(t){e.show_all=!e.show_all}}},[e._v("\n\t\t\t\t"+e._s(e.show_all?"收起":"展开更多")+"\n\t\t\t\t"),l("Icon",{attrs:{type:e.show_all?"chevron-up":"chevron-down"}})],1)]),e._v(" "),l("div",{directives:[{name:"show",rawName:"v-show",value:e.show_all,expression:"show_all"}],staticClass:"row m-0"},[l("Form-item",{staticClass:"col-sm-4",attrs:{label:"昵称",prop:"nick_name"}},[l("Input",{attrs:{placeholder:"请输入昵称"},model:{value:e.info.nick_name,callback:function(t){e.$set(e.info,"nick_name",t)},expression:"info.nick_name"}})],1),e._v(" "),l("Form-item",{staticClass:"col-sm-4",attrs:{label:"性别",prop:"sex"}},[l("Radio-group",{attrs:{type:"button"},model:{value:e.info.sex,callback:function(t){e.$set(e.info,"sex",t)},expression:"info.sex"}},[l("Radio",{attrs:{label:"1"}},[e._v("男")]),e._v(" "),l("Radio",{attrs:{label:"2"}},[e._v("女")])],1)],1),e._v(" "),l("div",{staticClass:"col-sm-4"}),e._v(" "),l("Form-item",{staticClass:"col-sm-4",attrs:{label:"第二电话",prop:"second_tel"}},[l("Input",{attrs:{placeholder:"请输入手机号码",readonly:e.readonly2},model:{value:e.info.second_tel,callback:function(t){e.$set(e.info,"second_tel",t)},expression:"info.second_tel"}})],1),e._v(" "),l("Form-item",{staticClass:"col-sm-4",attrs:{label:"关系",prop:"second_family_rel"}},[l("Select",{model:{value:e.info.second_family_rel,callback:function(t){e.$set(e.info,"second_family_rel",t)},expression:"info.second_family_rel"}},e._l(e.rel_list,function(t,s){return l("Option",{key:s,attrs:{value:t.value}},[e._v(e._s(t.text))])}))],1),e._v(" "),1==e.info.second_family_rel?l("div",{staticClass:"col-sm-4"}):e._e(),e._v(" "),1!=e.info.second_family_rel?l("Form-item",{staticClass:"col-sm-4",attrs:{label:"亲属姓名",prop:"second_family_name"}},[l("Input",{attrs:{placeholder:"请输入亲属姓名"},model:{value:e.info.second_family_name,callback:function(t){e.$set(e.info,"second_family_name",t)},expression:"info.second_family_name"}})],1):e._e(),e._v(" "),l("Form-item",{staticClass:"col-sm-4 mb-2",attrs:{label:"公立学校",prop:"school_id"}},[l("select-public-school",{attrs:{clearable:""},model:{value:e.info.school_id,callback:function(t){e.$set(e.info,"school_id",t)},expression:"info.school_id"}})],1),e._v(" "),l("Form-item",{staticClass:"col-sm-4",attrs:{label:"年级",prop:"school_grade"}},[l("Select",{model:{value:e.info.school_grade,callback:function(t){e.$set(e.info,"school_grade",t)},expression:"info.school_grade"}},[l("Option",{attrs:{value:"0"}},[e._v("请选择")]),e._v(" "),e._l(e.dicts("grade"),function(t,s){return t.name<13?l("Option",{key:s,attrs:{value:Number(t.name)}},[e._v(e._s(t.title))]):e._e()})],2)],1),e._v(" "),l("Form-item",{staticClass:"col-sm-4 mb-2",attrs:{label:"班级",prop:"school_class"}},[l("Input",{attrs:{placeholder:"请输入班级名称"},model:{value:e.info.school_class,callback:function(t){e.$set(e.info,"school_class",t)},expression:"info.school_class"}})],1),e._v(" "),e.enable_vip?l("Form-item",{staticClass:"col-sm-4",attrs:{label:"会员等级",prop:"vip_level"}},[l("Select",{model:{value:e.info.vip_level,callback:function(t){e.$set(e.info,"vip_level",t)},expression:"info.vip_level"}},[l("Option",{attrs:{value:-1}},[e._v("非会员")]),e._v(" "),e._l(e.vip_level_config,function(t,s){return l("Option",{attrs:{value:s}},[e._v(e._s(t.name))])})],2)],1):e._e(),e._v(" "),e.enable_service_level?l("Form-item",{staticClass:"col-sm-4",attrs:{label:"服务星级",prop:"service_level"}},[l("Select",{model:{value:e.info.service_level,callback:function(t){e.$set(e.info,"service_level",t)},expression:"info.service_level"}},e._l(e.service_level_config,function(t){return l("Option",{attrs:{value:t}},[e._v(e._s(t))])}))],1):e._e(),e._v(" "),e._l(e.option_form_items,function(t){return["text"==t.type?l("Form-item",{staticClass:"col-sm-4",attrs:{label:t.label}},[l("Input",{attrs:{placeholder:"请输入"+t.label},model:{value:t.value,callback:function(l){e.$set(t,"value",l)},expression:"item.value"}})],1):e._e(),e._v(" "),"date"==t.type?l("Form-item",{staticClass:"col-sm-4",attrs:{label:t.label}},[l("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",value:t.value,format:"yyyy-MM-dd",placeholder:"选择日期"},on:{"on-change":function(e){t.value=e}}})],1):e._e(),e._v(" "),"number"==t.type?l("Form-item",{staticClass:"col-sm-4",attrs:{label:t.label}},[l("InputNumber",{model:{value:t.value,callback:function(l){e.$set(t,"value",l)},expression:"item.value"}})],1):e._e(),e._v(" "),"textarea"==t.type?l("Form-item",{staticClass:"col-sm-12",attrs:{label:t.label}},[l("Input",{attrs:{type:"textarea",placeholder:"请输入"+t.label},model:{value:t.value,callback:function(l){e.$set(t,"value",l)},expression:"item.value"}})],1):e._e(),e._v(" "),"select"==t.type?l("Form-item",{staticClass:"col-sm-4",attrs:{label:t.label}},[l("Select",{model:{value:t.value,callback:function(l){e.$set(t,"value",l)},expression:"item.value"}},e._l(t.options,function(t){return l("Option",{attrs:{value:t}},[e._v(e._s(t))])}))],1):e._e()]})],2)],1),e._v(" "),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("Button",{attrs:{type:"ghost",loading:e.saving},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),l("Button",{attrs:{type:"primary",loading:e.saving,disabled:e.isCheckedTel},on:{click:e.ok}},[e._v("确定")])],1)],1)},i=[];s._withStripped=!0;var o={render:s,staticRenderFns:i};t.a=o},353:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l(1158),i=l(1239),o=l(11),a=o(s.a,i.a,!1,null,null,null);a.options.__file="src/views/business/student/info-modal.vue",t.default=a.exports},620:function(e,t,l){"use strict";function s(e,t){for(var l=0;l<t.length;l++)if(e===t[l])return!0;return!1}function i(e,t){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=e.$children;return s.length&&s.forEach(function(e){var s=e.$options.name,o=e.$children;if(s===t&&l.push(e),o.length){var a=i(e,t,l);a&&l.concat(a)}}),l}t.b=s,l.d(t,"a",function(){return i});window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver},884:function(e,t,l){"use strict";var s=l(209),i=l(207),o=l(208);t.a={mixins:[i.a,s.a,o.a],props:{readonly:{type:Boolean,default:!1},value:{type:String,default:""},placeholder:{type:String,default:"请输入手机号码"}},data:function(){return{model:this.value,dataList:[],temp_tel:"",isChecked:!1}},watch:{model:function(e){this.$emit("input",e),this.dispatch("FormItem","on-form-change",e)},value:function(e){this.model=e},isChecked:function(e){this.$emit("on-checked",e)}},created:function(){/^1\d{10}$/.test(this.value)&&(this.temp_tel=this.value,this.isChecked=!0)},methods:{inputBlur:function(){if(!this.readonly){var e=this.model;/^1\d{10}$/.test(e)&&this.temp_tel!=e&&(this.temp_tel=""),/^1\d{10}$/.test(e)&&this.temp_tel!=e&&this.getStudentsByTel()}},getTag:function(e){var t={color:"blue",label:"学员"};return e.cu_id?(t.color="green",t.label="客户"):e.mcl_id&&(t.color="yellow",t.label="市场名单"),t},getStudentsByTel:function(){var e=this,t="students/query_by_tel?tel="+this.model;this.$rest(t).get().success(function(t){e.dataList=t,t&&t.length?(e.isChecked=!1,e.show("发现手机号重复名单")):e.isChecked=!0}).error(function(t){e.$Message.error(t.body.message||"获取同名学员失败~")})},repeat:function(){this.temp_tel="",this.model="",this.isChecked=!1,this.close()},notRepeat:function(){this.temp_tel=this.model,this.isChecked=!0,this.close()}}}},897:function(e,t,l){"use strict";var s=l(54),i=l.n(s),o=l(620),a=(l(1),l(207)),n="ivu-select";t.a={name:"SelectPublicSchool",mixins:[a.a],props:{value:{type:[String,Number,Array],default:""},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},placeholder:{type:String},loading:{type:Boolean,default:!1},loadingText:{type:String},size:{validator:function(e){return Object(o.b)(e,["small","large","default"])}},notFoundText:{type:String},placement:{validator:function(e){return Object(o.b)(e,["top","bottom"])},default:"bottom"}},data:function(){return{prefixCls:n,modalShow:!1,options:[],optionsInstances:[],labelText:"",model:this.value}},computed:{modalWidth:function(){return this.multiple?"900":"640"},multiple:function(){return!!Array.isArray(this.model)},classes:function(){var e;return["ivu-select",(e={},i()(e,"ivu-select-visible",this.visible),i()(e,"ivu-select-disabled",this.disabled),i()(e,"ivu-select-multiple",this.multiple),i()(e,"ivu-select-single",!this.multiple),i()(e,"ivu-select-show-clear",this.showCloseIcon),i()(e,"ivu-select-"+this.size,!!this.size),e)]},showPlaceholder:function(){var e=!1;return"string"==typeof this.model?""!==this.model&&"0"!==this.model||(e=!0):Array.isArray(this.model)?this.model.length||(e=!0):"number"==typeof this.model?0==this.model&&(e=!0):null===this.model&&(e=!0),e},localePlaceholder:function(){return void 0===this.placeholder?"请选择":this.placeholder},showCloseIcon:function(){return this.clearable&&!this.showPlaceholder}},methods:{openModal:function(){if(this.disabled)return!1;this.openMyModal()},openMyModal:function(){var e=this;this.$Modal.open("components/SelectPublicSchoolModal.vue@modal",{props:{multiple:this.multiple,selected:this.model,width:this.modalWidth},on:{"on-select":function(t){e.updateSelected(t)}}}).then(function(e){e.show()})},updateSelected:function(e){var t=this;this.multiple?(this.model.length>0&&this.model.splice(0,this.model.length),e.forEach(function(e){t.model.push(e.ps_id)})):this.model=e.ps_id,this.updateLabelText(),this.$emit("input",this.model),this.$emit("select",this.model),this.$emit("on-selected",e)},updateLabelText:function(){var e=this;this.multiple?this.model.length>0&&this.model[0]>0?this.$store.dispatch("getMapText",{id:this.model[0],name:"public_school",idf:"ps_id",txf:"school_name"}).then(function(t){var l=t;e.model.length>1&&(l+="等"+e.model.length+"个公立学校"),e.labelText=l}):this.labelText="":this.model?this.$store.dispatch("getMapText",{id:this.model,name:"public_school",idf:"ps_id",txf:"school_name"}).then(function(t){e.labelText=t}):this.labelText=""},clearSelected:function(){this.multiple?this.model.length>0&&this.model.splice(0,this.model.length):this.model=0,this.$emit("on-clear-all"),this.$emit("input",this.model)}},created:function(){this.updateLabelText()},watch:{value:function(e){this.model=e,this.updateLabelText()}}}},930:function(e,t,l){"use strict";function s(e){a||l(931)}var i=l(884),o=l(932),a=!1,n=l(11),r=s,c=n(i.a,o.a,!1,r,null,null);c.options.__file="src/views/components/RepeatTelStudent.vue",t.a=c.exports},931:function(e,t){},932:function(e,t,l){"use strict";var s=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("Input",{attrs:{readonly:e.readonly,placeholder:e.placeholder},on:{"on-blur":e.inputBlur},model:{value:e.model,callback:function(t){e.model=t},expression:"model"}}),e._v(" "),l("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{title:e.modal$.title,"mask-closable":!1,width:800},on:{"on-close":e.notRepeat},model:{value:e.modal$.show,callback:function(t){e.$set(e.modal$,"show",t)},expression:"modal$.show"}},[e.modal$.show?l("table",{staticClass:"modal-table"},[l("thead",[l("th",[l("div",{staticClass:"ivu-table-cell"},[e._v("姓名")])]),e._v(" "),l("th",[l("div",{staticClass:"ivu-table-cell"},[e._v("性别")])]),e._v(" "),l("th",[l("div",{staticClass:"ivu-table-cell"},[e._v("手机号")])]),e._v(" "),l("th",[l("div",{staticClass:"ivu-table-cell"},[e._v("所属校区")])]),e._v(" "),l("th",[l("div",{staticClass:"ivu-table-cell"},[e._v("录入时间")])])]),e._v(" "),e._l(e.dataList,function(t,s){return l("tr",{key:s},[l("td",[l("div",{staticClass:"ivu-table-cell"},[l("tag",{attrs:{color:e.getTag(t).color}},[e._v(e._s(e.getTag(t).label))]),e._v(" "),t.sid?l("span",[e._v(e._s(t.student_name))]):l("span",[e._v(e._s(t.name))])],1)]),e._v(" "),l("td",[l("div",{staticClass:"ivu-table-cell"},[e._v(e._s(1==t.sex?"男":"女"))])]),e._v(" "),l("td",[l("div",{staticClass:"ivu-table-cell"},[t.mcl_id?l("span",[e._v(e._s(t.tel))]):l("span",[e._v(e._s(t.first_tel))])])]),e._v(" "),l("td",[l("div",{staticClass:"ivu-table-cell"},[e._v(e._s(e._f("branch_name")(t.bid)))])]),e._v(" "),l("td",[l("div",{staticClass:"ivu-table-cell"},[e._v(e._s(t.create_time))])])])})],2):e._e(),e._v(" "),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("Button",{attrs:{type:"primary"},on:{click:e.repeat}},[e._v("是重复学员")]),e._v(" "),l("Button",{attrs:{type:"ghost"},on:{click:e.notRepeat}},[e._v("不是重复学员")])],1)])],1)},i=[];s._withStripped=!0;var o={render:s,staticRenderFns:i};t.a=o},943:function(e,t,l){"use strict";var s=l(897),i=l(954),o=l(11),a=o(s.a,i.a,!1,null,null,null);a.options.__file="src/views/components/SelectPublicSchool.vue",t.a=a.exports},954:function(e,t,l){"use strict";var s=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{class:e.classes},[l("div",{on:{click:e.openModal}},[e._t("default",[l("div",{ref:"reference",class:[e.prefixCls+"-selection"]},[l("span",{directives:[{name:"show",rawName:"v-show",value:e.showPlaceholder,expression:"showPlaceholder"}],class:[e.prefixCls+"-placeholder"]},[e._v(e._s(e.localePlaceholder))]),e._v(" "),l("span",{directives:[{name:"show",rawName:"v-show",value:!e.showPlaceholder,expression:"!showPlaceholder"}],class:[e.prefixCls+"-selected-value"]},[e._v(e._s(e.labelText))]),e._v(" "),e.showCloseIcon?l("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:"ios-close"},nativeOn:{click:function(t){t.stopPropagation(),e.clearSelected(t)}}}):e._e(),e._v(" "),l("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:"arrow-down-b"}})],1)])],2)])},i=[];s._withStripped=!0;var o={render:s,staticRenderFns:i};t.a=o}});