webpackJsonp([273],{1604:function(t,a,e){"use strict";var s=e(0),n=e.n(s),i=e(1),o=e(209);a.a={mixins:[o.a],data:function(){return{data:{amount:0,items:[]},max_amount:0,date:n()().format("YYYY-MM"),day:1}},watch:{"modal$.show":function(t){t&&(this.max_amount=this.data.amount,0==this.data.items.length&&this.data.items.push({day:n()().format("YYYY-MM")+"-01",amount:this.data.amount}))}},methods:{ok:function(){this.check()&&(this.$emit("save",this.data),this.close())},check:function(){var t=[],a=[],e=0;if(0===this.data.items.length)return this.$Message.error("你还没有分摊"),!1;for(var s=0,n=this.data.items.length;s<n;s++){var o=this.data.items[s];if(""==o.day)return this.$Message.error("日期不能为空"),!1;if(!o.amount)return this.$Message.error("分摊金额不能为空"),!1;-1===t.indexOf(o.day)?t.push(o.day):-1===a.indexOf(o.day)&&a.push(o.day),e=i.b.add(e,o.amount)}return a.length>0?(this.$Message.error("日期不能重复"),!1):this.data.amount<e?(this.$Message.error("分摊金额超额了"),!1):!(this.data.amount>e)||(this.$Message.error(this.data.amount+"元你还没有分摊完"),!1)},delItem:function(t,a){this.data.items.splice(a,1);var e=this.data.items.length;if(0!==e){var s=this.data.items[e-1];this.$set(this.data.items,e-1,{day:s.day,amount:i.b.add(s.amount,t.amount)})}},tallyDateChange:function(t){var a=n()(new Date(t)).add(this.day-1,"days").format("YYYY-MM-DD");this.data.items.findIndex(function(t){return t.day===a})>-1||(this.data.items.push({day:a,amount:0}),this.averageAmount())},tallyDayChange:function(t){this.data.items.forEach(function(a){var e=n()(a.day).format("YYYY-MM-DD").substring(0,7);a.day=n()(new Date(e)).add(t-1,"days").format("YYYY-MM-DD")})},averageAmount:function(){var t=Math.round(this.data.amount/this.data.items.length*100)/100;this.data.items.forEach(function(a){a.amount=t})},itemAmountChange:function(t,a){var e=0,s=0,n=this.data.items.length;if(1!==n){for(var o=0;o<n;o++){var r=this.data.items[o];o<a&&(e=i.b.add(e,r.amount))}s=i.b.sub(this.data.amount,i.b.add(t,e));for(var d=Math.round(s/(this.data.items.length-a-1)*100)/100,m=0;m<n;m++){var u=this.data.items[m];m>a&&(u.amount=d)}}}}}},2197:function(t,a,e){"use strict";var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{"mask-closable":!1,title:t.modal$.title,width:"600"},model:{value:t.modal$.show,callback:function(a){t.$set(t.modal$,"show",a)},expression:"modal$.show"}},[e("Form",{staticStyle:{"min-height":"380px"},attrs:{"label-width":80}},[e("Form-item",{staticClass:"custom-form-item-required",attrs:{label:"分摊金额"}},[e("InputNumber",{attrs:{max:t.max_amount,min:1},on:{"on-change":t.averageAmount},model:{value:t.data.amount,callback:function(a){t.$set(t.data,"amount",a)},expression:"data.amount"}})],1),t._v(" "),e("Form-item",{staticClass:"custom-form-item-required",attrs:{label:"分摊年月"}},[e("div",{staticClass:"row"},[e("DatePicker",{staticClass:"col-sm-6",attrs:{type:"month",open:""},on:{"on-change":t.tallyDateChange},model:{value:t.date,callback:function(a){t.date=a},expression:"date"}}),t._v(" "),e("div",{staticClass:"col-sm-6"},[e("div",{staticClass:"tally-day"},[e("label",[t._v("记账日")]),t._v(" "),e("InputNumber",{attrs:{min:1,max:31},on:{"on-change":t.tallyDayChange},model:{value:t.day,callback:function(a){t.day=a},expression:"day"}})],1),t._v(" "),e("div",{staticClass:"tally-date"},t._l(t.data.items,function(a,s){return e("p",[e("DatePicker",{staticStyle:{width:"120px"},attrs:{value:a.day},on:{"on-change":function(t){a.day=t}}}),t._v(" "),e("InputNumber",{attrs:{min:0,max:t.data.amount},on:{"on-change":function(a){t.itemAmountChange(a,s)}},model:{value:a.amount,callback:function(e){t.$set(a,"amount",e)},expression:"item.amount"}}),t._v(" "),e("Icon",{staticStyle:{"vertical-align":"middle",cursor:"pointer"},attrs:{type:"close",color:"#f30",size:"14"},nativeOn:{click:function(e){t.delItem(a,s)}}})],1)}))])],1)])],1),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"ghost"},on:{click:t.close}},[t._v("关闭")]),t._v(" "),e("Button",{attrs:{type:"primary"},on:{click:t.ok}},[t._v("确定")])],1)],1)},n=[];s._withStripped=!0;var i={render:s,staticRenderFns:n};a.a=i},415:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e(1604),n=e(2197),i=e(11),o=i(s.a,n.a,!1,null,null,null);o.options.__file="src/views/business/iae/apportion-modal.vue",a.default=o.exports}});