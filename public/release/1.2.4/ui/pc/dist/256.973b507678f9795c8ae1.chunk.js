webpackJsonp([256],{336:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(648),l=s(666),a=s(11),n=a(i.a,l.a,!1,null,null,null);n.options.__file="src/views/components/SelectLessonModal.vue",e.default=n.exports},648:function(t,e,s){"use strict";var i=s(54),l=s.n(i),a=s(1),n=s(207),c=s(208),o=s(665),d=s(55),r={lesson_type:[],season:"",sj_ids:0,product_level_did:0};e.a={name:"LessonList",mixins:[n.a,d.a,c.a,o.a],props:{value:{type:Boolean,default:!1},width:{type:String,default:"640"},title:{type:String,default:"选择课程"},condition:{type:Object,default:function(){return a.b.copy(r)}},allowType:{type:Array,default:function(){return[0,1,2]}},multiple:{type:Boolean,default:!1},selected:{type:[Array,Number,String],default:function(){return[]}},isDemoExtra:{type:Boolean,default:!1}},data:function(){return{params:{search_field:"lesson_name",search_value:"",order_field:"",order_sort:"",last_search_value:""},textField:"lesson_name",idField:"lid",gvarName:"lessons",is_demo:this.isDemoExtra,searchExpand:!1}},watch:{isDemoExtra:function(t){this.is_demo=t}},computed:{classes:function(){var t;return["select-list",(t={},l()(t,"select-list-multiple",this.multiple),l()(t,"select-list-single",!this.multiple),t)]},toggleSearchIcon:function(){return"chevron-"+(this.searchExpand?"up":"down")},subjects:function(){return this.gvars("subjects")},product_levels:function(){return this.$store.state.gvars.dicts.product_level}},mounted:function(){this.init_data(),this.refreshSelId(this.selected)},methods:{resetSearch:function(){this.condition.lesson_type=[0,1,2],this.condition.season="",this.condition.sj_ids=0,this.condition.product_level_did=0,this.params.search_value="",this.search()},toggleSearch:function(){this.searchExpand=!this.searchExpand},ok:function(){if(!this.selectedTotal)return void this.$Message.error("没有选中任何课程");if(this.multiple)this.$emit("on-select",this.selectedList);else{var t=this.getObjById(this.selIds[0]);this.$emit("on-select",t)}this.modalShow=!1,this.$emit("input",!1)},data_filter:function(t){var e=this,s=[],i=this.is_demo?1:0;return s=t.filter(function(t){return 0==t.bids.length||-1!==t.bids.indexOf(e.bid$)}),this.condition.hasOwnProperty("lesson_type")&&(s=s.filter(function(t){return e.condition.lesson_type.indexOf(t.lesson_type)>-1})),this.condition.product_level_did&&(s=s.filter(function(t){return e.condition.product_level_did==t.product_level_did})),this.condition.season&&(s=s.filter(function(t){return e.condition.season==t.season})),this.condition.sj_ids&&(s=s.filter(function(t){return t.sj_ids.indexOf(e.condition.sj_ids)>-1})),s=s.filter(function(t){return i===t.is_demo&&1==t.status})},changeLessonType:function(){this.init_data()},change:function(t){var e=["期","次","课时","月"],s=t.is_term?0:t.price_type,i=e[s],l=a.b.sprintf("按%s收费,%s元/%s",i,t.sale_price,i),n=[],c=t.unit_price;if(n.push("<p>"+l+"</p>"),t.is_term){i=e[t.price_type],c=parseFloat(t.sale_price/t.lesson_nums).toFixed(2);var o=a.b.sprintf("共%s%s,单价:%s元/%s",t.lesson_nums,i,c,i);n.push("<p>"+o+"</p>")}return n.join("")}}}},665:function(t,e,s){"use strict";var i=s(1);e.a={data:function(){return{data:[],pageIndex:1,pageSize:10,is_data_init:!1,modalShow:!1,selIds:[],checkAll:!1,params:{search_field:"",search_value:"",order_field:"",order_sort:"",last_search_value:""},textField:"",idField:"",gvarName:"",total:0}},computed:{selectedTotal:function(){return 0!=this.selIds[0]?this.selIds.length:0},selectedList:function(){var t=this,e=[];return this.selIds.forEach(function(s){s>0&&e.push(t.getObjById(s))}),e},labelText:function(){return this.selIds.length>0&&0!=this.selIds[0]?this.$filter(this.textField)(this.selIds[0]):""}},methods:{pagesize:function(t){this.pageSize=t,this.init_data()},pagenation:function(t){this.pageIndex=t,this.init_data()},search:function(){this.pagenation(1)},resetSearch:function(){this.params.search_value="",this.init_data()},data_filter:function(t){return t},init_data:function(){var t=this,e=[],s=[],l=void 0,a=void 0,n=void 0;s=/^\s*$/.test(this.params.search_value)?this.$store.state.gvars[this.gvarName]:this.$store.state.gvars[this.gvarName].filter(function(e){return-1!==e[t.params.search_field].indexOf(t.params.search_value)}),i.a.isEmpty(this.condition)||this.condition.bid&&(s=s.filter(function(e){return 0==e.bids.length||-1!==e.bids.indexOf(t.condition.bid)})),s=this.data_filter(s),this.total=s.length,l=(this.pageIndex-1)*this.pageSize,a=l+this.pageSize,n=0,s.forEach(function(t){n>=l&&n<a&&e.push(i.b.copy(t)),n++}),this.data=e,this.refreshData(e)},getObjById:function(t){var e=this,s=this.$store.state.gvars[this.gvarName].find(function(s){return s[e.idField]==t});return s?i.b.copy(s):null},clearSelectedId:function(){this.selIds.splice(0,this.selIds.length),this.refreshData(this.data)},cancelSelectedId:function(t){var e=this.selIds.indexOf(t[this.idField]);-1!==e&&(this.selIds.splice(e,1),this.refreshData(this.data))},deal_data:function(t){return t.list.length>0?(this.$store.commit("buildIdTextMap",{list:t.list,name:"",ifield:"",tfield:""}),this.refreshData(t.list)):this.multiple&&this.checkAll&&(this.checkAll=!1),t.list},checkSelectAll:function(t,e,s){return-1!==this.selIds.indexOf(t[this.idField])},refreshData:function(t){var e=this;t.forEach(function(t){-1!==e.selIds.indexOf(t[e.idField])?t.$selected=!0:t.$selected=!1}),this.multiple&&(this.checkAll=t.every(this.checkSelectAll))},addSelectedId:function(t){-1===this.selIds.indexOf(t)&&(this.selIds.push(t),this.refreshData(this.data))},removeSelectedId:function(t){var e=this.selIds.indexOf(t);-1!==e&&(this.selIds.splice(e,1),this.refreshData(this.data))},replaceSelectedId:function(t){0==this.selIds.length?this.selIds.push(t):this.selIds.splice(0,1,t)},toggleSelected:function(t){this.multiple?t.$selected?this.removeSelectedId(t[this.idField]):this.addSelectedId(t[this.idField]):t.$selected?this.ok():(this.data.forEach(function(t){t.$selected=!1}),t.$selected=!0,this.replaceSelectedId(t[this.idField]))},init_data_cache:function(){this.is_data_init||(this.init_data(),this.is_data_init=!0)},handleCheckAll:function(){var t=this;this.data.forEach(function(e){var s=t.selIds.indexOf(e[t.idField]);!1===t.checkAll?-1==s&&(t.selIds.push(e[t.idField]),e.$selected=!0):s>-1&&(t.selIds.splice(s,1),e.$selected=!1)})},refreshSelId:function(t){var e=this;null!==t&&0!==t.length&&""!==t&&0!==t||(this.selIds=[],this.refreshData(this.data)),this.multiple?t.forEach(function(t){-1==e.selIds.indexOf(t)&&e.selIds.push(t)}):0==this.selIds.length?this.selIds.push(t):this.selIds.splice(0,1,t)},cancel:function(){var t=this;this.modalShow=!1,this.multiple?(this.selIds=[],this.selected.forEach(function(e){t.selIds.push(e)}),this.refreshData(this.data)):(this.selIds=[],this.selIds.push(this.selected),this.refreshData(this.data)),this.$emit("input",!1)},closeModal:function(){this.cancel()}},watch:{value:function(t){this.modalShow=t,this.modalShow?this.init_data_cache():""!=this.params.search_value&&(this.params.search_value="",this.is_data_init=!1)},selected:function(t){var e=this;null!==t&&0!==t.length&&""!==t&&0!==t||(this.selIds=[],this.refreshData(this.data)),this.multiple?t.forEach(function(t){-1==e.selIds.indexOf(t)&&e.selIds.push(t)}):0==this.selIds.length?this.selIds.push(t):this.selIds.splice(0,1,t)},"$store.state.branch.id":{handler:function(t,e){this.pageIndex=1,this.pageSize=10,this.init_data()}}}}},666:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{"mask-closable":!0,width:t.width,title:t.title},on:{"on-cancel":t.closeModal},model:{value:t.modalShow,callback:function(e){t.modalShow=e},expression:"modalShow"}},[s("div",{class:t.classes},[s("div",{staticClass:"list-main"},[s("div",{staticClass:"list-condition"},[s("Row",{attrs:{gutter:8}},[s("Col",{attrs:{span:"8"}},[s("Select",{attrs:{placeholder:"课程级别",size:"small"},model:{value:t.condition.product_level_did,callback:function(e){t.$set(t.condition,"product_level_did",e)},expression:"condition.product_level_did"}},[s("Option",{attrs:{value:0}},[t._v("不限课程级别")]),t._v(" "),t._l(t.product_levels,function(e){return s("Option",{attrs:{value:e.did}},[t._v(t._s(e.title))])})],2)],1),t._v(" "),s("Col",{attrs:{span:"8"}},[s("Select",{attrs:{placeholder:"科目",clearable:!0,size:"small"},model:{value:t.condition.sj_ids,callback:function(e){t.$set(t.condition,"sj_ids",e)},expression:"condition.sj_ids"}},[s("Option",{attrs:{value:""}},[t._v("不限科目")]),t._v(" "),t._l(t.subjects,function(e){return s("Option",{attrs:{value:e.sj_id}},[t._v(t._s(e.subject_name))])})],2)],1),t._v(" "),s("Col",{attrs:{span:"8"}},[s("Select",{attrs:{placeholder:"期段",clearable:!0,size:"small"},model:{value:t.condition.season,callback:function(e){t.$set(t.condition,"season",e)},expression:"condition.season"}},[s("Option",{attrs:{value:""}},[t._v("不限期段")]),t._v(" "),t._l(t.dicts("season"),function(e){return s("Option",{attrs:{value:e.name}},[t._v(t._s(e.title))])})],2)],1)],1),t._v(" "),s("Row",{staticClass:"mt-3"},[s("Col",{attrs:{span:"8"}},[s("Input",{directives:[{name:"focusme",rawName:"v-focusme",value:"searchkey",expression:"'searchkey'"}],attrs:{size:"small",placeholder:"课程名称"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.search(e)}},model:{value:t.params.search_value,callback:function(e){t.$set(t.params,"search_value",e)},expression:"params.search_value"}})],1),t._v(" "),s("Col",{attrs:{span:"16"}},[s("ButtonGroup",[s("Button",{attrs:{type:"primary",icon:"ios-search",size:"small"},on:{click:t.search}},[t._v("查询")])],1),t._v(" "),s("Button",{attrs:{type:"primary",icon:"refresh",size:"small"},on:{click:t.resetSearch}},[t._v("重置")]),t._v(" "),s("CheckboxGroup",{staticClass:"ml-3",staticStyle:{display:"inline-block"},on:{"on-change":t.changeLessonType},model:{value:t.condition.lesson_type,callback:function(e){t.$set(t.condition,"lesson_type",e)},expression:"condition.lesson_type"}},[-1!==t.allowType.indexOf(0)?s("Checkbox",{attrs:{disabled:1==t.allowType.length,label:0}},[t._v("班课")]):t._e(),t._v(" "),-1!==t.allowType.indexOf(1)?s("Checkbox",{attrs:{disabled:1==t.allowType.length,label:1}},[t._v("一对一")]):t._e(),t._v(" "),-1!==t.allowType.indexOf(2)?s("Checkbox",{attrs:{disabled:1==t.allowType.length,label:2}},[t._v("一对多")]):t._e()],1),t._v(" "),s("span",[t._v("|")]),t._v(" "),s("Checkbox",{staticClass:"ml-2",attrs:{disabled:t.isDemoExtra},model:{value:t.is_demo,callback:function(e){t.is_demo=e},expression:"is_demo"}},[t._v("体验课")])],1)],1)],1),t._v(" "),s("div",{staticClass:"list-body"},[s("div",{directives:[{name:"loading",rawName:"v-loading.like",value:"lessons",expression:"'lessons'",modifiers:{like:!0}}],staticClass:"list-body-wrap"},[s("table",{staticClass:"modal-table"},[s("thead",[s("tr",[t.multiple?s("th",{attrs:{width:"50"}},[s("div",{staticClass:"ivu-table-cell"},[s("Checkbox",{nativeOn:{click:function(e){t.handleCheckAll(e)}},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}})],1)]):t._e(),t._v(" "),s("th",[s("div",{staticClass:"ivu-table-cell"},[t._v("课程")])]),t._v(" "),s("th",[s("div",{staticClass:"ivu-table-cell"},[t._v("授课")])]),t._v(" "),s("th",[s("div",{staticClass:"ivu-table-cell"},[t._v("收费")])]),t._v(" "),s("th",[s("div",{staticClass:"ivu-table-cell"},[t._v("等级")])])])]),t._v(" "),s("tbody",[t._l(t.data,function(e){return s("tr",{class:{"table-info":e.$selected},on:{click:function(s){t.toggleSelected(e)}}},[t.multiple?s("td",[s("div",{staticClass:"ivu-table-cell"},[s("Checkbox",{model:{value:e.$selected,callback:function(s){t.$set(e,"$selected",s)},expression:"item.$selected"}})],1)]):t._e(),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.lesson_name))])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[s("p",[t._v(t._s(t._f("lesson_type")(e.lesson_type)))]),t._v(" "),3!==e.price_type?[s("p",[t._v("单次课时长:"+t._s(e.unit_lesson_minutes)+"分钟")]),t._v(" "),s("p",[t._v("每次课消耗:"+t._s(e.unit_lesson_hours)+"课时")])]:t._e()],2)]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell",domProps:{innerHTML:t._s(t.change(e))}})]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(t._f("dict_title")(e.product_level_did,"product_level")))])])])}),t._v(" "),0==t.data.length?s("tr",[s("td",{staticStyle:{"text-align":"center"},attrs:{colspan:"5"}},[s("p",{staticClass:"empty"},[t._v("没有合适的课程")])])]):t._e()],2)])]),t._v(" "),s("div",{staticClass:"list-page clearfix"},[s("Page",{staticClass:"pull-right",attrs:{size:"small",total:t.total,"show-total":!0,current:t.pageIndex,"show-sizer":!0,"page-size":t.pageSize},on:{"on-change":t.pagenation,"on-page-size-change":t.pagesize}})],1)])]),t._v(" "),this.multiple?s("div",{staticClass:"multi-selected"},[s("Card",[s("div",{staticStyle:{display:"flex","align-items":"center"},attrs:{slot:"title"},slot:"title"},[s("span",{staticStyle:{flex:"0 0 190px"}},[t._v("已选择:"),s("span",{staticClass:"badge"},[t._v(t._s(t.selectedTotal))])]),t._v(" "),s("Button",{staticClass:"pull-right",attrs:{type:"ghost",shape:"circle",size:"small",icon:"trash-a",title:"清空"},on:{click:t.clearSelectedId}})],1),t._v(" "),s("ul",{staticClass:"multi-selected-list"},t._l(t.selectedList,function(e){return s("li",{staticStyle:{display:"flex","align-items":"center"}},[s("span",{staticStyle:{flex:"0 0 190px"}},[t._v(t._s(e.lesson_name))]),t._v(" "),s("Button",{staticClass:"pull-right",attrs:{type:"ghost",shape:"circle",size:"small",icon:"trash-a",title:"移除"},on:{click:function(s){t.cancelSelectedId(e)}}})],1)}))])],1):t._e()]),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[t.multiple?t._e():s("span",{staticClass:"footer-selected pull-left"},[s("i",[t._v("已选择:")]),t._v(t._s(t.labelText))]),t._v(" "),s("Button",{attrs:{type:"default"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),s("Button",{attrs:{type:"primary"},on:{click:t.ok}},[t._v("确定")])],1)])},l=[];i._withStripped=!0;var a={render:i,staticRenderFns:l};e.a=a}});