webpackJsonp([221],{1575:function(e,t,i){"use strict";var s=i(0),a=i.n(s),n=i(1),o=i(208),l=i(209),r=i(207),d=i(636),c={dc_id:0,debit_type:2,amount:0,buy_int_day:a()().format("YYYY-MM-DD"),expire_int_day:"",remark:"",aa_id:0,salesman:[]};t.a={mixins:[l.a,r.a,o.a],components:{SelectEmployee:d.a},data:function(){return{debit_cards:[],sid:0,salesman:[],student:null,info:n.b.copy(c),options:{disabledDate:function(e){return e&&e.valueOf()<Date.now()-864e5}},aa_list:[{aa_id:0,name:"-请选择收款账号-"}]}},mounted:function(){this.deal_aa_list()},methods:{onModalOpen:function(){this.get_debit_cards(),this.init_salesman()},init_salesman:function(){var e=this;this.salesman.length>0&&this.salesman.forEach(function(t){e.info.salesman.push(n.b.copy(t))})},add_sale_role:function(e){if(this.info.salesman.find(function(t){return t.eid==e.eid}))return this.$Message.error("请不要重复添加"),!1;var t=n.b.copy(e);this.info.salesman.push({eid:t.eid,sale_role_did:t.sale_role_did})},deal_aa_list:function(){var e=this,t=this.bid$;this.accounts$.forEach(function(i){var s=!1,a=!1,o="others";n.a.isEmpty(i.bids)?1==i.is_public&&1==i.is_front&&(s=!0,0==i.type&&1==i.is_default&&(a=!0)):-1!==i.bids.indexOf(t)&&1==i.is_front&&(s=!0),s&&(a&&(o="default"),e.aa_list.push(e.create_account_item(i,o)))})},create_account_item:function(e,t){var i={};return i.aa_id=parseInt(e.aa_id),i.name=e.name,i.is_public=e.is_public,i.pay_amount=0,i.type=e.type,i.cp_id=e.cp_id,i.pay_status=!0,i.mode="default"==t?0:1,i},selectDebitCard:function(e){var t=this.debit_cards.find(function(t){return t.dc_id===e});t&&(this.info.amount=Number(t.amount),this.info.expire_int_day=a()().add(t.expire_days,"days").format("YYYY-MM-DD"))},get_debit_cards:function(){var e=this;this.$rest("debit_cards").get({bid:this.bid$,pagesize:1e3}).success(function(t){e.debit_cards=t.list}).error(function(t){e.$Message.error(t.body.message)})},ok:function(){var e=this;if(2===this.info.debit_type){if(0===this.info.dc_id)return void this.$Message.error("请选择一张储值卡")}else if(0===this.info.amount)return void this.$Message.error("储值金额不能为0");if(0==this.info.aa_id){if(/^\s*$/.test(this.info.remark))return void this.$Message.error("未选择收款账号，请必须注明原因!");if(!confirm("您没有选择收款账号，储值操作将不会产生关联的财务流水记录，您确定吗？"))return}this.$rest("students").add_url_param(this.sid,"money").post(this.info).success(function(t){e.$Message.success("储值成功"),e.$emit("success",t),e.close()}).error(function(t){e.$Message.error(t.body.message)})}}}},2150:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{title:e.modal$.title,"mask-closable":!1,width:"550"},model:{value:e.modal$.show,callback:function(t){e.$set(e.modal$,"show",t)},expression:"modal$.show"}},[i("Form",{attrs:{"label-width":80}},[i("Form-item",{attrs:{label:"储值方式"}},[i("RadioGroup",{attrs:{type:"button"},model:{value:e.info.debit_type,callback:function(t){e.$set(e.info,"debit_type",t)},expression:"info.debit_type"}},[i("Radio",{attrs:{label:2}},[e._v("购买储值卡")]),e._v(" "),i("Radio",{attrs:{label:1}},[e._v("直接储值")])],1)],1),e._v(" "),2===e.info.debit_type?[i("Form-item",{attrs:{label:"储值卡"}},[i("Select",{staticStyle:{width:"350px"},attrs:{placeholder:"请选择一张储值卡"},on:{"on-change":e.selectDebitCard},model:{value:e.info.dc_id,callback:function(t){e.$set(e.info,"dc_id",t)},expression:"info.dc_id"}},e._l(e.debit_cards,function(t){return i("Option",{attrs:{value:t.dc_id}},[e._v(e._s(t.card_name)+" (+"+e._s(t.amount)+")")])}))],1),e._v(" "),i("Form-item",{attrs:{label:"有效期至"}},[i("DatePicker",{attrs:{value:e.info.expire_int_day,options:e.options,clearable:""},on:{"on-change":function(t){e.info.expire_int_day=t}}}),e._v(" (不填则不限制)\n\t\t\t\t")],1)]:e._e(),e._v(" "),i("Form-item",{attrs:{label:"储值金额"}},[i("InputNumber",{attrs:{readonly:2===e.info.debit_type,min:0},model:{value:e.info.amount,callback:function(t){e.$set(e.info,"amount",t)},expression:"info.amount"}}),e._v(" 元\n\t\t\t")],1),e._v(" "),i("Form-item",{attrs:{label:"收款账号"}},[i("Select",{attrs:{filterable:""},model:{value:e.info.aa_id,callback:function(t){e.$set(e.info,"aa_id",t)},expression:"info.aa_id"}},e._l(e.aa_list,function(t,s){return i("Option",{key:s,attrs:{value:t.aa_id}},[e._v(e._s(t.name))])}))],1),e._v(" "),i("Form-item",{attrs:{label:"备注"}},[i("Input",{attrs:{size:"small"},model:{value:e.info.remark,callback:function(t){e.$set(e.info,"remark",t)},expression:"info.remark"}})],1),e._v(" "),i("Form-item",{attrs:{label:"业绩归属："}},[[e._l(e.info.salesman,function(t,s){return i("Tag",{key:s,attrs:{closable:""},on:{"on-close":function(i){e.del_sale_role(t)}}},[e._v("\n\t\t\t\t\t\t"+e._s(e._f("ename")(t.eid))+"\n\t\t\t\t\t\t - "+e._s(e.labelDicts(t.sale_role_did,"sale_role"))+"\t\t\t\t\t\t\t\t\n\t\t\t\t\t")])}),e._v(" "),i("select-employee",{staticStyle:{width:"auto","line-height":"inherit"},attrs:{did:1},on:{onChange:e.add_sale_role}},[i("span",{staticClass:"text-info",staticStyle:{cursor:"pointer"},attrs:{title:"添加"}},[i("Icon",{attrs:{type:"plus"}})],1)])]],2)],2),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"ghost",disabled:e.saving},on:{click:e.close}},[e._v("关闭")]),e._v(" "),i("Button",{attrs:{type:"primary",loading:e.saving},on:{click:e.ok}},[e._v("确定")])],1)],1)},a=[];s._withStripped=!0;var n={render:s,staticRenderFns:a};t.a=n},387:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(1575),a=i(2150),n=i(11),o=n(s.a,a.a,!1,null,null,null);o.options.__file="src/views/dashboard/payment/buy-debit-modal.vue",t.default=o.exports},620:function(e,t,i){"use strict";function s(e,t){for(var i=0;i<t.length;i++)if(e===t[i])return!0;return!1}function a(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=e.$children;return s.length&&s.forEach(function(e){var s=e.$options.name,n=e.$children;if(s===t&&i.push(e),n.length){var o=a(e,t,i);o&&i.concat(o)}}),i}t.b=s,i.d(t,"a",function(){return a});window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver},636:function(e,t,i){"use strict";var s=i(638),a=i(650),n=i(11),o=n(s.a,a.a,!1,null,null,null);o.options.__file="src/views/components/SelectEmployee.vue",t.a=o.exports},638:function(e,t,i){"use strict";var s=i(9),a=i.n(s),n=i(54),o=i.n(n),l=i(207),r=i(620),d=(i(24),i(1),"ivu-select");t.a={name:"SelectEmployee",mixins:[l.a],props:{value:{type:[String,Number,Array],default:0},mode:{type:String,default:"employee"},rid:{type:Number,default:0},did:{type:Number,default:0},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},placeholder:{type:String},loading:{type:Boolean,default:!1},loadingText:{type:String},size:{validator:function(e){return Object(r.b)(e,["small","large","default"])}},notFoundText:{type:String},placement:{validator:function(e){return Object(r.b)(e,["top","bottom"])},default:"bottom"}},data:function(){return{prefixCls:d,modalShow:!1,options:[],optionInstances:[],labelText:"",model:this.value}},computed:{modalWidth:function(){return this.multiple?"900":"640"},multiple:function(){return!!Array.isArray(this.model)},classes:function(){var e;return["ivu-select",(e={},o()(e,"ivu-select-visible",this.visible),o()(e,"ivu-select-disabled",this.disabled),o()(e,"ivu-select-multiple",this.multiple),o()(e,"ivu-select-single",!this.multiple),o()(e,"ivu-select-show-clear",this.showCloseIcon),o()(e,"ivu-select-"+this.size,!!this.size),e)]},showPlaceholder:function(){var e=!1;return"string"==typeof this.model?""!==this.model&&"0"!==this.model||(e=!0):Array.isArray(this.model)?this.model.length||(e=!0):"number"==typeof this.model?0==this.model&&(e=!0):null===this.model&&(e=!0),e},localePlaceholder:function(){return void 0===this.placeholder?"请选择":this.placeholder},showCloseIcon:function(){return this.clearable&&!this.showPlaceholder},title:function(){return 0==this.rid?"选择员工":1===this.rid?"选择"+this.$filter("translate")("老师"):2===this.rid?"选择"+this.$filter("translate")("助教"):4==this.rid?"选择"+this.$filter("translate")("学管师"):7==this.rid?"选择"+this.$filter("translate")("咨询师"):this.did>0?"选择员工与角色":"选择员工"}},methods:{openModal:function(){var e=this;if(this.disabled||this.readonly)return!1;this.$Modal.open("components/SelectEmployeeModal.vue@modal",{props:{multiple:this.multiple,selected:this.model,width:this.modalWidth,did:this.did,rid:this.rid,title:this.title,mode:this.mode},on:{"on-select":function(t){e.updateSelected(t)}}}).then(function(e){e.show()})},updateSelected:function(e){var t=this,i=e.selected,s=e.sale_role_did;this.multiple?(this.model.length>0&&this.model.splice(0,this.model.length),i.forEach(function(e){t.model.push(e.eid)})):(this.model=i.eid,this.did>0&&s&&this.$emit("onChange",{eid:i.eid,sale_role_did:s})),this.updateLabelText(),"user"==this.mode?this.getEmployeeUid().then(function(e){t.$emit("input",e),t.$emit("select",e)}):(this.$emit("input",this.model),this.$emit("select",this.model)),this.$emit("on-selected",i),this.dispatch("FormItem","on-form-change",this.model)},getEmployeeUid:function(){var e=this,t=this.model,i=0,s=[];return this.multiple?t.length&&(i=[],t.forEach(function(t){s.push(e.$store.dispatch("getMapObject",{id:t,name:"employee",idf:"eid",txf:"ename"}).then(function(t){e.model.push(t.uid)}))})):s.push(this.$store.dispatch("getMapObject",{id:t,name:"employee",idf:"eid",txf:"ename"}).then(function(e){i=e.uid})),new a.a(function(e,t){a.a.all(s).then(function(){e(i)},function(){t()})})},updateLabelText:function(){var e=this;this.multiple?this.model.length>0&&this.model[0]>0?this.$store.dispatch("getMapText",{id:this.model[0],name:"employee",idf:"eid",txf:"ename"}).then(function(t){var i=t;e.model.length>1&&(i+="等"+e.model.length+"个老师"),e.labelText=i}):this.labelText="":this.did>0?this.model.eid>0&&this.$store.dispatch("getMapText",{id:this.model.eid,name:"employee",idf:"eid",txf:"ename"}).then(function(t){e.labelText=t}):this.model?this.$store.dispatch("getMapText",{id:this.model,name:"employee",idf:"eid",txf:"ename"}).then(function(t){e.labelText=t}):this.labelText=""},clearSelected:function(){this.multiple?this.model.length>0&&this.model.splice(0,this.model.length):this.model=0,this.$emit("input",this.model),this.dispatch("FormItem","on-form-change",this.model)}},created:function(){this.model=this.value,this.showPlaceholder||this.updateLabelText()},mounted:function(){},watch:{value:function(e){"user"!=this.mode&&(this.model=e,this.updateLabelText())}}}},650:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.classes},[i("div",{on:{click:e.openModal}},[e._t("default",[i("div",{ref:"reference",class:[e.prefixCls+"-selection"]},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showPlaceholder,expression:"showPlaceholder"}],class:[e.prefixCls+"-placeholder"]},[e._v(e._s(e.localePlaceholder))]),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!e.showPlaceholder,expression:"!showPlaceholder"}],class:[e.prefixCls+"-selected-value"]},[e._v(e._s(e.labelText))]),e._v(" "),e.showCloseIcon?i("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:"ios-close"},nativeOn:{click:function(t){t.stopPropagation(),e.clearSelected(t)}}}):e._e(),e._v(" "),i("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:"arrow-down-b"}})],1)])],2)])},a=[];s._withStripped=!0;var n={render:s,staticRenderFns:a};t.a=n}});