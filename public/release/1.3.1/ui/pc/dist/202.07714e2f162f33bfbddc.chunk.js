webpackJsonp([202],{1594:function(t,e,s){"use strict";var i=s(1),l=s(209),a=s(207),n=s(208),o=s(936),c=s(2187),d={cid:0,lesson_type:-1,lid:0,sid:0,sids:[],name:"",_class_name:"",sj_id:0,grade:0,loop_arranges:[],schedule:[],students:[]};e.a={mixins:[a.a,l.a,n.a],components:{SelectObject:o.a,ScheduleTable:c.a},data:function(){return{info:i.b.copy(d),mapStudentList:{},rules:{obj:[{required:!0,type:"string",message:"请选择授课对象",trigger:"blur"}]}}},computed:{subjects:function(){var t=this.info.lid,e=this.$store.state.gvars.lessons,s=this.$store.state.gvars.subjects,i=[];if(t>0){var l=e.find(function(e){return e.lid==t});l&&(i=l.sj_ids)}return s.filter(function(t){return i.indexOf(t.sj_id)>-1})},filter_grades:function(){var t=[];if(!this.enable_grade||0==this.info.lesson_type||0==this.info.lid)return t;var e=this.getLessonObj(this.info.lid);return this.grades.filter(function(t){return t.name>=e.fit_grade_start&&t.name<=e.fit_grade_end})},int_day_option:function(){var t=this.$store.state.gvars.configs.params.course_arrange.allow_passed_arrange,e={};return t||(e={disabledDate:function(t){return t.valueOf()<Date.now()-864e5}}),e}},methods:{handleSuccess:function(){this.$emit("on-success"),this.close()},ok:function(){return 0==this.info.cid&&0==this.info.sid&&0==this.info.sids.length?void this.$Message.error("请先选择授课对象!"):this.info.schedule&&0!=this.info.schedule.length?void this.$refs.schedule.loopCheck():void this.$Message.error("请先添加排课规律！")},setTeachObject:function(t){var e=this,s=t.ids;if(this.info.lesson_type=t.type,!i.a.isEmpty(t.map_ids)){switch(t.type){case 0:this.info.cid=t.info.cid,this.info.lid=t.info.lid,this.info.sid=0,this.info.sids=[],this.info.students=[],this.info._class_name=t.info.class_name,this.mapStudentList={};break;case 1:case 2:this.info.cid=0,this.info.sid=1==t.type?s[0]:0,this.info.sids=2==t.type?s:[],this.info.lid=t.map_ids[s[0]].lid,this.setStudents(s,t.map_ids)}var l=this.$store.state.gvars.lessons.find(function(t){return t.lid==e.info.lid});l&&(this.info.sj_id=1==l.is_package?l.sj_ids[0]:l.sj_id)}},clearSelected:function(){this.info.lesson_type=-1,this.info.lid=0,this.info.sj_id=0,this.info.cid=0,this.info._class_name="",this.info.students.splice(0)},setStudents:function(t,e){var s=this;this.info.students=[],t.length&&t.forEach(function(t){var l=i.b.copy(e[t]);l.student_name=e[t].student.student_name,s.info.students.push(l)})}}}},1595:function(t,e,s){"use strict";var i=s(1),l=s(208);e.a={mixins:[l.a],data:function(){return{map_week_day:{1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"天"},map_end_type_times:{0:"每天",1:"隔天",2:"每周",3:"单周",4:"双周"},map_end_type_date:{0:"每周",1:"单周",2:"双周"},scheduleList:i.b.copy(this.value),errArranges:[],currentEditIndex:-1}},props:{value:{type:Array,default:function(){return[]}},info:{type:Object,default:function(){return{}}}},computed:{allArrangeList:function(){var t=this.scheduleList,e=[],s=this.currentEditIndex;return t&&t.length>0&&(t.forEach(function(t,i){void 0!==s&&s==i||(e=e.concat(t.list))}),t=this.orderBy(t,"int_day")),e}},watch:{scheduleList:function(t){this.$emit("input",t)}},methods:{previewSchedule:function(t,e){var s=this;e=e||!1,this.$Modal.open("business/class/arrange/schedule-info-modal.vue",{props:{list:t,loopCheck:e},on:{"on-success":function(){s.$emit("on-success")}}}).then(function(t){t.show()})},delInfo:function(t){var e=this.scheduleList.indexOf(t);e>-1&&this.scheduleList.splice(e,1)},editInfo:function(t,e){var s=this;this.currentEditIndex=e,this.$Modal.open("business/class/arrange/schedule-add-modal.vue",{props:{list:this.allArrangeList||[],item:t},on:{"on-add-schedule":function(t){s.currentEditIndex=-1,s.scheduleList.splice(e,1,i.b.copy(t))}}}).then(function(t){t.show("编辑上课规律","edit")})},addInfo:function(){var t=this;this.currentEditIndex=-1,this.$Modal.open("business/class/arrange/schedule-add-modal.vue",{props:{list:this.allArrangeList||[]},on:{"on-add-schedule":function(e){t.addSchedule(e)}}}).then(function(t){t.show("添加上课时间")})},addSchedule:function(t){this.scheduleList=this.scheduleList.concat(t)},loopCheck:function(){var t=this.allArrangeList;if(!t&&!t.length)return void this.$Message.error("当前规律的排课次数为0 ，请您添加新的排课规律!");this.previewSchedule(t,!0),this.arrangeCheck(t,0)},arrangeCheck:function(t,e){function s(s){s.$set(t[e],"_loading",!1),e<t.length-1&&s.arrangeCheck(t,e+1)}var i=this;this.$set(t[e],"_loading",!0),this.$set(t[e],"cid",this.info.cid),this.$set(t[e],"lid",this.info.lid),this.$set(t[e],"sj_id",this.info.sj_id),this.$set(t[e],"grade",this.info.grade),this.$set(t[e],"lesson_type",this.info.lesson_type),this.$set(t[e],"sid",this.info.sid),this.$set(t[e],"sids",this.info.sids),this.$rest("course_arranges/check_conflict").post(t[e]).success(function(l){var a=l.data.is_error,n=a?l.data.error_message:[],o=a?l.data.error_fields:[];i.$set(t[e],"_success",!a),i.$set(t[e],"_fail",a),i.$set(t[e],"error_message",n),i.$set(t[e],"_error_fields",o),s(i)}).error(function(t){s(i),i.$Message.error(t.body.message||"排课失败~ ")})}}}},2186:function(t,e){},2187:function(t,e,s){"use strict";function i(t){n||s(2188)}var l=s(1595),a=s(2189),n=!1,o=s(11),c=i,d=o(l.a,a.a,!1,c,null,null);d.options.__file="src/views/business/class/arrange/schedule-table.vue",e.a=d.exports},2188:function(t,e){},2189:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",{staticClass:"modal-table"},[t._m(0),t._v(" "),t._l(t.scheduleList,function(e,i){return s("tr",{key:i},[s("td",[s("div",{staticClass:"ivu-table-cell"},[1==e.end_type?[s("div",[s("p",[t._v("\n\t\t\t\t\t\t\t按日期排课：\n\t\t\t\t\t\t\t"),s("Tag",{attrs:{color:"blue"},on:{click:function(s){t.previewSchedule(e.list)}}},[t._v(t._s(e.int_start_day)+" ~ "+t._s(e.int_end_day))])],1),s("p"),s("p",[t._v("\n\t\t\t\t\t\t\t循环方式：\n\t\t\t\t\t\t\t"),s("Tag",[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.map_end_type_date[e.loop_type])+"\n\t\t\t\t\t\t\t")]),t._v("\n\t\t\t\t\t\t\t共\n\t\t\t\t\t\t\t"),s("Tag",{attrs:{color:"blue"},on:{click:function(s){t.previewSchedule(e.list)}}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(e.list.length)+"\n\t\t\t\t\t\t\t")]),t._v(" \n\t\t\t\t\t\t\t次\n\t\t\t\t\t\t")],1)]),t._v(" "),t._l(e.week_days,function(e){return s("Tag",{attrs:{color:"green"}},[t._v("\n\t\t\t\t\t\t"+t._s(t.map_week_day[e])+"\t\t\t\t\t\t\n\t\t\t\t\t")])})]:[s("div",[s("p",[t._v("\n\t\t\t\t\t\t\t按次数排课：共\n\t\t\t\t\t\t\t"),s("Tag",{attrs:{color:"blue"},on:{click:function(s){t.previewSchedule(e.list)}}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(e.list.length)+"\n\t\t\t\t\t\t\t")]),t._v(" \n\t\t\t\t\t\t\t次\n\t\t\t\t\t\t")],1),t._v(" "),s("p",[t._v("\n\t\t\t\t\t\t\t循环方式：\n\t\t\t\t\t\t\t"),s("Tag",[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.map_end_type_times[e.loop_type])+"\n\t\t\t\t\t\t\t")])],1)]),t._v(" "),e.loop_type>1?s("div",t._l(e.week_days,function(e){return s("Tag",{attrs:{color:"green"}},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.map_week_day[e])+"\t\t\t\t\t\t\n\t\t\t\t\t\t")])})):t._e()]],2)]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.int_start_hour)+" ~ "+t._s(e.int_end_hour))])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[s("p",[t._v("教室："+t._s(t._f("classroom_name")(e.cr_id,"-")))]),t._v(" "),s("p",[t._v(t._s(t._f("translate")("老师"))+"："+t._s(t._f("ename")(e.teach_eid,"-")))]),t._v(" "),s("p",[t._v(t._s(t._f("translate")("助教"))+"："+t._s(t._f("ename")(e.second_eid,"-")))]),t._v(" "),s("p",[t._v("扣课时数："+t._s(e.consume_lesson_hour))])])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[s("Button",{attrs:{size:"small",type:"text",icon:"ios-trash"},on:{click:function(s){t.delInfo(e)}}}),t._v(" "),s("Button",{attrs:{size:"small",type:"text",icon:"edit"},on:{click:function(s){t.editInfo(e,i)}}})],1)])])}),t._v(" "),s("tr",[s("td",{attrs:{colspan:"8"}},[s("div",{staticClass:"ivu-table-cell"},[s("span",{staticClass:"text-info cursor",on:{click:t.addInfo}},[s("Icon",{attrs:{type:"plus"}}),t._v(" 添加")],1)])])])],2)},l=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("th",{attrs:{width:""}},[s("div",{staticClass:"ivu-table-cell"},[t._v("排课规律")])]),t._v(" "),s("th",{attrs:{width:"140px"}},[s("div",{staticClass:"ivu-table-cell"},[t._v("上课时段")])]),t._v(" "),s("th",{attrs:{width:""}},[s("div",{staticClass:"ivu-table-cell"},[t._v("排课要素")])]),t._v(" "),s("th",{attrs:{width:"100px"}},[s("div",{staticClass:"ivu-table-cell"},[t._v("操作")])])])}];i._withStripped=!0;var a={render:i,staticRenderFns:l};e.a=a},2190:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{title:t.modal$.title,"mask-closable":!1,width:800},model:{value:t.modal$.show,callback:function(e){t.$set(t.modal$,"show",e)},expression:"modal$.show"}},[t.modal$.show?s("Form",{ref:"form",attrs:{"label-width":100,model:t.info,rules:t.rules}},[s("Row",[s("Col",{attrs:{span:"12"}},[s("Form-item",{attrs:{label:"授课对象",prop:"obj"}},[s("select-object",{ref:"object",attrs:{mode:"arrange",clearable:""},on:{"on-selected":t.setTeachObject,"on-clear":t.clearSelected}})],1)],1)],1),t._v(" "),s("Row",[s("Col",{attrs:{span:"12"}},[t.subjects.length?s("Form-item",{attrs:{prop:"sj_id",label:"科目"}},[s("Select",{model:{value:t.info.sj_id,callback:function(e){t.$set(t.info,"sj_id",e)},expression:"info.sj_id"}},t._l(t.subjects,function(e){return s("Option",{attrs:{value:e.sj_id}},[t._v(t._s(e.subject_name))])}))],1):t._e()],1),t._v(" "),s("Col",{attrs:{span:"12"}},[t.filter_grades.length>0?s("Form-item",{attrs:{label:"年级",prop:"grade"}},[s("Select",{attrs:{placeholder:""},model:{value:t.info.grade,callback:function(e){t.$set(t.info,"grade",e)},expression:"info.grade"}},t._l(t.filter_grades,function(e){return s("Option",{attrs:{value:e.name}},[t._v(t._s(e.title))])}))],1):t._e()],1)],1),t._v(" "),s("Form-item",{attrs:{label:"上课时段"}},[s("schedule-table",{ref:"schedule",attrs:{info:t.info},on:{"on-success":t.handleSuccess},model:{value:t.info.schedule,callback:function(e){t.$set(t.info,"schedule",e)},expression:"info.schedule"}})],1)],1):t._e(),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"ghost",loading:t.saving},on:{click:t.close}},[t._v("关闭")]),t._v(" "),s("Button",{attrs:{type:"primary",loading:t.saving},on:{click:t.ok}},[t._v("确定")])],1)],1)},l=[];i._withStripped=!0;var a={render:i,staticRenderFns:l};e.a=a},402:function(t,e,s){"use strict";function i(t){n||s(2186)}Object.defineProperty(e,"__esModule",{value:!0});var l=s(1594),a=s(2190),n=!1,o=s(11),c=i,d=o(l.a,a.a,!1,c,null,null);d.options.__file="src/views/business/class/arrange/multi-add-modal.vue",e.default=d.exports},625:function(t,e,s){"use strict";function i(t,e){for(var s=0;s<e.length;s++)if(t===e[s])return!0;return!1}function l(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=t.$children;return i.length&&i.forEach(function(t){var i=t.$options.name,a=t.$children;if(i===e&&s.push(t),a.length){var n=l(t,e,s);n&&s.concat(n)}}),s}e.b=i,s.d(e,"a",function(){return l});window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver},649:function(t,e,s){"use strict";var i=s(652),l=s(669),a=s(11),n=a(i.a,l.a,!1,null,null,null);n.options.__file="src/views/components/SelectLesson.vue",e.a=n.exports},652:function(t,e,s){"use strict";var i=s(54),l=s.n(i),a=s(625),n=(s(24),s(1),s(207)),o="ivu-select";e.a={name:"SelectLesson",mixins:[n.a],props:{value:{type:[String,Number,Array],default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},condition:{type:Object,default:function(){return{lesson_type:[0,1,2]}}},allowType:{type:Array,default:function(){return[0,1,2]}},clearable:{type:Boolean,default:!0},placeholder:{type:String},loading:{type:Boolean,default:!1},loadingText:{type:String},size:{validator:function(t){return Object(a.b)(t,["small","large","default"])}},notFoundText:{type:String},placement:{validator:function(t){return Object(a.b)(t,["top","bottom"])},default:"bottom"},isDemo:{type:Boolean,default:!1}},data:function(){return{prefixCls:o,modalShow:!1,options:[],optionInstances:[],labelText:"",model:this.value}},computed:{modalWidth:function(){return this.multiple?"900":"640"},multiple:function(){return!!Array.isArray(this.model)},classes:function(){var t;return["ivu-select",(t={},l()(t,"ivu-select-visible",this.visible),l()(t,"ivu-select-disabled",this.disabled),l()(t,"ivu-select-multiple",this.multiple),l()(t,"ivu-select-single",!this.multiple),l()(t,"ivu-select-show-clear",this.showCloseIcon),l()(t,"ivu-select-"+this.size,!!this.size),t)]},showPlaceholder:function(){var t=!1;return"string"==typeof this.model?""!==this.model&&"0"!==this.model||(t=!0):Array.isArray(this.model)?this.model.length||(t=!0):"number"==typeof this.model?0==this.model&&(t=!0):null===this.model&&(t=!0),t},localePlaceholder:function(){return void 0===this.placeholder?"请选择":this.placeholder},showCloseIcon:function(){return this.clearable&&!this.showPlaceholder&&!this.disabled}},methods:{openModal:function(){if(this.disabled)return!1;this.openMyModal()},openMyModal:function(){var t=this;this.$Modal.open("components/SelectLessonModal.vue@modal",{props:{multiple:this.multiple,selected:this.model,width:this.modalWidth,condition:this.condition,"is-demo-extra":this.isDemo,"allow-type":this.allowType},on:{"on-select":function(e){t.updateSelected(e)}}}).then(function(t){t.show()})},updateSelected:function(t){var e=this;this.multiple?(this.model.length>0&&this.model.splice(0,this.model.length),t.forEach(function(t){e.model.push(t.lid)})):this.model=t.lid,this.updateLabelText(),this.$emit("input",this.model),this.$emit("selected",t),this.dispatch("FormItem","on-form-change",this.model)},updateLabelText:function(){var t=this;this.multiple?this.model.length>0&&this.model[0]>0?this.$store.dispatch("getMapText",{id:this.model[0],name:"lesson",idf:"lid",txf:"lesson_name"}).then(function(e){var s=e;t.model.length>1&&(s+="等"+t.model.length+"门课程"),t.labelText=s}):this.labelText="":this.model?this.$store.dispatch("getMapText",{id:this.model,name:"lesson",idf:"lid",txf:"lesson_name"}).then(function(e){t.labelText=e}):this.labelText=""},clearSelected:function(){this.multiple?this.model.length>0&&this.model.splice(0,this.model.length):this.model=0,this.$emit("input",this.model),this.$emit("on-clear")}},created:function(){this.model=this.value,this.showPlaceholder||this.updateLabelText()},mounted:function(){},watch:{value:function(t){this.model=t,this.updateLabelText()}}}},669:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.classes},[s("div",{on:{click:t.openModal}},[t._t("default",[s("div",{ref:"reference",class:[t.prefixCls+"-selection"]},[s("span",{directives:[{name:"show",rawName:"v-show",value:t.showPlaceholder,expression:"showPlaceholder"}],class:[t.prefixCls+"-placeholder"]},[t._v(t._s(t.localePlaceholder))]),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.showPlaceholder,expression:"!showPlaceholder"}],class:[t.prefixCls+"-selected-value"]},[t._v(t._s(t.labelText))]),t._v(" "),t.showCloseIcon?s("Icon",{class:[t.prefixCls+"-arrow"],attrs:{type:"ios-close"},nativeOn:{click:function(e){e.stopPropagation(),t.clearSelected(e)}}}):t._e(),t._v(" "),s("Icon",{class:[t.prefixCls+"-arrow"],attrs:{type:"arrow-down-b"}})],1)])],2)])},l=[];i._withStripped=!0;var a={render:i,staticRenderFns:l};e.a=a},887:function(t,e,s){"use strict";var i=s(54),l=s.n(i),a=s(6),n=(s(1),s(207)),o=s(209),c=s(208),d=s(649),r=s(625),u=["classes?status=[<,2]&pagesize=10000","student_lessons?lesson_type=1&is_package=[OR,EQ,1]&with=student&pagesize=10000","student_lessons?lesson_type=2&is_package=[OR,EQ,1]&with=student&pagesize=10000"],h=["","student_lessons?lesson_type=1&is_package=[OR,EQ,1]&my=1&with=student&pagesize=10000","student_lessons?lesson_type=2&is_package=[OR,EQ,1]&my=1&with=student&pagesize=10000"];e.a={mixins:[o.a,n.a,c.a],components:{selectLesson:d.a},props:{value:{type:[Number,String,Array],default:0},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},placeholder:{type:String},loading:{type:Boolean,default:!1},loadingText:{type:String},size:{validator:function(t){return Object(r.b)(t,["small","large","default"])}},notFoundText:{type:String},placement:{validator:function(t){return Object(r.b)(t,["top","bottom"])},default:"bottom"},toFormal:{type:Boolean,default:!1},title:{type:String,default:"选择授课对象"},disabledTemp:{type:Boolean,default:!1},disabledDemo:{type:Boolean,default:!1}},data:function(){return{class_type:0,is_demo:0,type:0,checkAll:!1,checkMy:!1,selected:{type:0,info:{},map_ids:{},ids:[]},data:{lid:0,0:{url:"",key:"",total:0,list:[]},1:{url:"",key:"",total:0,list:[]},2:{url:"",key:"",total:0,list:[]}},student_default_value:"all",class_default_value:"all",labelText:"",modalShow:!1,prefixCls:"ivu-select"}},watch:{type:function(t){this.selected.type=t,this.get_data_list(t),this.clearSelectedId()},modalShow:function(t){t&&this.get_data_list(0)},"data.lid":function(t){}},mounted:function(){this.setUrl()},methods:{openModal:function(){this.modalShow=!0},clearSelected:function(){this.labelText="",this.$emit("on-clear")},setUrl:function(){this.perCheckAllClass?this.data[0].url=u[0]:(this.data[0].url=this.myClassApi+"&pagesize=1000",this.class_default_value="my"),this.perCheckAllStudent?(this.data[1].url=u[1],this.data[2].url=u[2]):(this.data[1].url=h[1],this.data[2].url=h[2],this.student_default_value="my")},turnStudentLesson:function(t){this.student_default_value!=t&&("my"==t?(this.data[1].url=h[1],this.data[2].url=h[2]):(this.data[1].url=u[1],this.data[2].url=u[2]),this.student_default_value=t,this.refresh(this.type))},turnClass:function(t){this.class_default_value!=t&&(this.data[0].url="my"==t?this.myClassApi+"&pagesize=1000":u[0],this.class_default_value=t,this.refresh(this.type))},refreshAll:function(){var t=this;[0,1,2].forEach(function(e){t.refresh(e)})},refresh:function(t){var e=this,s=this.data[t].url;this.dr().refreshData(s).then(function(s){e.data[t].list=0!==t?s.list.filter(function(t){return null!==t.student}):s.list,e.data[t].total=s.total})},get_data_list:function(t){var e=this,s=this.data[t].url;this.dr().refreshData(s).then(function(s){e.data[t].list=0!==t?s.list.filter(function(t){return null!==t.student}):s.list,e.data[t].total=s.total})},studentLessonArrangePercent:function(t){return 100*t.remain_lesson_hours/t.lesson_hours},classArrangePercent:function(t){return 100*t.attendance_times/t.lesson_times},addSelectedIds:function(t){var e=[this.type,this.selected.ids,-1],s=e[0],i=e[1],l=e[2];2!==s?(this.selected.map_ids={},this.selected.info=t,this.clearSelectedId(),0===s?(this.selected.ids.push(t.cid),this.selected.map_ids[t.cid]=t):(this.selected.map_ids[t.student.sid]=t,this.selected.ids.push(t.student.sid))):(this.selected.info={},l=i.indexOf(t.student.sid),l>-1?(this.selected.ids.splice(l,1),a.a.delete(this.selected.map_ids,t.student.sid)):(this.selected.map_ids[t.student.sid]=t,this.selected.ids.push(t.student.sid)),this.checkAll=this.selected.ids.length===this.data[2].list.length)},toggleSelected:function(t){var e=this.type;if(2===e){var s=this.selected.ids;if(s.length>0&&t.lid!==this.selected.map_ids[s[0]].lid)return this.$Message.error("只能选择相同课程学员"),a.a.set(t,"$selected",!1),!1;t.$selected?a.a.set(t,"$selected",!1):a.a.set(t,"$selected",!0)}else this.data[e].list.forEach(function(t){a.a.set(t,"$selected",!1)}),t.$selected=!0;this.addSelectedIds(t)},clearSelectedId:function(){this.selected.ids=[],this.data[2].list.forEach(function(t){t.$selected=!1}),this.checkAll=!1},handleCheckAll:function(){var t=this,e=this.checkAll;this.data[2].list.forEach(function(s){e?(t.selected.map_ids={},t.clearSelectedId()):(t.selected.ids.push(s.student.sid),s.$selected=!0,t.selected.map_ids[s.student.sid]=s)})},formatSex:function(t){return{0:"未确定",1:"男",2:"女"}[t]},filterList:function(t){var e=this,s=this.data[t].list,i=this.data.lid;return i>0&&(s=s.filter(function(t){return t.lid===i})),/^\s*$/.test(this.data[t].key)||(s=0===t?s.filter(function(s){return-1!==s.class_name.indexOf(e.data[t].key)}):s.filter(function(s){return-1!==s.student.student_name.indexOf(e.data[t].key)})),0===t&&(s=s.filter(function(t){return t.class_type==e.class_type}),s=s.filter(function(t){return t.is_demo==e.is_demo})),s},cancel:function(){this.modalShow=!1,this.clearSelectedId(),this.data[0].list.forEach(function(t){a.a.set(t,"$selected",!1)}),this.data[1].list.forEach(function(t){a.a.set(t,"$selected",!1)})},ok:function(){var t=this;if(0==this.selected.ids.length)return this.$Message.error("请先选择对象"),!1;if(this.$emit("on-selected",this.selected),2==this.type){var e=[];this.selected.ids.forEach(function(s){e.push(t.selected.map_ids[s].student.student_name)}),this.labelText=e.join("，")}else 0==this.type?this.labelText=this.selected.map_ids[this.selected.ids[0]].class_name:this.labelText=this.selected.map_ids[this.selected.ids[0]].student.student_name;this.cancel()}},computed:{selectedTotal:function(){return this.selected.ids.length},classes:function(){var t;return["ivu-select",(t={},l()(t,"ivu-select-visible",this.visible),l()(t,"ivu-select-disabled",this.disabled),l()(t,"ivu-select-single",!0),l()(t,"ivu-select-show-clear",this.showCloseIcon),l()(t,"ivu-select-"+this.size,!!this.size),t)]},showPlaceholder:function(){var t=!1;return 0==this.selected.ids.length&&""==this.labelText&&(t=!0),t},localPlaceholder:function(){return void 0===this.placeholder?"请选择":this.placeholder},showCloseIcon:function(){return this.clearable&&!this.showPlaceholder}}}},936:function(t,e,s){"use strict";var i=s(887),l=s(937),a=s(11),n=a(i.a,l.a,!1,null,null,null);n.options.__file="src/views/components/review/review-object.vue",e.a=n.exports},937:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.classes},[s("div",{ref:"reference",class:[t.prefixCls+"-selection"],on:{click:t.openModal}},[s("span",{directives:[{name:"show",rawName:"v-show",value:t.showPlaceholder,expression:"showPlaceholder"}],class:[t.prefixCls+"-placeholder"]},[t._v(t._s(t.localPlaceholder))]),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.showPlaceholder,expression:"!showPlaceholder"}],class:[t.prefixCls+"-selected-value"],staticStyle:{"line-height":"30px"}},[t._v(t._s(t.labelText))]),t._v(" "),s("Icon",{directives:[{name:"show",rawName:"v-show",value:t.showCloseIcon,expression:"showCloseIcon"}],class:[t.prefixCls+"-arrow"],attrs:{type:"ios-close"},nativeOn:{click:function(e){e.stopPropagation(),t.clearSelected(e)}}}),t._v(" "),s("Icon",{directives:[{name:"show",rawName:"v-show",value:!t.showCloseIcon,expression:"!showCloseIcon"}],class:[t.prefixCls+"-arrow"],attrs:{type:"arrow-down-b"}})],1),t._v(" "),s("Modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{title:t.title,"mask-closable":!1,width:"800"},on:{cancel:t.cancel},model:{value:t.modalShow,callback:function(e){t.modalShow=e},expression:"modalShow"}},[s("div",{staticClass:"select-list",class:2==t.type?"select-list-multiple":""},[s("div",{staticClass:"list-tab"},[s("Row",[s("Col",{attrs:{span:"24"}},[s("RadioGroup",{staticClass:"mr-3",attrs:{type:"button",size:"small"},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[s("Radio",{attrs:{label:0}},[t._v("班级")]),t._v(" "),s("Radio",{attrs:{label:1}},[t._v("1对1")]),t._v(" "),s("Radio",{attrs:{label:2}},[t._v("1对多")])],1),t._v(" "),0===t.type?[s("Checkbox",{staticClass:"ml-1",attrs:{disabled:t.disabledTemp,"true-value":1,"false-value":0},model:{value:t.class_type,callback:function(e){t.class_type=e},expression:"class_type"}},[t._v("临时班\n\t\t                \t")]),t._v(" "),s("span",[t._v("|")]),t._v(" "),s("Checkbox",{staticClass:"ml-1",attrs:{disabled:t.disabledDemo,"true-value":1,"false-value":0},model:{value:t.is_demo,callback:function(e){t.is_demo=e},expression:"is_demo"}},[t._v("体验班\n\t\t                \t")])]:t._e(),t._v(" "),1==t.type||2==t.type?s("div",{staticClass:"pull-right"},[s("label",[t._v("权限范围：")]),t._v(" "),s("ButtonGroup",[s("Button",{attrs:{type:"my"==t.student_default_value?"primary":"ghost",size:"small",icon:"android-person"},on:{click:function(e){t.turnStudentLesson("my")}}},[t._v("我的\n\t\t                        ")]),t._v(" "),s("Button",{attrs:{type:"all"==t.student_default_value?"primary":"ghost",size:"small",icon:"android-people",disabled:!t.perCheckAllStudent},on:{click:function(e){t.turnStudentLesson("all")}}},[t._v("所有\n\t\t                        ")])],1)],1):t._e(),t._v(" "),0==t.type?s("div",{staticClass:"pull-right"},[s("label",[t._v("权限范围：")]),t._v(" "),s("ButtonGroup",[s("Button",{attrs:{type:"my"==t.class_default_value?"primary":"ghost",size:"small",icon:"android-person"},on:{click:function(e){t.turnClass("my")}}},[t._v("我的\n\t\t                        ")]),t._v(" "),s("Button",{attrs:{type:"all"==t.class_default_value?"primary":"ghost",size:"small",icon:"android-people",disabled:!t.perCheckAllClass},on:{click:function(e){t.turnClass("all")}}},[t._v("所有\n\t\t                        ")])],1)],1):t._e()],2)],1)],1),t._v(" "),s("div",{staticClass:"list-condition mt-3"},[s("Form",{staticClass:"filter-form row",attrs:{"label-width":70}},[s("Form-item",{staticClass:"col-sm-6 mb-2",attrs:{label:0===t.type?"班级名称":"学员姓名"}},[1===t.type?s("Input",{attrs:{placeholder:"请输入学员姓名",size:"small"},model:{value:t.data[1].key,callback:function(e){t.$set(t.data[1],"key",e)},expression:"data[1].key"}}):t._e(),t._v(" "),2===t.type?s("Input",{attrs:{placeholder:"请输入学员姓名",size:"small"},model:{value:t.data[2].key,callback:function(e){t.$set(t.data[2],"key",e)},expression:"data[2].key"}}):t._e(),t._v(" "),0===t.type?s("Input",{attrs:{placeholder:"请输入班级名称",size:"small"},model:{value:t.data[0].key,callback:function(e){t.$set(t.data[0],"key",e)},expression:"data[0].key"}}):t._e()],1),t._v(" "),s("Form-item",{staticClass:"col-sm-6 mb-2",attrs:{label:"课程"}},[s("select-lesson",{staticClass:"x-ivu-select",attrs:{clearable:""},model:{value:t.data.lid,callback:function(e){t.$set(t.data,"lid",e)},expression:"data.lid"}})],1)],1)],1),t._v(" "),s("div",{staticClass:"list-body"},[0!=t.type?s("div",{directives:[{name:"loading",rawName:"v-loading.like",value:"student_lessons",expression:"'student_lessons'",modifiers:{like:!0}}],staticClass:"list-body-wrap"},[s("table",{staticClass:"table table-list"},[s("thead",[s("tr",[2===t.type?s("th",{attrs:{width:"50"}},[s("Checkbox",{nativeOn:{click:function(e){t.handleCheckAll(e)}},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}})],1):t._e(),t._v(" "),s("th",[t._v("姓名")]),t._v(" "),s("th",[t._v("年龄")]),t._v(" "),s("th",[t._v("课程")]),t._v(" "),s("th",[t._v("剩余课时/总课时")])])]),t._v(" "),s("tbody",[t._l(t.filterList(t.type),function(e){return e.student?s("tr",{class:{"table-info":e.$selected},on:{click:function(s){t.toggleSelected(e)}}},[2===t.type?s("td",[s("div",{staticClass:"ivu-table-cell"},[s("Checkbox",{attrs:{value:e.$selected,readonly:!0},on:{click:function(s){t.toggleSelected(e)}}})],1)]):t._e(),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[s("avatar-and-name",{attrs:{src:e.student.photo_url,name:e.student.student_name,sex:e.student.sex}})],1)]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(t.getAge(e.student.birth_time)))])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(t._f("lesson_name")(e.lid)))])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[s("Progress",{attrs:{percent:t.studentLessonArrangePercent(e),"stroke-width":5}},[t._v("\n\t                                \t\t"+t._s(e.remain_lesson_hours)+"/"+t._s(e.lesson_hours)+"\n\t                                \t")])],1)])]):t._e()}),t._v(" "),0==t.filterList(t.type).length?s("tr",[s("td",{staticStyle:{"text-align":"center"},attrs:{colspan:"5"}},[s("p",{staticClass:"empty"},[t._v("没有找到学员")])])]):t._e()],2)])]):s("div",{staticClass:"list-body-wrap"},[s("table",{staticClass:"table table-list"},[s("thead",[s("tr",[s("th",[t._v("班级")]),t._v(" "),s("th",[t._v("学员数")]),t._v(" "),s("th",[t._v("课程")]),t._v(" "),s("th",[t._v("考勤次数/总课时")])])]),t._v(" "),s("tbody",[t._l(t.filterList(t.type),function(e){return s("tr",{class:{"table-info":e.$selected},on:{click:function(s){t.toggleSelected(e)}}},[s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.class_name))])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.student_nums))])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[t._v(t._s(t._f("lesson_name")(e.lid)))])]),t._v(" "),s("td",[s("div",{staticClass:"ivu-table-cell"},[s("Progress",{attrs:{percent:t.classArrangePercent(e),"stroke-width":5}},[t._v("\n\t                                \t\t"+t._s(e.attendance_times)+"/"+t._s(e.lesson_times)+"\n\t                                \t")])],1)])])}),t._v(" "),0==t.filterList(t.type).length?s("tr",[s("td",{staticStyle:{"text-align":"center"},attrs:{colspan:"4"}},[s("p",{staticClass:"empty"},[t._v("没有找到班级")])])]):t._e()],2)])])]),t._v(" "),2===t.type?s("div",{staticClass:"multi-selected"},[s("Card",[s("div",{attrs:{slot:"title"},slot:"title"},[s("span",[t._v("已选择："),s("span",{staticClass:"badge"},[t._v(t._s(t.selectedTotal))])]),t._v(" "),s("Button",{staticClass:"pull-right",attrs:{type:"ghost",shape:"circle",size:"small",icon:"trash-a",title:"清空"},on:{click:t.clearSelectedId}})],1),t._v(" "),s("ul",{staticClass:"multi-selected-list"},t._l(t.selected.ids,function(e){return s("li",[s("span",[t._v(t._s(t.selected.map_ids[e].student.student_name))]),t._v(" "),s("Button",{staticClass:"pull-right",attrs:{type:"ghost",shape:"circle",size:"small",icon:"trash-a",title:"移除"},on:{click:function(s){t.addSelectedIds(e)}}})],1)}))])],1):t._e()]),t._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[2!==t.type&&t.selected.ids.length>0?s("div",{staticClass:"pull-left"},[t._v("\n\t\t\t\t已选择："),s("span",{staticClass:"text-info"},[0===t.type?s("label",[t._v(t._s(t.selected.map_ids[t.selected.ids[0]].class_name))]):s("label",[t._v(t._s(t.selected.map_ids[t.selected.ids[0]].student.student_name))])])]):t._e(),t._v(" "),s("Button",{attrs:{type:"ghost"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),s("Button",{attrs:{type:"primary"},on:{click:t.ok}},[t._v("确定")])],1)])],1)},l=[];i._withStripped=!0;var a={render:i,staticRenderFns:l};e.a=a}});