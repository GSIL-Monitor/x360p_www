webpackJsonp([17],{CtF5:function(n,e,t){e=n.exports=t("BkJT")(!0),e.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","",{version:3,sources:[],names:[],mappings:"",file:"setting.vue",sourceRoot:""}])},LSW6:function(n,e,t){"use strict";function s(n){t("hBI3")}Object.defineProperty(e,"__esModule",{value:!0});var i=t("TVG1"),o=t("8Llf"),r=t("aKkU"),a=t("40+F"),l=t("O0i/"),u=t("1CMQ"),p=t("7BY6"),c={name:"",newname:"",mobile:"",newmobile:"",vcode:"",oldpassword:"",password:"",repassword:""},d={mixins:[o.a],components:{Cell:r.a,Popup:l.a,Group:a.a,XInput:u.a,XButton:p.a},data:function(){return{popup_setting:!1,action:"",tId:null,send:{text:"发送验证码",loading:!1},user:i.b.copy(c)}},mounted:function(){this.init_data()},methods:{sendCapt:function(){if(!this.checkTel())return!1;this.getCapt()},getCapt:function(){var n=this,e=59;if(this.send.loading)return!1;this.send={loading:!0,text:"60s"},this.tId=setInterval(function(){e<10&&(e="0"+e),n.send.text=e+"s",--e<0&&(clearInterval(n.tId),n.send={loading:!1,text:"发送验证码"})},1e3),this.$rest("open/vcode").post({mobile:this.user.newmobile,type:"change"}).success(function(n){}).error(function(e){n.alert("获取验证码失败",e.body.message),clearInterval(n.tId),n.send={loading:!1,text:"发送验证码"}})},checkTel:function(){var n=this.user.newmobile;return""===n?(this.alert("请先输入手机号","手机号不能为空"),!1):!(""!==n&&!/^1[35789]{1}\d{9}$/.test(n))||(this.alert("请重新输入手机号","手机号格式不正确"),!1)},show_popup:function(n){this.action=n,this.popup_setting=!0},hide_popup:function(){this.user.newmobile="",this.user.newname=this.user.name,this.popup_setting=!1,this.send={text:"发送验证码",loading:!1},window.clearInterval(this.tId)},edit_profile:function(){var n=this;if(this.user.password===this.user.repassword){var e={action:this.action};"edit_name"==this.action?e.name=this.user.newname:"edit_mobile"==this.action?(e.mobile=this.user.newmobile,e.vcode=this.user.vcode):(e.oldpassword=this.user.oldpassword,e.password=this.user.password,e.repassword=this.user.repassword),this.$http.post("users/edit_profile",e).then(function(e){"edit_name"==n.action?(n.user.name=n.user.newname,n.$store.commit("updateUserInfo",{user:n.user,action:"changeName"})):"edit_mobile"==n.action&&(n.user.mobile=n.user.newmobile,n.$store.commit("updateUserInfo",{user:n.user,action:"changeMobile"})),n.toast("修改成功","success"),n.hide_popup()}).catch(function(e){console.log(e),n.toast(e.body.message,"warn")})}else this.toast("两次密码不一致","warn")},init_data:function(){var n=this.$store.state.user.info;n&&(this.user.name=n.name,this.user.newname=n.name,this.user.mobile=n.mobile)},logout:function(){var n=this;this.$http.get("logout").then(function(e){n.$store.commit("clearLoginInfo"),n.$router.push({path:"../login"})}).catch(function(e){n.$Message.error(e.body.message)})}},computed:{required:function(){var n=this.user;return"edit_name"==this.action?0===n.newname.length:"edit_mobile"==this.action?!/^1[35789]{1}\d{9}$/.test(n.newmobile)||0===n.vcode.length:0===n.oldpassword.length||0===n.password.length||0===n.repassword.length}}},h=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",[t("group",[t("cell",{attrs:{title:"修改姓名","is-link":""},nativeOn:{click:function(e){n.show_popup("edit_name")}},model:{value:n.user.name,callback:function(e){n.$set(n.user,"name",e)},expression:"user.name"}})],1),n._v(" "),t("group",[t("cell",{attrs:{title:"手机号绑定","is-link":""},nativeOn:{click:function(e){n.show_popup("edit_mobile")}}},[t("span",{staticClass:"text-disable",attrs:{slot:"value"},slot:"value"},[n._v(n._s(n.user.mobile))])]),n._v(" "),t("cell",{attrs:{title:"修改密码","is-link":""},nativeOn:{click:function(e){n.show_popup("resetpwd")}}})],1),n._v(" "),t("group",[t("cell",{attrs:{title:"退出","is-link":""},nativeOn:{click:function(e){n.logout(e)}}})],1),n._v(" "),t("popup",{style:{top:n.headerHeight+"px"},attrs:{height:"100%",position:"bottom"},model:{value:n.popup_setting,callback:function(e){n.popup_setting=e},expression:"popup_setting"}},["edit_name"==n.action?t("group",[t("x-input",{attrs:{title:"",type:"text",placeholder:"姓名 ",required:!0},model:{value:n.user.newname,callback:function(e){n.$set(n.user,"newname",e)},expression:"user.newname"}})],1):n._e(),n._v(" "),"edit_mobile"==n.action?t("group",[t("x-input",{attrs:{title:"",type:"text",placeholder:"请输入手机号",required:!0},model:{value:n.user.newmobile,callback:function(e){n.$set(n.user,"newmobile",e)},expression:"user.newmobile"}},[t("x-button",{attrs:{slot:"right",type:"primary",mini:"",disabled:n.send.loading},nativeOn:{click:function(e){n.sendCapt(e)}},slot:"right"},[n._v(n._s(n.send.text))])],1),n._v(" "),t("x-input",{attrs:{title:"",type:"text",placeholder:"请输入验证码 ",required:!0},model:{value:n.user.vcode,callback:function(e){n.$set(n.user,"vcode",e)},expression:"user.vcode"}})],1):n._e(),n._v(" "),"resetpwd"==n.action?t("group",[t("x-input",{attrs:{title:"",required:!0,type:"password",placeholder:"初始密码"},model:{value:n.user.oldpassword,callback:function(e){n.$set(n.user,"oldpassword",e)},expression:"user.oldpassword"}}),n._v(" "),t("x-input",{attrs:{title:"",required:!0,type:"password",placeholder:"新密码"},model:{value:n.user.password,callback:function(e){n.$set(n.user,"password",e)},expression:"user.password"}}),n._v(" "),t("x-input",{attrs:{title:"",required:!0,type:"password",placeholder:"再输一遍"},model:{value:n.user.repassword,callback:function(e){n.$set(n.user,"repassword",e)},expression:"user.repassword"}})],1):n._e(),n._v(" "),t("div",{staticClass:"pd-10"},[t("x-button",{staticClass:"bg-blue",attrs:{type:"primary",disabled:n.required},nativeOn:{click:function(e){n.edit_profile(e)}}},[n._v("确认")]),n._v(" "),t("x-button",{nativeOn:{click:function(e){n.hide_popup(e)}}},[n._v("取消")])],1)],1)],1)},m=[],v={render:h,staticRenderFns:m},w=v,f=t("8AGX"),_=s,b=f(d,w,!1,_,null,null);e.default=b.exports},hBI3:function(n,e,t){var s=t("CtF5");"string"==typeof s&&(s=[[n.i,s,""]]),s.locals&&(n.exports=s.locals);t("8bSs")("400eb2be",s,!0)}});
//# sourceMappingURL=17.18fbd20b6d28be88ddc7.js.map